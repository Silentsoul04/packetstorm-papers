%!PS-Adobe-3.0
%%Creator: groff version 1.06
%%DocumentNeededResources: font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%DocumentSuppliedResources: procset grops 1.06 0
%%Pages: 19
%%PageOrder: Ascend
%%Orientation: Portrait
%%EndComments
%%BeginProlog
%%BeginResource: procset grops 1.06 0

/setpacking where {
	pop
	currentpacking
	true setpacking
} if

/grops 120 dict dup begin 

% The ASCII code of the space character.
/SC 32 def

/A /show load def
/B { 0 SC 3 -1 roll widthshow } bind def
/C { 0 exch ashow } bind def
/D { 0 exch 0 SC 5 2 roll awidthshow } bind def
/E { 0 rmoveto show } bind def
/F { 0 rmoveto 0 SC 3 -1 roll widthshow } bind def
/G { 0 rmoveto 0 exch ashow } bind def
/H { 0 rmoveto 0 exch 0 SC 5 2 roll awidthshow } bind def
/I { 0 exch rmoveto show } bind def
/J { 0 exch rmoveto 0 SC 3 -1 roll widthshow } bind def
/K { 0 exch rmoveto 0 exch ashow } bind def
/L { 0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow } bind def
/M { rmoveto show } bind def
/N { rmoveto 0 SC 3 -1 roll widthshow } bind def
/O { rmoveto 0 exch ashow } bind def
/P { rmoveto 0 exch 0 SC 5 2 roll awidthshow } bind def
/Q { moveto show } bind def 
/R { moveto 0 SC 3 -1 roll widthshow } bind def
/S { moveto 0 exch ashow } bind def
/T { moveto 0 exch 0 SC 5 2 roll awidthshow } bind def

% name size font SF -

/SF {
	findfont exch
	[ exch dup 0 exch 0 exch neg 0 0 ] makefont
	dup setfont
	[ exch /setfont cvx ] cvx bind def
} bind def

% name a c d font MF -

/MF {
	findfont
	[ 5 2 roll
	0 3 1 roll % b
	neg 0 0 ] makefont
	dup setfont
	[ exch /setfont cvx ] cvx bind def
} bind def

/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def

% Guess the page length.
% This assumes that the imageable area is vertically centered on the page.
% PLG - length

/PLG {
	gsave newpath clippath pathbbox grestore
	exch pop add exch pop
} bind def

% BP -

/BP {
	/level0 save def
	1 setlinecap
	1 setlinejoin
	72 RES div dup scale
	LS {
		90 rotate
	} {
		0 PL translate
	} ifelse
	1 -1 scale
} bind def

/EP {
	level0 restore
	showpage
} bind def


% centerx centery radius startangle endangle DA -

/DA {
	newpath arcn stroke
} bind def

% x y SN - x' y'
% round a position to nearest (pixel + (.25,.25))

/SN {
	transform 
	.25 sub exch .25 sub exch
	round .25 add exch round .25 add exch
	itransform
} bind def
	
% endx endy startx starty DL -
% we round the endpoints of the line, so that parallel horizontal
% and vertical lines will appear even

/DL {
	SN
	moveto
	SN
	lineto stroke
} bind def

% centerx centery radius DC -

/DC {
	newpath 0 360 arc closepath
} bind def


/TM matrix def

%  width height centerx centery DE -

/DE {
	TM currentmatrix pop
	translate scale newpath 0 0 .5 0 360 arc closepath
	TM setmatrix
} bind def

% these are for splines

/RC /rcurveto load def
/RL /rlineto load def
/ST /stroke load def
/MT /moveto load def
/CL /closepath load def

% fill the last path

% amount FL -

/FL {
	currentgray exch setgray fill setgray
} bind def

% fill with the ``current color''

/BL /fill load def

/LW /setlinewidth load def
% new_font_name encoding_vector old_font_name RE -

/RE {
	findfont
	dup maxlength dict begin
	{
		1 index /FID ne { def } { pop pop } ifelse
	} forall
	/Encoding exch def
	dup /FontName exch def
	currentdict end definefont pop
} bind def

/DEFS 0 def

% hpos vpos EBEGIN -

/EBEGIN {
	moveto
	DEFS begin
} bind def

/EEND /end load def

/CNT 0 def
/level1 0 def

% llx lly newwid wid newht ht newllx newlly PBEGIN -

/PBEGIN {
	/level1 save def
	translate
	div 3 1 roll div exch scale
	neg exch neg exch translate
	% set the graphics state to default values
	0 setgray
	0 setlinecap
	1 setlinewidth
	0 setlinejoin
	10 setmiterlimit
	[] 0 setdash
	/setstrokeadjust where {
		pop
		false setstrokeadjust
	} if
	/setoverprint where {
		pop
		false setoverprint
	} if
	newpath
	/CNT countdictstack def
	userdict begin
	/showpage {} def
} bind def

/PEND {
	clear
	countdictstack CNT sub { end } repeat
	level1 restore
} bind def

end def

/setpacking where {
	pop
	setpacking
} if
%%EndResource
%%IncludeResource: font Times-Bold
%%IncludeResource: font Times-Italic
%%IncludeResource: font Times-Roman
grops begin/DEFS 1 dict def DEFS begin/u{.001 mul}bind def end/RES 72 def/PL
792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron/scaron/zcaron
/Ydieresis/trademark/quotesingle/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/space
/exclam/quotedbl/numbersign/dollar/percent/ampersand/quoteright/parenleft
/parenright/asterisk/plus/comma/hyphen/period/slash/zero/one/two/three/four
/five/six/seven/eight/nine/colon/semicolon/less/equal/greater/question/at/A/B/C
/D/E/F/G/H/I/J/K/L/M/N/O/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash
/bracketright/circumflex/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q
/r/s/t/u/v/w/x/y/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase
/guillemotleft/guillemotright/bullet/florin/fraction/perthousand/dagger
/daggerdbl/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen/brokenbar
/section/dieresis/copyright/ordfeminine/guilsinglleft/logicalnot/minus
/registered/macron/degree/plusminus/twosuperior/threesuperior/acute/mu
/paragraph/periodcentered/cedilla/onesuperior/ordmasculine/guilsinglright
/onequarter/onehalf/threequarters/questiondown/Agrave/Aacute/Acircumflex/Atilde
/Adieresis/Aring/AE/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute
/Icircumflex/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn/germandbls
/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla/egrave/eacute
/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis/eth/ntilde/ograve
/oacute/ocircumflex/otilde/odieresis/divide/oslash/ugrave/uacute/ucircumflex
/udieresis/yacute/thorn/ydieresis]def/Times-Roman@0 ENC0/Times-Roman RE
/Times-Italic@0 ENC0/Times-Italic RE/Times-Bold@0 ENC0/Times-Bold RE
%%EndProlog
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Bold@0 SF(Ho)204.894 123 Q 3(wT)-.12 G 3(oW)238.674 123 S
(rite a Setuid Pr)259.674 123 Q(ogram)-.216 E/F1 10/Times-Italic@0 SF
(Matt Bishop)263.415 162 Q/F2 10/Times-Roman@0 SF(Research Institute for Adv)
185.51 192 Q(anced Computer Science)-.25 E -.35(NA)227.495 216 S
(SA Ames Research Center).35 E(Mof)236.875 240 Q(fett Field, CA)-.25 E(94035)5
E F1(ABSTRA)264.535 288 Q(CT)-.3 E/F3 11/Times-Roman@0 SF(UNIX)133 316 Q/F4 12
/Times-Roman@0 SF 4.926<8773>C 1.926(ystems allo)176.083 316 R 4.925(wc)-.3 G
1.925(ertain programs to grant pri)250.962 316 R(vile)-.3 E 1.925(ges to users)
-.18 F .084(temporarily; these are called setuid programs.)108 332 R .084
(Because the)6.084 F 3.084(ye)-.18 G .084(xplicitly vio-)405.576 332 R 1.158
(late the protection scheme designed into)108 348 R F3(UNIX)4.158 E F4 4.158
(,t)C(he)348.903 348 Q 4.158(ya)-.18 G 1.157(re among the most)375.537 348 R
(dif)108 364 Q 1.119(\214cult programs to write.)-.3 F 1.119
(This paper discusses ho)7.119 F 4.119(wt)-.3 G 4.12(ow)380.328 364 S 1.12
(rite these pro-)399.112 364 R 1.413(grams to mak)108 380 R 4.413(eu)-.12 G
1.412(sing them to compromise a)191.775 380 R F3(UNIX)4.412 E F4 1.412
(system as dif)4.412 F 1.412(\214cult as)-.3 F(possible.)108 396 Q F0(Intr)72
440 Q(oduction)-.216 E F4 3.781(At)97 475.6 S .782
(ypical problem in systems programming is often posed as a problem of k)112.781
475.6 R(eeping)-.12 E .881(records [1].)72 507.6 R .881
(Suppose someone has written a program and wishes to k)6.881 F .88
(eep a record of its)-.12 F 3.453(use. This)72 539.6 R .453
(\214le, which we shall call the)3.453 F/F5 12/Times-Italic@0 SF .453
(history \214le)3.453 F F4 3.453(,m)C .453
(ust be writable by the program \(so it)326.514 539.6 R 1.591(can be k)72 571.6
R 1.591(ept up to date\), b)-.12 F 1.591(ut not by an)-.24 F 1.59
(yone else \(so that the entries in it are accurate.\))-.18 F F3(UNIX)72 603.6
Q F4(solv)3.206 E .206(es this problem by pro)-.18 F .206(viding tw)-.18 F
3.206(os)-.12 G .206(ets of identi\214cations for processes.)290.123 603.6 R
.207(The \214rst)6.206 F .682(set, called the)72 635.6 R F5 -.444(re)3.682 G
(al).444 E F4 .681
(user identi\214cation and group identi\214cation \(or UID and GID, respec-)
5.682 F(ti)72 667.6 Q -.18(ve)-.3 G .254
(ly\), indicate the real user of the process.).18 F .254
(The second set, called the)6.254 F F5(ef)3.254 E(fective)-.216 E F4 .254
(UID and)5.254 F .094
(GID, indicate what rights the process has, which may be, and often are, dif)72
699.6 R .093(ferent from the)-.3 F .32 LW 76 709.6 72 709.6 DL 80 709.6 76
709.6 DL 84 709.6 80 709.6 DL 88 709.6 84 709.6 DL 92 709.6 88 709.6 DL 96
709.6 92 709.6 DL 100 709.6 96 709.6 DL 104 709.6 100 709.6 DL 108 709.6 104
709.6 DL 112 709.6 108 709.6 DL 116 709.6 112 709.6 DL 120 709.6 116 709.6 DL
124 709.6 120 709.6 DL 128 709.6 124 709.6 DL 132 709.6 128 709.6 DL 136 709.6
132 709.6 DL 140 709.6 136 709.6 DL 144 709.6 140 709.6 DL/F6 8/Times-Roman@0
SF<87>72 719.6 Q/F7 7/Times-Roman@0 SF(UNIX)2 E F6
(is a trademark of Bell Laboratories.)2 E EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-2-)278.004 52 S .842(real UID and GID.)72 88 R .843
(The protection mask of the \214le which, when e)6.842 F -.18(xe)-.18 G .843
(cuted, produces the).18 F 1.296(process contains a bit which is called the)72
120 R/F1 12/Times-Italic@0 SF(setuid)4.296 E F0 4.295(bit. \(There)6.295 F
1.295(is another such bit for the)4.295 F(ef)72 152 Q(fecti)-.3 E 1.285 -.18
(ve G)-.3 H 3.925(ID.\) If).18 F .925(that bit is not set, the ef)3.925 F
(fecti)-.3 E 1.285 -.18(ve U)-.3 H .926(ID of the process will be that of the)
.18 F .469(person e)72 184 R -.18(xe)-.18 G .469(cuting the \214le; b).18 F
.469(ut if the setuid bit is set \(so the program runs in)-.24 F F1 .468
(setuid mode)3.468 F F0(\),)A .251(the ef)72 216 R(fecti)-.3 E .611 -.18(ve U)
-.3 H .251(ID will be that of the o).18 F .252
(wner of the \214le, not that of the person e)-.3 F -.18(xe)-.18 G .252
(cuting the).18 F 3.23(\214le. In)72 248 R .229
(either case, the real UID and GID are those of the person e)3.23 F -.18(xe)
-.18 G .229(cuting the \214le.).18 F .229(So if)6.229 F .072(only the o)72 280
R .072(wner of the history \214le \(who is the user with the same UID as the \
\214le\) can write)-.3 F .853(on it, the setuid bit of the \214le containing t\
he program is turned on, and the UIDs of this)72 312 R .782(\214le and the his\
tory \214le are the same, then when someone runs the program, that process)72
344 R(can write into the history \214le.)72 376 Q .152
(These programs are called)97 411.6 R F1 .152(setuid pr)3.152 F -.12(og)-.54 G
-.18(ra).12 G(ms).18 E F0 3.151(,a)2 G .151(nd e)318.023 411.6 R .151
(xist to allo)-.18 F 3.151(wo)-.3 G .151(rdinary users to per)406.815 411.6 R
(-)-.24 E .477(form functions which the)72 443.6 R 3.477(yc)-.18 G .477
(ould not perform otherwise.)209.04 443.6 R -.48(Wi)6.477 G .477
(thout them, man).48 F(y)-.18 E/F2 11/Times-Roman@0 SF(UNIX)3.478 E F0(sys-)
3.478 E .772(tems w)72 475.6 R .772(ould be quite unusable.)-.12 F .772(An e)
6.772 F .771(xample of a setuid program performing an essential)-.18 F .991
(function is a program which lists the acti)72 507.6 R 1.351 -.18(ve p)-.3 H
.991(rocesses on a system with protected mem-).18 F(ory)72 539.6 Q 6.348(.S)
-.78 G .348(ince memory is protected, normally only the pri)103.236 539.6 R
(vile)-.3 E .347(ged user)-.18 F F1 -.54(ro)3.347 G(ot).54 E F0 .347
(could scan mem-)5.347 F .028(ory to list these processes.)72 571.6 R(Ho)6.028
E(we)-.3 E -.18(ve)-.3 G .988 -.48(r, t).18 H .028(his w).48 F .028(ould pre)
-.12 F -.18(ve)-.3 G .028(nt other users from k).18 F .029(eeping track of)-.12
F .109(their jobs.)72 603.6 R .108
(As with the history \214le, the solution is to use a setuid program, with)
6.109 F F1 -.54(ro)3.108 G(ot).54 E F0(pri)5.108 E(v-)-.3 E(ile)72 635.6 Q
(ges, to read memory and list the acti)-.18 E .36 -.18(ve p)-.3 H(rocesses.).18
E 2.938
(This paper discusses the security problems introduced by setuid programs, and)
97 671.2 R(of)72 703.2 Q .086(fers suggestions on methods of programming to re\
duce, or eliminate, these threats.)-.3 F(The)6.086 E .417
(reader should bear in mind that on some systems, the mere e)72 735.2 R .417
(xistence of a setuid program)-.18 F EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-3-)278.004 52 S(introduces security holes; ho)72 88
Q(we)-.3 E -.18(ve)-.3 G .96 -.48(r, i).18 H 3(ti).48 G 3(sp)256.716 88 S
(ossible to eliminate the ob)270.384 88 Q(vious ones.)-.18 E/F1 12/Times-Bold@0
SF(Attacks)72 136 Q F0 .143(Before we discuss the w)97 171.6 R .143
(ays to deal with the security problems, let us look at the tw)-.12 F(o)-.12 E
.334(main types of attacks setuid programs can cause.)72 203.6 R .334
(The \214rst in)6.334 F -.24(vo)-.48 G(lv).24 E .334(es e)-.18 F -.18(xe)-.18 G
.335(cuting a sequence).18 F .598(of commands de\214ned by the attack)72 235.6
R .598(er \(either interacti)-.12 F -.18(ve)-.3 G .597
(ly or via a script\), and the second).18 F(substituting data of the attack)72
267.6 Q(er')-.12 E 3(sc)-.66 G(hoosing for data created by a program.)238.86
267.6 Q .431(In the \214rst, an attack)97 303.2 R .432(er tak)-.12 F .432
(es adv)-.12 F .432(antage of the setuid program')-.3 F 3.432(sr)-.66 G .432
(unning with special)409.14 303.2 R(pri)72 335.2 Q(vile)-.3 E .952
(ges to force it to e)-.18 F -.18(xe)-.18 G .952(cute whate).18 F -.18(ve)-.3 G
3.952(rc).18 G .952(ommands he w)281.62 335.2 R 3.951(ants. As)-.12 F .951
(an e)3.951 F .951(xample, suppose)-.18 F .277(an attack)72 367.2 R .277
(er found a cop)-.12 F 3.277(yo)-.12 G 3.277(ft)200.105 367.2 S .277
(he Bourne shell)210.714 367.2 R/F2 12/Times-Italic@0 SF(sh)3.277 E F0 .277
(\(1\)\207 that w)2 F .277(as setuid to)-.12 F F2 -.54(ro)3.278 G(ot).54 E F0
6.278(.T)2 G .278(he attack)451.534 367.2 R(er)-.12 E .977(could then e)72
399.2 R -.18(xe)-.18 G .977(cute the shell, and \255 since the shell w).18 F
.977(ould be interacti)-.12 F 1.336 -.18(ve \255 t)-.3 H .976(ype whate).18 F
-.18(ve)-.3 G(r).18 E .338(commands he desired.)72 431.2 R .338
(As the shell is setuid to)6.338 F F2 -.54(ro)3.338 G(ot).54 E F0 3.338(,t)2 G
.338(hese commands w)333.832 431.2 R .338(ould be e)-.12 F -.18(xe)-.18 G
(cuted).18 E 1.263(as though)72 463.2 R F2 -.54(ro)4.263 G(ot).54 E F0 1.263
(had typed them.)6.263 F 1.263(Thus, the attack)7.263 F 1.263(er could do an)
-.12 F 1.263(ything he w)-.18 F 1.262(anted, since)-.12 F F2 -.54(ro)72 495.2 S
(ot).54 E F0 .619(is the most highly pri)5.619 F(vile)-.3 E .619
(ged user on the system.)-.18 F(Ev)6.619 E .619
(en if the shell were changed to)-.18 F .157
(read from a command \214le \(called a)72 527.2 R F2(script)3.156 E F0 3.156
(\)r)2 G .156(ather than accept commands interacti)284.532 527.2 R -.18(ve)-.3
G(ly).18 E 3.156(,t)-.78 G(he)492.672 527.2 Q(attack)72 559.2 Q .415
(er could simply create his o)-.12 F .416
(wn script and run the shell using it.)-.3 F .416(This is an e)6.416 F(xample)
-.18 E 1.132(of something that should be a)72 591.2 R -.24(vo)-.24 G 1.132
(ided, and sounds lik).24 F 4.132(ei)-.12 G 4.131(ti)342.912 591.2 S 4.131(se)
353.715 591.2 S 1.131(asy to a)367.842 591.2 R -.24(vo)-.24 G 1.131(id \255 b)
.24 F 1.131(ut it occurs)-.24 F(surprisingly often.)72 623.2 Q .4 LW 77 640.4
72 640.4 DL 79 640.4 74 640.4 DL 84 640.4 79 640.4 DL 89 640.4 84 640.4 DL 94
640.4 89 640.4 DL 99 640.4 94 640.4 DL 104 640.4 99 640.4 DL 109 640.4 104
640.4 DL 114 640.4 109 640.4 DL 119 640.4 114 640.4 DL 124 640.4 119 640.4 DL
129 640.4 124 640.4 DL 134 640.4 129 640.4 DL 139 640.4 134 640.4 DL 144 640.4
139 640.4 DL/F3 10/Times-Roman@0 SF 5<8754>72 656 S .145
(he usual notation for referencing)88.11 656 R/F4 9/Times-Roman@0 SF(UNIX)2.645
E F3 .146(commands is to put the name of the command in italics, and the)2.645
F .287(\214rst time the name appears in a document, to follo)82 668 R 2.786(wi)
-.25 G 2.786(tb)298.205 668 S 2.786(yt)308.771 668 S .286
(he section number of the)319.337 668 R/F5 9/Times-Italic@0 SF(UNIX)2.786 E/F6
10/Times-Italic@0 SF(Pr)2.786 E -.1(og)-.45 G -.15(ra).1 G(mmer).15 E(s')-.1 E
(Manual)82 680 Q F3 .087
(in which it appears; this number is enclosed in parentheses.)2.587 F .088
(There are tw)5.088 F 2.588(ov)-.1 G .088(ersions of the manu-)421.806 680 R
.194(al referred to in this paper)82 692 R 2.694(,o)-.4 G .194(ne for 4.2 BSD)
196.344 692 R F4(UNIX)2.693 E F3 .193([2], and one for System V)2.693 F F4
(UNIX)2.693 E F3 2.693([3]. Most)2.693 F(commands)2.693 E(are in the same sect\
ion in both manuals; when this is not true, the section for each manual will b\
e gi)82 704 Q -.15(ve)-.25 G(n.).15 E EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-4-)278.004 52 S .031(One w)97 88 R .031
(ay such an attack w)-.12 F .031(as performed pro)-.12 F .032
(vides a classic e)-.18 F .032(xample of wh)-.18 F 3.032(yo)-.06 G .032
(ne needs)462.316 88 R .218(to be careful when designing system programs.)72
120 R(A)6.217 E/F1 11/Times-Roman@0 SF(UNIX)3.217 E F0 .217(utility called)
3.217 F/F2 12/Times-Italic@0 SF(at)3.217 E F0 .217(\(1\) gi)2 F -.18(ve)-.3 G
3.217(so).18 G .217(ne the)474.791 120 R .3(capability to ha)72 152 R .66 -.18
(ve a c)-.24 H .3(ommand \214le e).18 F -.18(xe)-.18 G .3
(cuted at a speci\214ed time; the).18 F F2(at)3.301 E F0 .301
(program spools the)5.301 F .47(command \214le and a daemon e)72 184 R -.18(xe)
-.18 G .47(cutes it at the appropriate time.).18 F .469(The daemon determined)
6.47 F 1.248(when to e)72 216 R -.18(xe)-.18 G 1.249
(cute the command \214le by the name under which it w).18 F 1.249(as spooled.)
-.12 F(Ho)7.249 E(we)-.3 E -.18(ve)-.3 G -.48(r,).18 G 1.036
(the daemon assumed the o)72 248 R 1.035(wner of the command \214le w)-.3 F
1.035(as the person who requested that)-.12 F .812(script to be e)72 280 R -.18
(xe)-.18 G .813(cuted; hence, if one could \214nd a w).18 F .813
(orld-writable \214le o)-.12 F .813(wned by another in)-.3 F 2.47
(the appropriate directory)72 312 R 5.47(,o)-.78 G 2.47(ne could run man)
209.262 312 R 5.47(yc)-.18 G 2.47(ommands with the other')316.942 312 R 5.469
(sp)-.66 G(ri)460.152 312 Q(vile)-.3 E(ges.)-.18 E 1.821(Cases lik)72 344 R
4.821(et)-.12 G 1.821
(his are the reason much of the emphasis on writing good setuid programs)
130.854 344 R(in)72 376 Q -.24(vo)-.48 G(lv).24 E(es being v)-.18 E
(ery sure those programs do not create w)-.18 E
(orld-writable \214les by accident.)-.12 E .502(There are other)97 411.6 R
3.501(,m)-.48 G .501(ore subtle, problems with w)186.657 411.6 R .501
(orld-writable \214les.)-.12 F .501(Occasionally pro-)6.501 F .49
(grams will use temporary \214les for v)72 443.6 R .49
(arious purposes, the function of the program depend-)-.3 F .23
(ing on what is in the \214le.)72 475.6 R .23
(\(These programs need not be setuid to an)6.23 F 3.23(yone.\) If)-.18 F .23
(the program)3.23 F .243(closes the temporary \214le at an)72 507.6 R 3.243(yp)
-.18 G .243(oint and then reopens it later)231.918 507.6 R 3.243(,a)-.48 G
3.243(na)381.204 507.6 S(ttack)395.775 507.6 Q .243(er can replace the)-.12 F
.227(temporary \214le with a \214le with other data that will cause the progra\
m to act as the attack)72 539.6 R(er)-.12 E 3.129(desires. If)72 571.6 R .129
(the replacement \214le has the same o)3.129 F .129
(wner and group as the temporary \214le, it can)-.3 F(be v)72 603.6 Q(ery dif)
-.18 E(\214cult for the program to determine if it is being spoofed.)-.3 E
1.377(Setuid programs create the conditions under which the tools needed for t\
hese tw)97 639.2 R(o)-.12 E 1.847(attacks can be made.)72 671.2 R 1.847
(That does not mean those tools will be made; with attention to)7.847 F .607
(detail, programmers and system administrators can pre)72 703.2 R -.18(ve)-.3 G
.606(nt an attack).18 F .606(er from using setuid)-.12 F .562
(programs to compromise the system in these w)72 735.2 R 3.562(ays. In)-.12 F
.562(order to pro)3.562 F .563(vide some conte)-.18 F .563(xt for)-.18 F EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-5-)278.004 52 S .403
(discussion, we should look at the w)72 88 R .403
(ays in which setuid programs interact with their en)-.12 F(vi-)-.48 E
(ronment.)72 120 Q/F1 12/Times-Bold@0 SF(Thr)72 168 Q(eats fr)-.216 E
(om the En)-.216 E(vir)-.48 E(onment)-.216 E F0 1.058(The term)97 203.6 R/F2 12
/Times-Italic@0 SF(en)4.058 E(vir)-.48 E(onment)-.54 E F0 1.058
(refers to the milieu in which a process e)6.058 F -.18(xe)-.18 G 4.058
(cutes. Attrib).18 F(utes)-.24 E 1.322(of the en)72 235.6 R 1.322
(vironment rele)-.48 F -.3(va)-.3 G 1.322
(nt to this discussion are the UID and GID of the process, the).3 F 1.191
(\214les that the process opens, and the list of en)72 267.6 R 1.192
(vironment v)-.48 F 1.192(ariables pro)-.3 F 1.192(vided by the com-)-.18 F
.069(mand interpreter under which the process e)72 299.6 R -.18(xe)-.18 G 3.069
(cutes. When).18 F 3.069(ap)3.069 G .069(rocess creates a subprocess,)370.509
299.6 R(all these attrib)72 331.6 Q
(utes are inherited unless speci\214cally reset.)-.24 E
(This can lead to problems.)6 E F2(Be as Restrictive as P)145.158 379.6 Q
(ossible in Choosing the UID and GID)-.96 E F0 .878(The basic rule of computer\
 security is to minimize damage resulting from a break-)97 415.2 R 3.798(in. F)
72 447.2 R .798
(or this reason, when creating a setuid program, it should be gi)-.18 F -.18
(ve)-.3 G 3.797(nt).18 G .797(he least danger)426.674 447.2 R(-)-.24 E 1.799
(ous UID and GID possible.)72 479.2 R 1.799(If, for e)7.799 F 1.799(xample, g)
-.18 F 1.8(ame programs were setuid to)-.06 F F2 -.54(ro)4.8 G(ot).54 E F0 4.8
(,a)2 G(nd)492 479.2 Q .471(there were a w)72 511.2 R .471
(ay to get a shell with)-.12 F F2 -.54(ro)3.471 G(ot).54 E F0(pri)5.471 E(vile)
-.3 E .471(ges from within a g)-.18 F .471(ame, the g)-.06 F .471(ame player)
-.06 F .25(could compromise the entire computer system.)72 543.2 R .25(It w)
6.25 F .25(ould be f)-.12 F .251(ar safer to ha)-.12 F .611 -.18(ve a u)-.24 H
.251(ser called).18 F F2(games)72 575.2 Q F0 .441(and run the g)5.441 F .441
(ame programs setuid to that user)-.06 F 6.441(.T)-.66 G .441
(hen, if there were a w)346.982 575.2 R .44(ay to get a)-.12 F .587
(shell from within a g)72 607.2 R .587(ame, at w)-.06 F .587(orst it w)-.12 F
.588(ould be setuid to)-.12 F F2(games)3.588 E F0 .588(and only g)5.588 F .588
(ame programs)-.06 F(could be compromised.)72 639.2 Q
(Related to this is the ne)97 674.8 Q(xt rule.)-.18 E EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-6-)278.004 52 S/F1 12/Times-Italic@0 SF(Reset Ef)
186.03 88 Q(fective UIDs Befor)-.216 E 3(eC)-.444 G(alling)331.338 88 Q F0 -.18
(exe)3 G(c).18 E F1<87>A F0 1.578(Resetting the ef)97 123.6 R(fecti)-.3 E 1.938
-.18(ve U)-.3 H 1.578(ID and GID before calling).18 F F1 -.24(ex)4.579 G(ec).24
E F0 1.579(seems ob)6.579 F 1.579(vious, b)-.18 F 1.579(ut it is)-.24 F 1.266
(often o)72 155.6 R -.18(ve)-.18 G(rlook).18 E 4.266(ed. When)-.12 F 1.265
(it is, the user may \214nd himself running a program with une)4.265 F(x-)-.18
E 1.281(pected pri)72 187.6 R(vile)-.3 E 4.281(ges. This)-.18 F 1.281
(happened once at a site which had its g)4.281 F 1.282(ame programs setuid to)
-.06 F F1 -.54(ro)72 219.6 S(ot).54 E F0 3.528(;u)2 G(nfortunately)106.328
219.6 Q 3.528(,s)-.78 G .528(ome of the g)175.4 219.6 R .528(ames allo)-.06 F
.527(wed the user to run subshells from within the)-.3 F -.06(ga)72 251.6 S 3
(mes. Needless).06 F(to say)3 E 3(,t)-.78 G(his problem w)194.808 251.6 Q
(as \214x)-.12 E(ed the day it w)-.18 E(as disco)-.12 E -.18(ve)-.18 G(red!).18
E 1.65(One dif)97 287.2 R 1.65(\214culty for man)-.3 F 4.65(yp)-.18 G 1.65
(rogrammers is that)225.772 287.2 R F1 -.24(ex)4.65 G(ec).24 E F0 1.651
(is often called within a library)6.651 F .41(subroutine such as)72 319.2 R F1
(popen)3.41 E F0 .41(\(3\) or)2 F F1(system)3.41 E F0 .409
(\(3\) and that the programmer is either not a)2 F -.12(wa)-.18 G .409(re of)
.12 F .606(this, or for)72 351.2 R .606
(gets that these functions do not reset the ef)-.216 F(fecti)-.3 E .967 -.18
(ve U)-.3 H .607(IDs and GIDs before call-).18 F(ing)72 383.2 Q F1 -.24(ex)
4.036 G(ec).24 E F0 7.036(.W)2 G(hene)135.808 383.2 Q -.18(ve)-.3 G 4.036(rc)
.18 G 1.036(alling a routine that is designed to e)182.672 383.2 R -.18(xe)-.18
G 1.035(cute a command as though).18 F 1.585(that command were typed at the k)
72 415.2 R -.18(ey)-.12 G 1.585(board, the ef).18 F(fecti)-.3 E 1.945 -.18
(ve U)-.3 H 1.585(ID and GID should be reset).18 F
(unless there is a speci\214c reason not to.)72 447.2 Q F1
(Close All But Necessary F)140.076 495.2 Q(ile Descriptor)-.54 E 3(sB)-.12 G
(efor)348.072 495.2 Q 3(eC)-.444 G(alling)383.292 495.2 Q F0 -.18(exe)3 G(c).18
E 1.673(This is another requirement that most setuid programs o)97 530.8 R -.18
(ve)-.18 G 4.673(rlook. The).18 F 1.673(problem of)4.673 F -.12(fa)72 562.8 S
1.509(iling to do this becomes especially acute when the program being).12 F F1
-.24(ex)4.509 G(ec).24 E F0 1.509('ed may be a)2 F .497
(user program rather than a system one.)72 594.8 R .497(If, for e)6.497 F .497
(xample, the setuid program were reading)-.18 F 3.087(as)72 626.8 S(ensiti)
85.083 626.8 Q .447 -.18(ve \214)-.3 H .087
(le, and that \214le had descriptor number 9, then an).18 F(y)-.18 E F1 -.24
(ex)3.088 G(ec).24 E F0 .088(ed program could also)2 F 2.046(read the sensiti)
72 658.8 R 2.406 -.18(ve \214)-.3 H 2.046(le \(because, as the manual page w)
.18 F 2.045(arns, `)-.12 F 2.045(`[d]escriptors open in the)-.888 F .4 LW 77
676.4 72 676.4 DL 79 676.4 74 676.4 DL 84 676.4 79 676.4 DL 89 676.4 84 676.4
DL 94 676.4 89 676.4 DL 99 676.4 94 676.4 DL 104 676.4 99 676.4 DL 109 676.4
104 676.4 DL 114 676.4 109 676.4 DL 119 676.4 114 676.4 DL 124 676.4 119 676.4
DL 129 676.4 124 676.4 DL 134 676.4 129 676.4 DL 139 676.4 134 676.4 DL 144
676.4 139 676.4 DL/F2 10/Times-Roman@0 SF<87>72 692 Q/F3 10/Times-Italic@0 SF
(Exec)5 E F2 .213(is a generic term for a number of system and library calls; \
these are described by the manual pages)4.38 F F3 -.2(ex)82 704 S(ec).2 E F2
(\(2\) in the System V manual and)1.666 E F3 -.2(ex)2.5 G(ecve).2 E F2
(\(2\) and)1.666 E F3 -.2(ex)2.5 G(ecl).2 E F2(\(3\) in the 4.2 BSD manual.)
1.666 E EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-7-)278.004 52 S
(calling process remain open in the ne)72 88 Q 3(wp)-.3 G(rocess ...)267.996 88
Q -.888('')-.84 G(\)).888 E .524(The easiest w)97 123.6 R .524(ay to pre)-.12 F
-.18(ve)-.3 G .524(nt this is to set a \215ag indicating that a sensiti).18 F
.885 -.18(ve \214)-.3 H .525(le is to be).18 F 1.217(closed whene)72 155.6 R
-.18(ve)-.3 G 4.217(ra).18 G(n)162.586 155.6 Q/F1 12/Times-Italic@0 SF -.24(ex)
4.217 G(ec).24 E F0 4.217(occurs. The)6.217 F 1.217
(\215ag should be set immediately after opening the)4.217 F 3.238(\214le. Let)
72 187.6 R .238(the sensiti)3.238 F .598 -.18(ve \214)-.3 H(le').18 E 3.239(sd)
-.66 G .239(escriptor be)211.047 187.6 R F1(sfd)3.239 E F0 6.239(.I)2 G 3.239
(nb)300.08 187.6 S .239(oth System V and 4.2 BSD, the system)315.319 187.6 R
(call)72 219.6 Q(fcntl\()232.332 257.6 Q F1(sfd)A F0 3(,F)C(_SETFD, 1\))285
257.6 Q(will cause the \214le to close across)72 279.6 Q F1 -.24(ex)3 G(ec).24
E F0(s; in both V)2 E(ersion 7 and 4.2 BSD, the call)-1.332 E(ioctl\()219.006
317.6 Q F1(sfd)A F0 3(,F)C(IOCLEX, NULL\))271.014 317.6 Q(will ha)72 339.6 Q
.36 -.18(ve t)-.24 H(he same ef).18 E 3(fect. \(See)-.3 F F1(fcntl)3 E F0
(\(2\) and)2 E F1(ioctl)3 E F0(\(2\) for more information.\))2 E F1(Be Sur)
186.9 387.6 Q 3(eaR)-.444 G(estricted Root Really Restricts)243.444 387.6 Q F0
(The)97 423.2 Q F1 -.18(ch)3.785 G -.54(ro).18 G(ot).54 E F0 .785
(\(2\) system call, which may be used only by)2 F F1 -.54(ro)3.784 G(ot).54 E
F0 3.784(,w)2 G .784(ill force the process)407.34 423.2 R(to treat the ar)72
455.2 Q(gument directory as the root of the \214le system.)-.216 E -.18(Fo)6 G
3(re).18 G(xample, the call)389.712 455.2 Q(chroot\(`)239.574 493.2 Q
(`/usr/riacs')-.888 E('\))-.888 E(mak)72 515.2 Q .177(es the root directory `)
-.12 F(`/usr/riacs')-.888 E 3.177('s)-.888 G 3.177(of)258.609 515.2 S .178
(ar as the process which e)271.662 515.2 R -.18(xe)-.18 G .178
(cuted the system call).18 F .011(is concerned.)72 547.2 R(Further)6.011 E
3.011(,t)-.48 G .011(he entry `)185.529 547.2 R(`..)-.888 E 1.787 -.888('' i)
-.84 H 3.01(nt).888 G .01(he ne)265.6 547.2 R 3.01(wr)-.3 G .01
(oot directory is interpreted as naming the)306.636 547.2 R(root directory)72
579.2 Q 6(.W)-.78 G(here symbolic links are a)157.2 579.2 Q -.3(va)-.24 G
(ilable, the).3 E 3(yt)-.18 G(oo are handled correctly)347.448 579.2 Q(.)-.78 E
(Ho)97 614.8 Q(we)-.3 E -.18(ve)-.3 G 1.126 -.48(r, i).18 H 3.166(ti).48 G
3.166(sp)159.06 614.8 S .166(ossible for)172.894 614.8 R F1 -.54(ro)3.166 G(ot)
.54 E F0 .167(to link directories just as an ordinary user links \214les.)5.166
F .723(This is not done often, because it creates loops in the)72 646.8 R/F2 11
/Times-Roman@0 SF(UNIX)3.723 E F0 .723(\214le system \(and that creates)3.723 F
.902(problems for man)72 678.8 R 3.902(yp)-.18 G .902(rograms\), b)174.846
678.8 R .902(ut it does occasionally occur)-.24 F 6.902(.T)-.66 G .902
(hese directory links can)387.654 678.8 R .603(be follo)72 710.8 R .603(wed re)
-.3 F -.06(ga)-.18 G .603(rdless of whether the).06 F 3.603(yr)-.18 G .602
(emain in the subtree with the restricted root.)268.842 710.8 R -.96(To)6.602 G
EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-8-)278.004 52 S 3.63(continue the e)72 88 R 3.63
(xample abo)-.18 F -.18(ve)-.18 G 6.63(,i).18 G 6.63(f`)229.62 88 S
(`/usr/demo')243.354 88 Q 6.63('w)-.888 G 3.63(ere link)317.748 88 R 3.63
(ed to `)-.12 F(`/usr/riacs/demo')-.888 E 3.63(', the)-.888 F
(sequence of commands)72 120 Q(cd /demo)265.836 158 Q(cd ..)265.836 174 Q -.12
(wo)72 196 S 1.105(uld mak).12 F 4.105(et)-.12 G 1.105(he current w)139.298 196
R 1.105(orking directory be `)-.12 F(`/usr')-.888 E 4.105('. Using)-.888 F
(relati)4.105 E 1.465 -.18(ve p)-.3 H 1.105(ath names at this).18 F .344
(point \(since an initial `)72 228 R(`/')-.888 E 3.344('i)-.888 G 3.344(si)
202.264 228 S .344(nterpreted as `)213.612 228 R(`/usr/riacs')-.888 E .344
('\), the user could access an)-.888 F 3.344<798c>-.18 G .344(le on)479.992 228
R 1.149(the system.)72 260 R 1.149
(Therefore, when using this call, one must be certain that no directories are)
7.149 F(link)72 292 Q(ed to an)-.12 E 3(yo)-.18 G 3(ft)143.364 292 S
(he descendants of the ne)153.696 292 Q 3(wr)-.3 G(oot.)286.356 292 Q/F1 12
/Times-Italic@0 SF(Chec)157.674 340 Q 3(kt)-.24 G(he En)193.758 340 Q(vir)-.48
E(onment In Whic)-.54 E 3(ht)-.18 G(he Pr)321.87 340 Q(ocess W)-.54 E(ill Run)
-.66 E F0 .877(The en)97 375.6 R .877(vironment to a lar)-.48 F .878(ge de)
-.216 F .878(gree depends upon certain v)-.18 F .878(ariables which are inher)
-.3 F(-)-.24 E 1.083(ited from the parent process.)72 407.6 R 1.083
(Among these are the v)7.083 F(ariables)-.3 E/F2 12/Times-Bold@0 SF -.888(PA)
4.083 G(TH)-.252 E F0 1.082(\(which controls the)4.082 F .298
(order and names of directories searched by the shell for programs to be e)72
439.6 R -.18(xe)-.18 G(cuted\),).18 E F2(IFS)3.299 E F0(\(a)3.299 E 1.378
(list of characters which are treated as w)72 471.6 R 1.377
(ord separators\), and the parent')-.12 F(s)-.66 E F1(umask)4.377 E F0 4.377
(,w)2 G(hich)483.336 471.6 Q
(controls the protection mode of \214les that the subprocess creates.)72 503.6
Q 1.503(One of the more insidious threats comes from routines which rely on th\
e shell to)97 539.2 R -.18(exe)72 571.2 S .895(cute a program.).18 F .895
(\(The routines to be w)6.895 F .895(ary of here are)-.12 F F1(popen)3.895 E F0
(,)2 E F1(system)3.895 E F0(,)2 E F1 -.24(ex)3.894 G(eclp).24 E F0 .894
(\(3\), and)2 F F1 -.24(ex)72 603.2 S(ecvp).24 E F0 3.954(\(3\)\207.\) The)2 F
.954(danger is that the shell will not e)3.954 F -.18(xe)-.18 G .955
(cute the program intended.).18 F .955(As an)6.955 F -.18(ex)72 635.2 S 1.677
(ample, suppose a program that is setuid to).18 F F1 -.54(ro)4.676 G(ot).54 E
F0(uses)6.676 E F1(popen)4.676 E F0 1.676(to e)6.676 F -.18(xe)-.18 G 1.676
(cute the program).18 F F1(print\214le)72 667.2 Q F0 7.082(.A)2 G(s)130.75
667.2 Q F1(popen)4.082 E F0 1.082(uses the shell to e)6.082 F -.18(xe)-.18 G
1.083(cute the command, all a user needs to do is to).18 F .4 LW 77 688.4 72
688.4 DL 79 688.4 74 688.4 DL 84 688.4 79 688.4 DL 89 688.4 84 688.4 DL 94
688.4 89 688.4 DL 99 688.4 94 688.4 DL 104 688.4 99 688.4 DL 109 688.4 104
688.4 DL 114 688.4 109 688.4 DL 119 688.4 114 688.4 DL 124 688.4 119 688.4 DL
129 688.4 124 688.4 DL 134 688.4 129 688.4 DL 139 688.4 134 688.4 DL 144 688.4
139 688.4 DL/F3 10/Times-Roman@0 SF<87>72 704 Q/F4 10/Times-Italic@0 SF -.2(ex)
5 G(eclp).2 E F3(and)4.166 E F4 -.2(ex)2.5 G(ecvp).2 E F3
(are in section 2 of the System V manual.)4.166 E EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-9-)278.004 52 S .211(alter his)72 88 R/F1 12
/Times-Bold@0 SF -.888(PA)3.211 G(TH)-.252 E F0(en)3.211 E .211(vironment v)
-.48 F .211(ariable so that a pri)-.3 F -.3(va)-.3 G .211
(te directory is check).3 F .21(ed before the sys-)-.12 F .778
(tem directories.)72 120 R .778(Then, he writes his o)6.778 F .779
(wn program called)-.3 F/F2 12/Times-Italic@0 SF(print\214le)3.779 E F0 .779
(and puts it in that pri-)5.779 F -.3(va)72 152 S 1.25(te directory).3 F 7.25
(.T)-.78 G 1.25(his pri)156.064 152 R -.3(va)-.3 G 1.25(te cop).3 F 4.25(yc)
-.12 G 1.25(an do an)244.078 152 R 1.25(ything he lik)-.18 F 4.25(es. When)-.12
F(the)4.25 E F2(popen)4.25 E F0 1.25(routine is)6.25 F -.18(exe)72 184 S
(cuted, his pri).18 E -.3(va)-.3 G(te cop).3 E 3(yo)-.12 G(f)205.224 184 Q F2
(print\214le)3 E F0(will be run, with)5 E F2 -.54(ro)3 G(ot).54 E F0(pri)5 E
(vile)-.3 E(ges.)-.18 E 1.006(On \214rst blush, limiting the path to a kno)97
219.6 R 1.006(wn, safe path w)-.3 F 1.007(ould seem to \214x the prob-)-.12 F
3.76(lem. Alas,)72 251.6 R .76(it does not.)3.76 F .76(When the Bourne shell)
6.76 F F2(sh)3.76 E F0 .76(is used, there is an en)5.76 F .76(vironment v)-.48
F(ari-)-.3 E(able)72 283.6 Q F1(IFS)3.358 E F0 .358
(which contains a list of characters that are to be treated as w)3.358 F .359
(ord separators.)-.12 F -.18(Fo)6.359 G(r).18 E -.18(ex)72 315.6 S .289
(ample, if).18 F F1(IFS)3.289 E F0 .288(is set to `)3.289 F(`o')-.888 E .288
(', then the shell command)-.888 F F2(show)3.288 E F0 .288
(\(which prints mail messages)5.288 F .416
(on the screen\) will be treated as the command)72 347.6 R F2(sh)3.416 E F0
.416(with one ar)5.416 F(gument)-.216 E F2(w)3.416 E F0 .417(\(since the `)
5.417 F(`o')-.888 E 3.417('i)-.888 G(s)499.332 347.6 Q .3
(treated as a blank.\))72 379.6 R .299
(Hence, one could force the setuid process to e)6.299 F -.18(xe)-.18 G .299
(cute a program other).18 F(than the one intended.)72 411.6 Q -.48(Wi)97 447.2
S .155(thin a setuid program, all subprograms should be in).48 F -.24(vo)-.48 G
-.12(ke).24 G 3.156(db).12 G 3.156(yt)397.056 447.2 S .156
(heir full path name,)409.548 447.2 R .594(or some path kno)72 479.2 R .594
(wn to be safe should be pre\214x)-.3 F .594(ed to the command; and the)-.18 F
F1(IFS)3.594 E F0 -.3(va)3.594 G(riable).3 E .452(should be e)72 511.2 R .452
(xplicitly set to the empty string \(which mak)-.18 F .453
(es white space the only command)-.12 F(separators.\))72 543.2 Q .321
(The danger from a badly-set)97 578.8 R F2(umask)3.321 E F0 .321(is that a w)
5.321 F .32(orld-writable \214le o)-.12 F .32(wned by the ef)-.3 F(fec-)-.3 E
(ti)72 610.8 Q .53 -.18(ve U)-.3 H .17(ID of a setuid process may be produced.)
.18 F .17(When a setuid process must write to a \214le)6.17 F -.3(ow)72 642.8 S
.042(ned by the person who is running the setuid program, and that \214le must\
 not be writable).3 F .234(by an)72 674.8 R .234(yone else, a subtle b)-.18 F
.234(ut nonetheless dangerous situation arises.)-.24 F .234
(The usual implemen-)6.234 F .295
(tation is for the process to create the \214le,)72 706.8 R F2 -.18(ch)3.295 G
(own).18 E F0 .295(\(2\) it to the real UID and real GID of the)2 F EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(0-)288 52 S .698
(process, and then write to it.)72 88 R(Ho)6.698 E(we)-.3 E -.18(ve)-.3 G 1.658
-.48(r, i).18 H 3.698(ft).48 G(he)281.62 88 Q/F1 12/Times-Italic@0 SF(umask)
3.698 E F0 .698(is set to 0, and the process is inter)5.698 F(-)-.24 E 1.399
(rupted after the \214le is created b)72 120 R 1.399(ut before it is)-.24 F F1
-.18(ch)4.399 G(own).18 E F0 1.399(ed the process will lea)2 F 1.759 -.18
(ve a w)-.24 H(orld-).06 E(writable \214le o)72 152 Q
(wned by the user who has the ef)-.3 E(fecti)-.3 E .36 -.18(ve U)-.3 H
(ID of the setuid process.).18 E .874(There are tw)97 187.6 R 3.875(ow)-.12 G
.875(ays to pre)177.684 187.6 R -.18(ve)-.3 G .875(nt this; the \214rst is f)
.18 F .875(airly simple, b)-.12 F .875(ut requires the ef)-.24 F(fec-)-.3 E(ti)
72 219.6 Q .97 -.18(ve U)-.3 H .61(ID to be that of).18 F F1 -.54(ro)3.61 G(ot)
.54 E F0 6.61(.\()2 G .609(The other method does not suf)216.234 219.6 R .609
(fer from this restriction; it is)-.3 F 1.051(described in a later section.\))
72 251.6 R(The)7.051 E F1(umask)4.051 E F0 1.051
(\(2\) system call can be used to reset the)2 F F1(umask)4.051 E F0 .011
(within the setuid process so that the \214le is at no time w)72 283.6 R .011
(orld-writable; this setting o)-.12 F -.18(ve)-.18 G(rrides).18 E(an)72 315.6 Q
4.768(yo)-.18 G(ther)99.916 315.6 Q 4.769(,p)-.48 G(re)131.865 315.6 Q 1.769
(vious settings.)-.3 F 1.769(Hence, simply reset)7.769 F F1(umask)4.769 E F0
1.769(to the desired v)6.769 F 1.769(alue \(such as)-.3 F 2.124(022, which pre)
72 347.6 R -.18(ve)-.3 G 2.123
(nts the \214le from being opened for writing by an).18 F 2.123
(yone other than the)-.18 F -.3(ow)72 379.6 S .631
(ner\) and then open the \214le.).3 F(\(The)6.631 E F1(umask)3.631 E F0 .631
(can be reset afterw)5.631 F .631(ards without af)-.12 F .632(fecting the)-.3 F
.829(mode of the opened \214le.\))72 411.6 R .829
(Upon return, the process can safely)6.829 F F1 -.18(ch)3.829 G(own).18 E F0
.829(the \214le to the real)5.829 F .143(UID and GID of the process.)72 443.6 R
(\(Incidentally)6.143 E 3.143(,o)-.78 G(nly)290.165 443.6 Q F1 -.54(ro)3.143 G
(ot).54 E F0(can)5.143 E F1 -.18(ch)3.143 G(own).18 E F0 3.143<618c>5.143 G
.143(le, which is wh)404.488 443.6 R 3.143(yt)-.06 G(his)489.996 443.6 Q .636
(method will not w)72 475.6 R .636(ork for programs the ef)-.12 F(fecti)-.3 E
.996 -.18(ve U)-.3 H .635(ID of which is not).18 F F1 -.54(ro)3.635 G(ot).54 E
F0 3.635(.\) Note)2 F .635(that if)3.635 F .476
(the process is interrupted between the)72 507.6 R F1(open)3.476 E F0 .476
(\(2\) and the)2 F F1 -.18(ch)3.476 G(own).18 E F0 .477
(the resulting \214le will ha)5.476 F -.18(ve)-.24 G .029
(the same UID and GID as the process' ef)72 539.6 R(fecti)-.3 E .388 -.18(ve U)
-.3 H .028(ID and GID, b).18 F .028(ut the person who ran the)-.24 F .856(proc\
ess will not be able to write to that \214le \(unless, of course, his UID and \
GID are the)72 571.6 R(same as the process' ef)72 603.6 Q(fecti)-.3 E .36 -.18
(ve U)-.3 H(ID and GID.\)).18 E .226(As a related problem,)97 639.2 R F1(umask)
3.226 E F0 .226(is often set to a dangerous v)5.226 F .225
(alue by the parent process;)-.3 F 5.645(for e)72 671.2 R 5.645
(xample, if a daemon is started at boot time \(from the \214le `)-.18 F
(`/etc/rc')-.888 E 8.646('o)-.888 G(r)500.004 671.2 Q -.888(``)72 703.2 S
(/etc/rc.local').888 E 1.275('\), its def)-.888 F(ault)-.12 E F1(umask)4.275 E
F0 1.275(will be 0.)6.275 F 1.275(Hence, an)7.275 F 4.275<798c>-.18 G 1.275
(les it creates will be created)364.667 703.2 R -.12(wo)72 735.2 S .964(rld-wr\
itable unless the protection mask used in the system call creating the \214le \
is set).12 F EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(1-)288 52 S(otherwise.)72 88 Q/F1
12/Times-Bold@0 SF(Pr)72 136 Q(ogramming Style)-.216 E F0 .991
(Although threats from the en)97 171.6 R .99
(vironment create a number of security holes, inappro-)-.48 F .925
(priate programming style creates man)72 203.6 R 3.925(ym)-.18 G 3.925
(ore. While)276.077 203.6 R(man)3.925 E 3.925(yo)-.18 G 3.925(ft)370.988 203.6
S .925(he problems in program-)382.245 203.6 R 1.229(ming style are f)72 235.6
R 1.228
(airly typical \(see [4] for a discussion of programming style in general\),)
-.12 F(some are unique to)72 267.6 Q/F2 11/Times-Roman@0 SF(UNIX)3 E F0
(and some to setuid programs.)3 E/F3 12/Times-Italic@0 SF(Do Not Write Interpr)
170.28 315.6 Q(eted Scripts That Ar)-.444 E 3(eS)-.444 G(etuid)381.72 315.6 Q
F0 1.514(Some v)97 351.2 R 1.514(ersions of)-.18 F F2(UNIX)4.514 E F0(allo)
4.514 E 4.515(wc)-.3 G 1.515(ommand scripts, such as shell scripts, to be made)
255.9 351.2 R 3.358(setuid. This)72 383.2 R .358
(is done by applying the setuid bit to the command interpreter used, and then)
3.358 F .769(interpreting the commands in the script.)72 415.2 R(Unfortunately)
6.769 E 3.769(,g)-.78 G -2.58 -.3(iv e)353.239 415.2 T 3.769(nt).3 G .769
(he po)380.528 415.2 R .769(wer and comple)-.3 F(xity)-.18 E .042(of man)72
447.2 R 3.042(yc)-.18 G .041(ommand interpreters, it is often possible to forc\
e them to perform actions which)119.892 447.2 R 1.087
(were not intended, and which allo)72 479.2 R 4.088(wt)-.3 G 1.088
(he user to violate system security)255.86 479.2 R 7.088(.T)-.78 G 1.088
(his lea)437.588 479.2 R -.18(ve)-.24 G 4.088(st).18 G(he)492.672 479.2 Q -.3
(ow)72 511.2 S .376(ner of the setuid script open to a de).3 F -.3(va)-.3 G
.376(stating attack.).3 F .376(In general, such scripts should be)6.376 F -.24
(avo)72 543.2 S(ided.).24 E .135(As an e)97 578.8 R .135
(xample, suppose a site has a setuid script of)-.18 F F3(sh)3.135 E F0 3.136
(commands. An)5.135 F(attack)3.136 E .136(er sim-)-.12 F 2.801(ply e)72 610.8 R
-.18(xe)-.18 G 2.801(cutes the script in such a w).18 F 2.8
(ay that the shell which interprets the commands)-.12 F .613(appears to ha)72
642.8 R .973 -.18(ve b)-.24 H .613(een in).18 F -.24(vo)-.48 G -.12(ke).24 G
3.613(db).12 G 3.614(yap)224.765 642.8 S .614(erson logging in.)249.321 642.8 R
F2(UNIX)6.614 E F0 .614(applies the setuid bit on the)3.614 F .482(script to t\
he shell, and since it appears to be a login shell, it becomes interacti)72
674.8 R -.18(ve)-.3 G 6.482(.A).18 G 3.482(tt)479.182 674.8 S(hat)489.336 674.8
Q(point, the attack)72 706.8 Q(er can type his o)-.12 E(wn commands, re)-.3 E
-.06(ga)-.18 G(rdless of what is in the script.).06 E EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(2-)288 52 S .25(One w)97 88 R .25
(ay to a)-.12 F -.24(vo)-.24 G .25(id ha).24 F .25
(ving a setuid script is to turn of)-.24 F 3.251(ft)-.3 G .251
(he setuid bit on the script, and)358.17 88 R 1.572
(rather than calling the script directly)72 120 R 4.572(,u)-.78 G 1.572
(se a setuid program to in)266.952 120 R -.24(vo)-.48 G 1.812 -.12(ke i).24 H
4.572(t. This).12 F(program)4.572 E .445(should tak)72 152 R 3.445(ec)-.12 G
.446(are to call the command interpreter by its full path name, and reset en)
136.094 152 R(viron-)-.48 E 1.9
(ment information such as \214le descriptors and en)72 184 R 1.9(vironment v)
-.48 F 1.9(ariables to a kno)-.3 F 1.9(wn state.)-.3 F(Ho)72 216 Q(we)-.3 E
-.18(ve)-.3 G 2.093 -.48(r, t).18 H 1.134
(his method should be used only as a last resort and as a temporary measure,)
.48 F .492(since with man)72 248 R 3.491(yc)-.18 G .491
(ommand interpreters it is possible e)160.282 248 R -.18(ve)-.3 G 3.491(nu).18
G .491(nder these conditions to force)360.064 248 R(them to tak)72 280 Q 3(es)
-.12 G(ome undesirable action.)138.876 280 Q/F1 12/Times-Italic@0 SF
(Do Not Use)217.296 328 Q F0(creat)3 E F1(for Loc)3 E(king)-.24 E F0 .889
(According to its manual page, `)97 363.6 R .889(`The mode gi)-.888 F -.18(ve)
-.3 G 3.889(n[).18 G F1(cr)343.031 363.6 Q(eat)-.444 E F0 .889
(\(2\)] is arbitrary; it need not)2 F(allo)72 395.6 Q 3.431(ww)-.3 G 3.431
(riting. This)110.459 395.6 R .43
(feature has been used ... by programs to construct a simple e)3.431 F(xclusi)
-.18 E -.18(ve)-.3 G .701(locking mechanism.)72 427.6 R 5.477 -.888('' I)-.84 H
3.701(no).888 G .701(ther w)202.023 427.6 R .701(ords, one w)-.12 F .701
(ay to mak)-.12 F 3.701(eal)-.12 G .701(ock \214le is to)359.87 427.6 R F1(cr)
3.701 E(eat)-.444 E F0 3.702<618c>5.702 G .702(le with)470.298 427.6 R .804
(an unwritable mode \(mode 000 is the most popular for this\).)72 459.6 R .804
(Then, if another user tried)6.804 F(to)72 491.6 Q F1(cr)3 E(eat)-.444 E F0
(the same \214le,)5 E F1(cr)3 E(eat)-.444 E F0 -.12(wo)5 G(uld f).12 E
(ail, returning .)-.12 E .364
(The only problem is that such a scheme does not w)97 527.2 R .364
(ork when at least one of the pro-)-.12 F .982(cesses has)72 559.2 R F1 -.54
(ro)3.982 G(ot).54 E F0 2.302 -.66('s U)2 H .982
(ID, because protection modes are ignored when the ef).66 F(fecti)-.3 E 1.341
-.18(ve U)-.3 H .981(ID is).18 F .089(that of)72 591.2 R F1 -.54(ro)3.089 G(ot)
.54 E F0 6.089(.H)2 G(ence,)145.391 591.2 Q F1 -.54(ro)3.089 G(ot).54 E F0 .09
(can o)5.09 F -.18(ve)-.18 G .09(rwrite the e).18 F .09(xisting \214le re)-.18
F -.06(ga)-.18 G .09(rdless of its protection mode.).06 F 2.005 -.96(To d)72
623.2 T 3.085(ol).96 G .084(ocking in a setuid program, it is best to use)
105.878 623.2 R F1(link)3.084 E F0 3.084(\(2\). If)2 F 3.084(al)3.084 G .084
(ink to an already-e)381.612 623.2 R(xisting)-.18 E .284(\214le is attempted,)
72 655.2 R F1(link)3.285 E F0 -.12(fa)5.285 G .285(ils, e).12 F -.18(ve)-.3 G
3.285(ni).18 G 3.285(ft)234.433 655.2 S .285(he process doing the linking is a)
245.05 655.2 R F1 -.54(ro)3.285 G(ot).54 E F0 .285(process and the)5.285 F
(\214le is not o)72 687.2 Q(wned by)-.3 E F1 -.54(ro)3 G(ot).54 E F0(.)2 E EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(3-)288 52 S -.48(Wi)97 88 S 1.355
(th 4.2 Berk).48 F(ele)-.12 E(y)-.18 E/F1 11/Times-Roman@0 SF(UNIX)4.355 E F0
4.355(,a)C 4.355(na)231.777 88 S(lternati)247.46 88 Q 1.715 -.18(ve i)-.3 H
4.355(st).18 G 4.354(ou)312.354 88 S 1.354(se the)328.708 88 R/F2 12
/Times-Italic@0 SF(\215oc)4.354 E(k)-.24 E F0 1.354(\(3\) system call, b)2 F
1.354(ut this)-.24 F 1.762(has disadv)72 120 R 1.762(antages \(speci\214cally)
-.3 F 4.762(,i)-.78 G 4.762(tc)233.514 120 S 1.762(reates advisory locks only)
246.94 120 R 4.762(,a)-.78 G 1.762(nd it is not portable to)389.516 120 R
(other v)72 152 Q(ersions of)-.18 E F1(UNIX)3 E F0(\).)A 1.651(The issue of co)
97 187.6 R -.18(ve)-.18 G 1.65
(rt channels [5] also arises here; that is, information can be sent).18 F .693
(illicitly by controlling resources.)72 219.6 R(Ho)6.693 E(we)-.3 E -.18(ve)-.3
G 1.653 -.48(r, t).18 H .693(his problem is much broader than the scope).48 F
(of this paper)72 251.6 Q 3(,s)-.48 G 3(ow)142.176 251.6 S 3(es)159.84 251.6 S
(hall pass o)172.836 251.6 Q -.18(ve)-.18 G 3(ri).18 G(t.)244.8 251.6 Q F2
(Catc)246.084 299.6 Q 3(hA)-.18 G(ll Signals)284.904 299.6 Q F0 1.45(When a pr\
ocess created by running a setuid \214le dumps core, the core \214le has the)97
335.2 R .74(same UID as the real UID of the process\207.)72 367.2 R .74
(By setting)6.74 F F2(umask)3.74 E F0 3.74(sp)2 G(roperly)388.82 367.2 Q 3.739
(,i)-.78 G 3.739(ti)432.771 367.2 S 3.739(sp)443.182 367.2 S .739(ossible to)
457.589 367.2 R 1.743(obtain a w)72 399.2 R 1.743(orld-writable \214le o)-.12 F
1.743(wned by someone else.)-.3 F 3.663 -.96(To p)7.743 H(re).96 E -.18(ve)-.3
G 1.743(nt this, setuid programs).18 F(should catch all signals possible.)72
431.2 Q 2.099(Some signals, such as)97 466.8 R/F3 12/Times-Bold@0 SF(SIGKILL)
5.099 E F0 2.099(\(in System V and 4.2BSD\) and)5.099 F F3(SIGST)5.098 E(OP)
-.216 E F0(\(in)5.098 E 1.66(4.2BSD\), cannot be caught.)72 498.8 R(Moreo)7.661
E -.18(ve)-.18 G 2.621 -.48(r, o).18 H 4.661(ns).48 G 1.661(ome v)292.756 498.8
R 1.661(ersions of)-.18 F F1(UNIX)4.661 E F0 4.661(,s)C 1.661(uch as V)417.033
498.8 R 1.661(ersion 7,)-1.332 F .56(there is an inherent race condition in si\
gnal handlers, When a signal is caught, the signal)72 530.8 R .674
(trap is reset to its def)72 562.8 R .674(ault v)-.12 F .674(alue and)-.3 F F2
(then)3.674 E F0 .674(the handler is called.)5.674 F .675(As a result, recei)
6.675 F .675(ving the)-.3 F .838(same signal immediately after a pre)72 594.8 R
.837(vious one will cause the signal to tak)-.3 F 3.837(ee)-.12 G -.3(ff)
444.075 594.8 S .837(ect re).3 F -.06(ga)-.18 G(rd-).06 E .693
(less of whether it is being trapped.)72 626.8 R .693(On such a v)6.693 F .693
(ersion of)-.18 F F1(UNIX)3.693 E F0 3.693(,s)C .694(ignals cannot be safely)
392.274 626.8 R 3.051(caught. Ho)72 658.8 R(we)-.3 E -.18(ve)-.3 G 1.011 -.48
(r, i).18 H 3.051(fas).48 G .051(ignal is being)185.244 658.8 R F2(ignor)3.051
E(ed)-.444 E F0 3.051(,s)2 G .051(ending the process a signal will)302.672
658.8 R F2(not)3.051 E F0(cause)5.05 E .4 LW 77 676.4 72 676.4 DL 79 676.4 74
676.4 DL 84 676.4 79 676.4 DL 89 676.4 84 676.4 DL 94 676.4 89 676.4 DL 99
676.4 94 676.4 DL 104 676.4 99 676.4 DL 109 676.4 104 676.4 DL 114 676.4 109
676.4 DL 119 676.4 114 676.4 DL 124 676.4 119 676.4 DL 129 676.4 124 676.4 DL
134 676.4 129 676.4 DL 139 676.4 134 676.4 DL 144 676.4 139 676.4 DL/F4 10
/Times-Roman@0 SF 5<874f>72 692 S 2.644(ns)89.22 692 S .144(ome v)100.754 692 R
.144(ersions of)-.15 F/F5 9/Times-Roman@0 SF(UNIX)2.644 E F4 2.644(,s)C .144
(uch as 4.2BSD, no core \214le is produced if the real and ef)198.941 692 R
(fecti)-.25 E .445 -.15(ve U)-.25 H .145(IDs of the).15 F(process dif)82 704 Q
(fer)-.25 E(.)-.55 E EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(4-)288 52 S(the def)72 88 Q
(ault action to be reinstated; so, signals can be safely ignored.)-.12 E .092
(The signals)97 123.6 R/F1 12/Times-Bold@0 SF(SIGCHLD)3.092 E F0(,)A F1
(SIGCONT)3.092 E F0(,)A F1(SIGTSTP)3.092 E F0(,)A F1(SIGTTIN)3.092 E F0 3.091
(,a)C(nd)396.267 123.6 Q F1(SIGTT)3.091 E(OU)-.216 E F0 3.091<8728>C .091
(all of)478.913 123.6 R 1.004(which relate to the stopping and starting of job\
s and the termination of child processes\))72 155.6 R .399(should be caught un\
less there is a speci\214c reason not to do this, because if data is k)72 187.6
R .398(ept in)-.12 F 4.007(aw)72 219.6 S 1.007
(orld-writable \214le, or data or lock \214les in a w)89.879 219.6 R 1.007
(orld-writable directory such as `)-.12 F(`/tmp')-.888 E(',)-.888 E .578
(one can easily change information the process \(presumably\) relies upon.)72
251.6 R .578(Note, ho)6.578 F(we)-.3 E -.18(ve)-.3 G -.48(r,).18 G .201
(that if a system call which creates a child \(such as)72 283.6 R/F2 12
/Times-Italic@0 SF(system)3.201 E F0(,)2 E F2(popen)3.201 E F0 3.201(,o)2 G(r)
400.213 283.6 Q F2(fork)3.201 E F0 .202(\(2\)\) is used, the)2 F F1(SIGCHLD)72
315.6 Q F0 1.703(signal will be sent to the process when the command gi)4.703 F
-.18(ve)-.3 G(n).18 E F2(system)4.702 E F0 1.702(is \214n-)6.702 F
(ished; in this case, it w)72 347.6 Q(ould be wise to ignore)-.12 E F1(SIGCHLD)
3 E F0(.)A(This brings us to our ne)97 383.2 Q(xt point.)-.18 E F2(Be Sur)
204.234 431.2 Q 3(eV)-.444 G(eri\214cation Really V)250.446 431.2 Q(eri\214es)
-1.332 E F0 .003(When writing a setuid program, it is often tempting to assume\
 data upon which deci-)97 466.8 R 1.11(sions are based is reliable.)72 498.8 R
-.18(Fo)7.11 G 4.11(re).18 G 1.109(xample, consider a spooler)234.936 498.8 R
7.109(.O)-.66 G 1.109(ne setuid process spools)385.017 498.8 R .978
(jobs, and another \(called the)72 530.8 R F2(daemon)3.979 E F0 3.979(\)r)2 G
.979(uns them.)267.491 530.8 R .979(Assuming that the spooled \214les were)
6.979 F 1.195(placed there by the spooler)72 562.8 R 4.195(,a)-.48 G 1.195
(nd hence are `)218.123 562.8 R(`safe')-.888 E 1.195(', is ag)-.888 F 1.195
(ain a recipe for disaster; the)-.06 F F2(at)4.195 E F0 .105
(spooler discussed earlier is an e)72 594.8 R .105(xample of this.)-.18 F
(Rather)6.105 E 3.106(,t)-.48 G .106(he daemon should attempt to v)342.91 594.8
R(er)-.18 E(-)-.24 E 1.286(ify that the spooler placed the \214le there; for e)
72 626.8 R 1.285(xample, the spooler should log that a \214le)-.18 F -.12(wa)72
658.8 S 3.408(ss).12 G .409(pooled, who spooled it, when it w)98.616 658.8 R
.409(as spooled, and an)-.12 F 3.409(yo)-.18 G .409
(ther useful information, in a)368.048 658.8 R .4 LW 77 676.4 72 676.4 DL 79
676.4 74 676.4 DL 84 676.4 79 676.4 DL 89 676.4 84 676.4 DL 94 676.4 89 676.4
DL 99 676.4 94 676.4 DL 104 676.4 99 676.4 DL 109 676.4 104 676.4 DL 114 676.4
109 676.4 DL 119 676.4 114 676.4 DL 124 676.4 119 676.4 DL 129 676.4 124 676.4
DL 134 676.4 129 676.4 DL 139 676.4 134 676.4 DL 144 676.4 139 676.4 DL/F3 10
/Times-Roman@0 SF 5<8754>72 692 S .541(he latter four are used by v)88.11 692 R
.541(arious v)-.25 F .541(ersions of Berk)-.15 F(ele)-.1 E(y)-.15 E/F4 9
/Times-Roman@0 SF(UNIX)3.041 E F3 .541(and their deri)3.041 F -.25(va)-.25 G
(ti).25 E -.15(ve)-.25 G 3.041(st).15 G 3.041(os)425.445 692 S .542
(uspend and con-)437.376 692 R(tinue jobs.)82 704 Q(The)5 E 2.5(yd)-.15 G 2.5
(on)156.57 704 S(ot e)169.07 704 Q(xist on man)-.15 E(y)-.15 E F4(UNIX)2.5 E F3
(es, including System V)A(.)-1.29 E EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(5-)288 52 S .032
(protected \214le, and the daemon should check the information in the log ag)72
88 R .031(ainst the spooled)-.06 F(\214le')72 120 Q 3.008(sa)-.66 G(ttrib)
103.676 120 Q 3.008(utes. W)-.24 F .009(ith the problem in)-.48 F -.24(vo)-.48
G(lving).24 E/F1 12/Times-Italic@0 SF(at)3.009 E F0 3.009(,s)2 G .009
(ince the log \214le is protected, the daemon)309.297 120 R -.12(wo)72 152 S
(uld ne).12 E -.18(ve)-.3 G 3(re).18 G -.18(xe)139.2 152 S
(cute a \214le not placed in the spool area by the spooler).18 E(.)-.66 E F1
(Mak)153.636 200 Q 3(eO)-.12 G(nly Safe Assumptions About Reco)191.832 200 Q
(very Of Err)-.12 E(or)-.54 E(s)-.12 E F0 1.599
(If the setuid program encounters an une)97 235.6 R 1.599
(xpected situation that the program cannot)-.18 F .219(handle \(such as runnin\
g out of \214le descriptors\), the program should not attempt to correct)72
267.6 R .001(for the situation.)72 299.6 R .001(It should stop.)6.001 F .001
(This is the opposite of the standard programming maxim)6.001 F .609(about rob)
72 331.6 R .609(ustness of programs, b)-.24 F .609(ut there is a v)-.24 F .609
(ery good reason for this rule.)-.18 F .609(When a pro-)6.609 F .467
(gram tries to handle an unkno)72 363.6 R .467(wn or une)-.3 F .467
(xpected situation, v)-.18 F .467(ery often the programmer has)-.18 F .578
(made certain assumptions which do not hold up; for e)72 395.6 R .578
(xample, early v)-.18 F .578(ersions of the com-)-.18 F(mand)72 427.6 Q F1(su)
4.465 E F0 1.464(\(1\) made the assumption that if the passw)2 F 1.464
(ord \214le could not be opened, some-)-.12 F .58(thing w)72 459.6 R .581
(as disastrously wrong with the system and the person should be gi)-.12 F -.18
(ve)-.3 G(n).18 E F1 -.54(ro)3.581 G(ot).54 E F0(pri)5.581 E(vi-)-.3 E(le)72
491.6 Q .361(ges so that he could \214x the problem.)-.18 F .361
(Such assumptions can pose e)6.361 F .36(xtreme danger to the)-.18 F
(system and its users.)72 523.6 Q 1.406(When writing a setuid program, k)97
559.2 R 1.406(eep track of things that can go wrong \255 a com-)-.12 F .46
(mand too long, an input line too long, data in the wrong format, a f)72 591.2
R .46(ailed system call, and)-.12 F .71(so forth \255 and at each step ask, `)
72 623.2 R .71(`if this occurred, what should be done?')-.888 F 6.71('I)-.888 G
3.71(fn)440.886 623.2 S .71(one of the)454.592 623.2 R 1.084
(assumptions can be v)72 655.2 R 1.083(eri\214ed, or the assumptions do not co)
-.18 F -.18(ve)-.18 G 4.083(ra).18 G 1.083(ll cases, at that point the)382.593
655.2 R .803(setuid program should)72 687.2 R F1(stop)3.803 E F0 6.803(.D)2 G
3.803(on)225.208 687.2 S .803(ot attempt to reco)241.011 687.2 R -.18(ve)-.18 G
3.804(ru).18 G .804(nless reco)352.512 687.2 R -.18(ve)-.18 G .804
(ry is guaranteed; it).18 F(is too easy to produce undesirable side-ef)72 719.2
Q(fects in the process.)-.3 E EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(6-)288 52 S .174(Once ag)97 88 R
.174(ain, when writing a setuid program, if you are not sure ho)-.06 F 3.173
(wt)-.3 G 3.173(oh)429.837 88 S .173(andle a con-)445.01 88 R .293(dition, e)72
120 R 3.293(xit. That)-.18 F -.12(wa)3.293 G 1.853 -.78(y, t).12 H .293
(he user cannot do an).78 F 3.293(yd)-.18 G .294
(amage as a result of encountering \(or cre-)302.349 120 R
(ating\) the condition.)72 152 Q -.18(Fo)97 187.6 S 3(ra).18 G 3(ne)121.816
187.6 S(xcellent discussion of error detection and reco)135.964 187.6 Q -.18
(ve)-.18 G(ry under).18 E/F1 11/Times-Roman@0 SF(UNIX)3 E F0 3(,s)C(ee [6].)
449.689 187.6 Q/F2 12/Times-Italic@0 SF(Be Car)211.644 235.6 Q(eful W)-.444 E
(ith I/O Oper)-.66 E(ations)-.18 E F0 1.086
(When a setuid process must create and write to a \214le o)97 271.2 R 1.085
(wned by the person who is)-.3 F .513(running the setuid program, either of tw)
72 303.2 R 3.513(op)-.12 G .513(roblems may arise.)282.111 303.2 R .514
(If the setuid process does)6.514 F 1.427(not ha)72 335.2 R 1.787 -.18(ve p)
-.24 H 1.427(ermission to create a \214le in the current w).18 F 1.426
(orking directory)-.12 F 4.426(,t)-.78 G 1.426(he \214le cannot be)420.738
335.2 R 4.481(created. W)72 367.2 R 1.482
(orse, it is possible that the \214le may be created and left writable by an)
-.96 F(yone.)-.18 E 1.119
(The usual implementation is for the process to create the \214le,)72 399.2 R
F2 -.18(ch)4.119 G(own).18 E F0 1.119(it to the real UID)6.119 F .667
(and real GID of the process, and then write to it.)72 431.2 R(Ho)6.667 E(we)
-.3 E -.18(ve)-.3 G 1.627 -.48(r, i).18 H 3.667(ft).48 G(he)381.007 431.2 Q F2
(umask)3.667 E F0 .668(is set to 0, and)5.667 F .052
(the process is interrupted after the \214le is created b)72 463.2 R .052
(ut before it is)-.24 F F2 -.18(ch)3.052 G(own).18 E F0 .052
(ed, the process will)2 F(lea)72 495.2 Q .468 -.18(ve a w)-.24 H .108
(orld-writable \214le o).06 F .108(wned by the user who has the ef)-.3 F(fecti)
-.3 E .468 -.18(ve U)-.3 H .108(ID of the setuid pro-).18 F(cess.)72 527.2 Q
1.406(The section on checking the en)97 562.8 R 1.405
(vironment described a method of dealing with this)-.48 F .69
(situation when the program is setuid to)72 594.8 R F2 -.54(ro)3.691 G(ot).54 E
F0 6.691(.T)2 G .691(hat method does not w)304.979 594.8 R .691
(ork when the pro-)-.12 F .353(gram is setuid to some other user)72 626.8 R
6.353(.I)-.66 G 3.353(nt)245.459 626.8 S .353(hat case, the w)258.148 626.8 R
.353(ay to pre)-.12 F -.18(ve)-.3 G .353(nt a setuid program from).18 F .296
(creating a w)72 658.8 R .296(orld-writable \214le o)-.12 F .296
(wned by the ef)-.3 F(fecti)-.3 E .656 -.18(ve U)-.3 H .296
(ID of the process is f).18 F .296(ar more com-)-.12 F(ple)72 690.8 Q 1.583
(x, b)-.18 F 1.583(ut eliminates the need for an)-.24 F(y)-.18 E F2 -.18(ch)
4.583 G(own).18 E F0 1.582(system calls.)6.583 F 1.582
(In this method, the process)7.582 F F2(fork)72 722.8 Q F0 1.159
(\(2\)s, and the child resets its ef)2 F(fecti)-.3 E 1.52 -.18(ve U)-.3 H 1.16
(ID and GID to the real UID and GID.).18 F(The)7.16 E EP
%%Page: 17 17
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(7-)288 52 S .526
(parent then writes the data to the child via)72 88 R/F1 12/Times-Italic@0 SF
(pipe)3.525 E F0 .525(\(2\) rather than to the \214le; meanwhile, the)2 F 1.22
(child creates the \214le and copies the data from the pipe to the \214le.)72
120 R 1.22(That w)7.22 F(ay)-.12 E 4.22(,t)-.78 G 1.22(he \214le is)460.892 120
R(ne)72 152 Q -.18(ve)-.3 G 3(ro).18 G(wned by the user whose UID is the ef)
106.872 152 Q(fecti)-.3 E .36 -.18(ve U)-.3 H(ID of the setuid process.).18 E
(Some)97 187.6 Q/F2 11/Times-Roman@0 SF(UNIX)4.513 E F0 1.513
(systems, notably 4.2 BSD, allo)4.513 F 4.513(wat)-.3 G 1.513(hird method.)
341.301 187.6 R 1.513(The basic problem)7.513 F 1.846
(here is that the system call)72 219.6 R F1(setuid)4.846 E F0 1.846
(\(3\)\207 can only set the ef)2 F(fecti)-.3 E 2.206 -.18(ve U)-.3 H 1.846
(ID to the real UID).18 F 1.444(\(unless the process runs with)72 251.6 R F1
-.54(ro)4.444 G(ot).54 E F0(pri)6.444 E(vile)-.3 E 1.444
(ges, in which case both the ef)-.18 F(fecti)-.3 E 1.803 -.18(ve a)-.3 H 1.443
(nd real).18 F 1.214(UIDs are reset to the ar)72 283.6 R 4.214(gument.\) Once)
-.216 F 1.214(the ef)4.214 F(fecti)-.3 E 1.574 -.18(ve U)-.3 H 1.215
(ID is reset with this call, the old).18 F(ef)72 315.6 Q(fecti)-.3 E .882 -.18
(ve U)-.3 H .522(ID can ne).18 F -.18(ve)-.3 G 3.522(rb).18 G 3.522(er)197.436
315.6 S .522(estored \(ag)210.282 315.6 R .522
(ain, unless the process runs with)-.06 F F1 -.54(ro)3.521 G(ot).54 E F0(pri)
5.521 E(vile)-.3 E(ges.\))-.18 E .258(So it is necessary to a)72 347.6 R -.24
(vo)-.24 G .258(id resetting an).24 F 3.258(yU)-.18 G .259
(IDs when creating the \214le; this leads to the cre-)274.716 347.6 R .771
(ation of another process or the use of)72 379.6 R F1 -.18(ch)3.771 G(own).18 E
F0 6.771(.H)2 G -.3(ow)310.38 379.6 S -2.58 -.3(ev e).3 H 1.731 -.48(r, 4).3 H
.771(.2BSD pro).48 F .771(vides the capability)-.18 F .022(to reset the ef)72
411.6 R(fecti)-.3 E .382 -.18(ve U)-.3 H .023
(ID independently of the real UID using the system call).18 F F1(setr)3.023 E
(euid)-.444 E F0(\(2\).)2 E 3.266(As)72 443.6 S .265(imilar call,)88.598 443.6
R F1(setr)3.265 E -.48(eg)-.444 G(id).48 E F0 .265(\(2\), e)2 F .265
(xists for the real and ef)-.18 F(fecti)-.3 E .625 -.18(ve G)-.3 H .265
(IDs So, all the program need).18 F 1.137(do is use these calls to e)72 475.6 R
1.138(xchange the ef)-.18 F(fecti)-.3 E 1.498 -.18(ve a)-.3 H 1.138
(nd real UIDs, and the ef).18 F(fecti)-.3 E 1.498 -.18(ve a)-.3 H 1.138
(nd real).18 F 4.612(GIDs. That)72 507.6 R -.12(wa)4.612 G 3.172 -.78(y, t).12
H 1.612(he old ef).78 F(fecti)-.3 E 1.972 -.18(ve U)-.3 H 1.612
(ID can be easily restored, and there will not be a).18 F
(problem creating a \214le o)72 539.6 Q(wned by the person e)-.3 E -.18(xe)-.18
G(cuting the setuid program.).18 E/F3 12/Times-Bold@0 SF(Conclusion)72 587.6 Q
F0 1.92 -.96(To s)97 623.2 T
(ummarize, the rules to remember when writing a setuid program are:).96 E 7.8
<8342>122 658.8 S 3(ea)142.004 658.8 S 3(sr)155.66 658.8 S(estricti)167.324
658.8 Q .36 -.18(ve a)-.3 H 3(sp).18 G(ossible in choosing the UID and GID.)
232.832 658.8 Q .4 LW 77 688.4 72 688.4 DL 79 688.4 74 688.4 DL 84 688.4 79
688.4 DL 89 688.4 84 688.4 DL 94 688.4 89 688.4 DL 99 688.4 94 688.4 DL 104
688.4 99 688.4 DL 109 688.4 104 688.4 DL 114 688.4 109 688.4 DL 119 688.4 114
688.4 DL 124 688.4 119 688.4 DL 129 688.4 124 688.4 DL 134 688.4 129 688.4 DL
139 688.4 134 688.4 DL 144 688.4 139 688.4 DL/F4 10/Times-Roman@0 SF 5<8754>72
704 S(his system call is in section 2 of the System V manual.)88.11 704 Q EP
%%Page: 18 18
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(8-)288 52 S 7.8<8352>122 88 S
(eset ef)142.004 88 Q(fecti)-.3 E .36 -.18(ve U)-.3 H
(IDs and GIDs before calling).18 E/F1 12/Times-Italic@0 SF -.24(ex)3 G(ec).24 E
F0(.)A 7.8<8343>122 107.6 S(lose all b)142.004 107.6 Q
(ut necessary \214le descriptors before calling)-.24 E F1 -.24(ex)3 G(ec).24 E
F0(.)A 7.8<8342>122 127.2 S 3(es)142.004 127.2 S
(ure a restricted root really restricts.)155 127.2 Q 7.8<8343>122 146.8 S
(heck the en)142.004 146.8 Q(vironment in which the process will run.)-.48 E
7.8<8344>122 166.4 S 3(on)142.664 166.4 S
(ot write interpreted scripts that are setuid.)157.664 166.4 Q 7.8<8344>122 186
S 3(on)142.664 186 S(ot use)157.664 186 Q F1(cr)3 E(eat)-.444 E F0
(for locking.)3 E 7.8<8343>122 205.6 S(atch all signals.)142.004 205.6 Q 7.8
<8342>122 225.2 S 3(es)142.004 225.2 S(ure v)155 225.2 Q
(eri\214cation really v)-.18 E(eri\214es.)-.18 E 7.8<834d>122 244.8 S(ak)
144.668 244.8 Q 3(eo)-.12 G(nly safe assumptions about reco)170.204 244.8 Q
-.18(ve)-.18 G(ry of errors.).18 E 7.8<8342>122 264.4 S 3(ec)142.004 264.4 S
(areful with I/O operations.)155.66 264.4 Q .937(Setuid programs are a de)97
300 R .937(vice to allo)-.3 F 3.937(wu)-.3 G .938(sers to acquire ne)293.255
300 R 3.938(wp)-.3 G(ri)398.01 300 Q(vile)-.3 E .938(ges for a limited)-.18 F
1.958(amount of time.)72 332 R 1.958(As such, the)7.958 F 4.958(yp)-.18 G(ro)
239.892 332 Q 1.958(vide a means for o)-.18 F -.18(ve)-.18 G 1.957
(rriding the protection scheme).18 F .078(designed into)72 364 R/F2 11
/Times-Roman@0 SF(UNIX)3.078 E F0 6.078(.U)C(nfortunately)184.719 364 Q 3.078
(,g)-.78 G -2.58 -.3(iv e)254.673 364 T 3.078(nt).3 G .078(he w)281.271 364 R
.078(ay protection is handled in)-.12 F F2(UNIX)3.079 E F0 3.079(,i)C 3.079(ti)
471.838 364 S 3.079(st)481.589 364 S(he)492.672 364 Q 1.409
(best solution possible; an)72 396 R 1.409(ything else w)-.18 F 1.409
(ould require users to share passw)-.12 F 1.409(ords widely)-.12 F 4.409(,o)
-.78 G(r)500.004 396 Q(the)72 428 Q F2(UNIX)4.409 E F0 -.12(ke)4.409 G 1.41
(rnel to be re).12 F 1.41(written to allo)-.3 F 4.41(wa)-.3 G 1.41
(ccess lists for \214les and processes.)284.01 428 R -.18(Fo)7.41 G 4.41(rt).18
G(hese)482.676 428 Q 1.513(reasons, setuid programs need to be written to k)72
460 R 1.513(eep the protection system as potent as)-.12 F .872(possible e)72
492 R -.18(ve)-.3 G 3.872(nw).18 G .872(hen the)149.92 492 R 3.872(ye)-.18 G
-.3(va)200.504 492 S .872(de certain aspects of it.).3 F .873
(Thus, the designers and implemen-)6.872 F(tors of setuid programs should tak)
72 524 Q 3(eg)-.12 G(reat care when writing them.)249.864 524 Q F1(Ac)72 559.6
Q(knowledg)-.24 E(ements)-.12 E(Ac)72.002 559.6 Q(knowledg)-.24 E(ements)-.12 E
F0 2.19(Thanks to Bob Bro)5.19 F 2.19(wn, Peter Denning, Geor)-.3 F 2.189
(ge Gobel, Chris K)-.216 F(ent,)-.3 E 1.679(Rich K)72 591.6 R(ula)-.18 E 1.679
(wiec, Da)-.18 F 1.679(wn Mane)-.18 F -.3(va)-.3 G 1.679
(l, and Kirk Smith, who re).3 F(vie)-.3 E 1.679(wed an earlier draft of this)
-.3 F(paper)72 623.6 Q 3(,a)-.48 G(nd made man)109.5 623.6 Q 3(yc)-.18 G
(onstructi)188.304 623.6 Q .36 -.18(ve s)-.3 H(uggestions.).18 E/F3 12
/Times-Bold@0 SF(Refer)72 671.6 Q(ences)-.216 E F0 3([1] Aleph-Null,)72 691.2 R
-.888(``)4.024 G 1.024(Computer Recreations,).888 F -.888('')-.84 G F1(Softwar)
4.912 E 4.024(e\255P)-.444 G -.18(ra)348.452 691.2 S 1.024
(ctise and Experience).18 F F3(1)4.024 E F0 1.024(\(2\) pp.)B
(201 \255 204 \(April \255 June 1971\))91.992 707.2 Q EP
%%Page: 19 19
%%BeginPageSetup
BP
%%EndPageSetup
/F0 12/Times-Roman@0 SF 3(-1)275.004 52 S 3(9-)288 52 S([2])72 88 Q/F1 12
/Times-Italic@0 SF .17(UNIX System V Release 2.0 Pr)6 F -.12(og)-.54 G -.18(ra)
.12 G .17(mmer Refer).18 F .171(ence Manual)-.444 F F0 3.171(,D)C .171
(EC Processor V)396.006 88 R(ersion,)-1.332 E -1.332(AT)91.992 104 S(&T T)1.332
E(echnologies \(April 1984\))-.84 E([3])72 139.6 Q F1 2.474(UNIX Pr)6 F -.12
(og)-.54 G -.18(ra).12 G(mmer').18 E 5.474(sM)-.48 G 2.474(anual, 4.2 Berk)
210.268 139.6 R(ele)-.12 E 5.473(yS)-.36 G(oftwar)319.521 139.6 Q 5.473(eD)
-.444 G(istrib)369.886 139.6 Q 2.473(ution, V)-.24 F 2.473(irtual V)-.888 F
(AX-11)-.72 E -1.332(Ve)91.992 155.6 S -.12(rs)1.332 G(ion).12 E F0 3.09(,C)C
.09(omputer Science Di)141.966 155.6 R .091
(vision, Department of Electrical Engineering and Com-)-.3 F
(puter Science, Uni)91.992 171.6 Q -.18(ve)-.3 G(rsity of California, Berk).18
E(ele)-.12 E 1.56 -.78(y, C)-.18 H 3(A\().78 G(August 1983\))355.716 171.6 Q 3
([4] K)72 207.2 R 1.073(ernighan, Brian and Plauger)-.3 F 4.073(,P)-.48 G(.,)
250.148 207.2 Q F1 1.072(The Elements of Pr)4.072 F -.12(og)-.54 G -.18(ra).12
G 1.072(mming Style).18 F 4.072(,S)-.12 G 1.072(econd Edi-)450.608 207.2 R
(tion)91.992 223.2 Q F0 3(,M)C(cGra)127.332 223.2 Q(w-Hill Book Compan)-.18 E
1.56 -.78(y, N)-.18 H .6 -.3(ew Y).78 H(ork, NY \(1978\))-1.02 E 3
([5] Lampson,)72 258.8 R(Butler)4.196 E 4.196(,`)-.48 G 3.116 -.96(`A N)183.676
258.8 T 1.196(ote on the Con\214nement Problem,).96 F -.888('')-.84 G F1(CA)
5.084 E(CM)-.36 E/F2 12/Times-Bold@0 SF(16)4.196 E F0 1.196
(\(10\) pp. 613 \255)B(615 \(October 1973\))91.992 274.8 Q 3([6] Darwin,)72
310.4 R 1.939(Ian and Collyer)4.939 F 4.939(,G)-.48 G(eof)230.572 310.4 Q 1.939
(f, `)-.3 F(`Can')-.888 E 4.939(tH)-.216 G 1.939(appen or /* NO)304.686 310.4 R
(TREA)-.48 E 1.939(CHED */ or Real)-.48 F(Programs Dump Core,)91.992 326.4 Q
1.776 -.888('' 1)-.84 H(985 W).888 E(inter USENIX Proceedings \(January 1985\))
-.48 E EP
%%Trailer
end
%%EOF
