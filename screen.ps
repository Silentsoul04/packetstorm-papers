%!PS-Adobe-1.0
%%Title: screen.mss
%%DocumentFonts: (atend)
%%Creator: Jeffrey Mogul,WRL,8536643,3232838 and Scribe 5(1501)
%%CreationDate: 27 March 1989 11:39
%%Pages: (atend)
%%EndComments
% PostScript Prelude for Scribe.
/BS {/SV save def 0.0 792.0 translate .01 -.01 scale} bind def
/ES {SV restore showpage} bind def
/SC {setrgbcolor} bind def
/FMTX matrix def
/RDF {WFT SLT 0.0 eq
  {SSZ 0.0 0.0 SSZ neg 0.0 0.0 FMTX astore}
  {SSZ 0.0 SLT sin SLT cos div SSZ mul SSZ neg 0.0 0.0 FMTX astore}
  ifelse makefont setfont} bind def
/SLT 0.0 def
/SI { /SLT exch cvr def RDF} bind def
/WFT /Courier findfont def
/SF { /WFT exch findfont def RDF} bind def
/SSZ 1000.0 def
/SS { /SSZ exch 100.0 mul def RDF} bind def
/AF { /WFT exch findfont def /SSZ exch 100.0 mul def RDF} bind def
/MT /moveto load def
/XM {currentpoint exch pop moveto} bind def
/UL {gsave newpath moveto dup 2.0 div 0.0 exch rmoveto
   setlinewidth 0.0 rlineto stroke grestore} bind def
/LH {gsave newpath moveto setlinewidth
   0.0 rlineto
   gsave stroke grestore} bind def
/LV {gsave newpath moveto setlinewidth
   0.0 exch rlineto
   gsave stroke grestore} bind def
/BX {gsave newpath moveto setlinewidth
   exch
   dup 0.0 rlineto
   exch 0.0 exch neg rlineto
   neg 0.0 rlineto
   closepath
   gsave stroke grestore} bind def
/BX1 {grestore} bind def
/BX2 {setlinewidth 1 setgray stroke grestore} bind def
/PB {/PV save def translate 100.0 -100.0 scale pop} bind def
/PE {PV restore} bind def
/SH /show load def
/MX {exch show 0.0 rmoveto} bind def
/W {0 32 4 -1 roll widthshow} bind def
/WX {0 32 5 -1 roll widthshow 0.0 rmoveto} bind def
%%EndProlog
%%Page: 0 1 
BS
0 SI
10 /Times-Roman AF
26641 4286 MT
(M A R C H  1 9 8 9)SH
40 /Times-Bold AF
14400 12400 MT
(WRL)SH
14400 16120 MT
(Research Report 89/4)SH
/Times-Roman SF
14400 33344 MT
(Simple and Flexible)SH
14400 37164 MT
(Datagram Access)SH
14400 40984 MT
(Controls for)SH
14400 44804 MT
(Unix-based Gateways)SH
18 /Times-Italic AF
14400 52778 MT
(Jeffrey C. Mogul)SH
1 SS 
7 9000 72007 PB %!                      % magic number--identifies it as a PS file
% this is the WRL Note cover blurb for WRL Notes that are formatted with a
% binding margin for doublesided printing.

50 dict begin
-18 0 translate
/verylight 0.95 def
/lightgray 0.8 def
/darkgray  0.1 def
/inch {72 mul} def
 /gstring (g) def
/logo {gsave % create a 1 unit high digital logo
  /Helvetica-Bold findfont [.6 0 0 .75 0 0] makefont setfont
   -3.425 2 div 0 translate
  /box {
    newpath
    0 0 moveto
    .425 0 lineto
    0 1 rlineto
    0 1 lineto
    closepath darkgray setgray fill
    word exch 1 getinterval
    1 setgray
    dup stringwidth pop .425 exch sub 2 div .225 moveto
    dup gstring eq {0 .05 rmoveto} if
    show
    } def
  /boxstr {gsave
    /word exch def
    0 1 word length 1 sub {box .5 0 translate} for
    grestore} def

  (digital) boxstr
  grestore} def
-72 -72 translate
gsave 95 26 translate 22 dup scale logo grestore
141 34 moveto
/Times-Bold findfont [11.4 0 0 12 0 0] makefont setfont
(Western Research Laboratory  ) show
/Times-Roman findfont [11.4 0 0 12 0 0] makefont setfont
( 100 Hamilton Avenue  ) show
( Palo Alto, California 94301 USA) show

/plock {transform 0.5 add cvi exch 0.5 add cvi exch itransform} bind def
/mt {plock moveto} bind def
/lt {plock lineto} bind def
0.25 setlinewidth
139  24 mt 558  24 lt stroke
139  50 mt 558  50 lt stroke
 31  24 mt  31 738 lt 582 738 lt 582 24 lt stroke 
139 604 mt 558 604 lt stroke
139 714 mt 558 714 lt stroke
1 setlinewidth
133 133 mt 133 488 lt stroke
currentscreen 3 -1 roll 2 div 3 1 roll setscreen
12 setlinewidth 0.5 setgray
 55  66 moveto 558  66 lineto stroke
 55 588 moveto 558 588 lineto stroke
end 
 PE ES
%%Page: 0 2 
BS
0 SI
11 /Times-Roman AF
10200 7955 MT
(The Western Research Laboratory \050WRL\051 is)
107 W( a computer systems research group that)106 W
9000 9151 MT
(was founded)
94 W( by Digital Equipment Corporation in 1982. Our focus is computer science)95 W
9000 10347 MT
(research relevant to the design and application of high performance scientific computers.)46 W
9000 11543 MT
(We test our ideas)
89 W( by designing, building, and using real systems. The systems we build)90 W
9000 12739 MT
(are research prototypes; they are not intended to become products.)SH
10200 14912 MT
(There is)
32 W( a second research laboratory located in Palo Alto, the Systems Research Cen-)31 W
9000 16108 MT
(ter \050SRC\051. Other Digital research groups are located)
125 W( in Paris \050PRL\051 and in Cambridge,)126 W
9000 17304 MT
(Massachusetts \050CRL\051.)SH
10200 19477 MT
(Our research is directed towards mainstream high-performance computer systems. Our)18 W
9000 20673 MT
(prototypes are intended to)
53 W( foreshadow the future computing environments used by many)54 W
9000 21869 MT
(Digital customers. The)
77 W( long-term goal of WRL is to aid and accelerate the development)76 W
9000 23065 MT
(of high-performance uni- and)
126 W( multi-processors. The research projects within WRL will)127 W
9000 24261 MT
(address various aspects of high-performance computing.)SH
10200 26434 MT
(We believe that significant advances in computer systems do not come from)
5 W( any single)4 W
9000 27630 MT
(technological advance. Technologies, both hardware and software,)
79 W( do not all advance at)80 W
9000 28826 MT
(the same pace. System design is the art of composing systems which use)
119 W( each level of)118 W
9000 30022 MT
(technology in an appropriate balance.)
151 W( A major advance in overall system performance)152 W
9000 31218 MT
(will require reexamination of all aspects of the system.)SH
10200 33391 MT
(We do work in the design, fabrication and packaging of)
1 W( hardware; language processing)SH
9000 34587 MT
(and scaling issues)
173 W( in system software design; and the exploration of new applications)174 W
9000 35783 MT
(areas that are opening up with the advent of higher performance systems.)
58 W( Researchers at)57 W
9000 36979 MT
(WRL cooperate closely and move freely among the various levels of system design.)
29 W( This)30 W
9000 38175 MT
(allows us to explore a wide range of tradeoffs to meet system goals.)SH
10200 40126 MT
(We publish the results of our work in a)
222 W( variety of journals, conferences, research)221 W
9000 41322 MT
(reports, and technical notes.  This)
156 W( document is a research report. Research reports are)157 W
9000 42518 MT
(normally accounts of completed)
33 W( research and may include material from earlier technical)32 W
9000 43714 MT
(notes. We)
577 W( use technical notes for rapid distribution of technical material; usually)
151 W( this)152 W
9000 44910 MT
(represents research in progress.)SH
10200 46861 MT
(Research reports and technical)
154 W( notes may be ordered from us.  You may mail your)153 W
9000 48057 MT
(order to:)SH
11200 49709 MT
(Technical Report Distribution)SH
11200 50905 MT
(DEC Western Research Laboratory, UCO-4)SH
11200 52101 MT
(100 Hamilton Avenue)SH
11200 53297 MT
(Palo Alto, California 94301)
SH( USA)550 W
9000 54949 MT
(Reports and notes may)
203 W( also be ordered by electronic mail. Use one of the following)204 W
9000 56145 MT
(addresses:)SH
12600 58537 MT
(Digital E-net:)SH
/Courier SF
27000 XM
(DECWRL::WRL-TECHREPORTS)SH
/Times-Roman SF
12600 60929 MT
(DARPA Internet:)SH
/Courier SF
27000 XM
(WRL-Techreports@decwrl.dec.com)SH
/Times-Roman SF
12600 63321 MT
(CSnet:)SH
/Courier SF
27000 XM
(WRL-Techreports@decwrl.dec.com)SH
/Times-Roman SF
12600 65713 MT
(UUCP:)SH
/Courier SF
27000 XM
(decwrl!wrl-techreports)SH
/Times-Roman SF
9000 67465 MT
(To obtain more details)
136 W( on ordering by electronic mail, send a message to one of these)135 W
9000 68661 MT
(addresses with the word ``)101 W
/Courier SF
(help)SH
/Times-Roman SF
('' in the Subject line; you will receive detailed instruc-)101 W
9000 69857 MT
(tions.)SH
ES
%%Page: 1 3 
BS
0 SI
20 /Times-Bold AF
23954 19340 MT
(Simple and Flexible)SH
21014 21652 MT
(Datagram Access Controls)SH
21623 23964 MT
(for Unix-based Gateways)SH
16 SS 
26602 30012 MT
(Jeffrey C. Mogul)SH
14 SS 
28628 35644 MT
(March, 1989)SH
1 SS 
7 9000 72007 PB %!                      % magic number--identifies it as a PS file
50 dict begin
/verylight 0.95 def
/lightgray 0.8 def
/darkgray  0.1 def
/inch {72 mul} def
 /gstring (g) def
/logo {gsave % create a 1 unit high digital logo
  /Helvetica-Bold findfont [.6 0 0 .75 0 0] makefont setfont
   -3.425 2 div 0 translate
  /box {
    newpath
    0 0 moveto
    .425 0 lineto
    0 1 rlineto
    0 1 lineto
    closepath darkgray setgray fill
    word exch 1 getinterval
    1 setgray
    dup stringwidth pop .425 exch sub 2 div .225 moveto
    dup gstring eq {0 .05 rmoveto} if
    show
    } def

  /boxstr {gsave
    /word exch def
    0 1 word length 1 sub {box .5 0 translate} for
    grestore} def

  (digital) boxstr
  grestore} def
0.0 inch -0.33 inch translate
gsave 22 dup scale logo grestore
0.7 inch 0.1 inch moveto

/Times-Bold findfont 12 scalefont setfont
(Western Research Laboratory  ) show
/Times-Roman findfont 12 scalefont setfont
( 100 Hamilton Avenue  ) show
( Palo Alto, California 94301 USA) show
end 
 PE ES
%%Page: i 4 
BS
0 SI
15 /Times-Bold AF
29608 25445 MT
(Abstract)SH
12 SS 
13800 28165 MT
(Internetworks that)
5 W( connect multiple organizations create potential security)4 W
12600 29560 MT
(problems that cannot be solved simply by)
782 W( internal administrative)783 W
12600 30955 MT
(procedures. Organizations)
388 W( would like to restrict inter-organization access)
44 W( to)43 W
12600 32350 MT
(specific restricted hosts and applications,)
144 W( in order to limit the potential for)145 W
12600 33745 MT
(damage and)
134 W( to reduce the number of systems that must be secured against)133 W
12600 35140 MT
(attack. One)
320 W( way to restrict access is to prevent certain)
10 W( packets from entering)11 W
12600 36535 MT
(or leaving)
377 W( an organization through its gateways.  This paper describes)376 W
12600 37930 MT
(simple, flexible, and moderately efficient mechanisms for screening)
25 W( the pack-)26 W
12600 39325 MT
(ets that flow through a Unix-based gateway.)SH
/Times-Roman SF
22033 45069 MT
(This research report is a preprint of a paper)SH
17451 46355 MT
(to appear at the)SH
/Times-Italic SF
25118 XM
(Summer 1989 USENIX Technical Conference.)SH
/Times-Roman SF
10200 62160 MT
(Copyright)SH
/Symbol SF
15368 XM
(\323)SH
/Times-Roman SF
16916 XM
(1989 Digital Equipment Corporation)SH
10 SS 
32261 75600 MT
(i)SH
ES
%%Page: 1 5 
BS
0 SI
14 /Times-Bold AF
9000 8138 MT
(1. Introduction)SH
12 /Times-Roman AF
10200 10401 MT
(Internetworking has greatly improved)
216 W( communication between administratively distinct or-)215 W
9000 11796 MT
(ganizations, linking businesses, schools, and government agencies to their common benefit.)
27 W( Un-)355 W
9000 13191 MT
(fortunately, internetworks that connect multiple)
66 W( organizations create potential security problems)65 W
9000 14586 MT
(that cannot be solved by the mechanisms used within organizations, such as restricting)
71 W( physical)72 W
9000 15981 MT
(access. In)
478 W( particular, interconnection at the datagram)
89 W( level is an ``all or none'' mechanism, al-)88 W
9000 17376 MT
(lowing outsiders access to all the hosts and applications of an organization)
73 W( on the internetwork.)74 W
9000 18771 MT
(To avoid penetration, every host within)
7 W( an organization must be made secure, no small feat when)6 W
9000 20166 MT
(it involves tens of thousands of poorly-managed workstations.)SH
10200 22538 MT
(We would like to be able)
156 W( to restrict inter-organization access to specific hosts and applica-)157 W
9000 23933 MT
(tions. Doing)
366 W( so limits the potential for damage, and reduces the)
33 W( number of systems that must be)32 W
9000 25328 MT
(secured against attack.  One approach)
116 W( is to place an application-level gateway between the or-)117 W
9000 26723 MT
(ganization and the internetwork, eliminating packet-level access but supporting)
169 W( a small set of)168 W
9000 28118 MT
(approved and presumably bullet-proof applications.  Typically, these include)
209 W( electronic mail,)210 W
9000 29513 MT
(name service, and perhaps remote terminal access.)SH
10200 31885 MT
(This approach is painful because it)
44 W( requires writing application gateway software for each ap-)43 W
9000 33280 MT
(proved application, and because it may be too draconian for some organizations.)
166 W( It)
634 W( also sig-)167 W
9000 34675 MT
(nificantly reduces performance.)SH
10200 37047 MT
(A more flexible way to control access)
17 W( is to prevent certain packets from entering or leaving an)16 W
9000 38442 MT
(organization through its gateways.  This allows greater flexibility than an)
296 W( application-level)297 W
9000 39837 MT
(gateway, although as with)
29 W( any power tool it also requires greater vigilance.  Various commercial)28 W
9000 41232 MT
(gateway systems)
450 W( provide such a mechanism)
451 W( [2, 27])
SH( and it has also been treated in the)451 W
9000 42627 MT
(literature [10].)SH
10 /Symbol AF
34078 44618 MT
(\322)SH
12 /Times-Roman AF
10200 44999 MT
(Although it)
295 W( is not a good idea to use a Unix)294 W
35462 XM
(system as an internetwork gateway, the)294 W
9000 46394 MT
(popularity of 4.2BSD Unix \050and its)
149 W( successors and derivatives\051, coupled with bureaucratic in-)150 W
9000 47789 MT
(ertia, has led numerous)
3 W( organizations to use Unix-based gateways.  The mechanisms described in)2 W
9000 49184 MT
(this paper allow users of Unix-based)
149 W( gateways to impose packet-level access controls without)150 W
9000 50579 MT
(major changes to existing software.  Perhaps more important,)
183 W( by separating mechanism from)182 W
9000 51974 MT
(policy [17])
SH( so)
55 W( that arbitrarily precise access control policies may be developed as ordinary Unix)56 W
9000 53369 MT
(user processes, these)
188 W( mechanisms support fine-tuning and experimentation that would be dif-)187 W
9000 54764 MT
(ficult using commercial gateway products.)SH
10200 57136 MT
(Section 2 of this paper sets out the)
122 W( background and goals of this project, and describes pre-)123 W
9000 58531 MT
(vious work in the field.  Section 3 presents the design and implementation of a)
64 W( simple, flexible,)63 W
9000 59926 MT
(and efficient modification to the Unix kernel.  Sections 4 and 5 then describe)
39 W( two different user-)40 W
9000 61321 MT
(level daemons that make use of)
18 W( this modified kernel to provide packet-level access control.  Sec-)17 W
9000 62716 MT
(tion 6 discusses how the new mechanism may be used for purposes besides access control.)SH
14 /Times-Bold AF
9000 66534 MT
(2. Background and Goals)SH
12 /Times-Roman AF
10200 68797 MT
(The Internet Protocol \050IP\051 suite)
81 W( [15])
SH( is today the)
81 W( dominant means of connecting disparate or-)82 W
9000 70192 MT
(ganizations into an internetwork.  Virtually all of)
323 W( the practical and experimental work on)322 W
9000 71587 MT
(datagram access controls has been done using IP protocols.  Although the)
26 W( examples in this paper)27 W
10 SS 
32150 75600 MT
(1)SH
ES
%%Page: 2 6 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
5400 8023 MT
(do assume the use of IP, much of the mechanism \050especially the kernel support\051 should)
106 W( be ap-)105 W
5400 9418 MT
(plicable to any similar protocol suite, including OSI [30].)SH
6600 11790 MT
(All datagrams in an IP internetwork carry an IP header)
138 W( [24],)
SH( which includes the source and)138 W
5400 13185 MT
(destination host addresses.  In general, this is all that an IP)
279 W( gateway may assume about a)278 W
5400 14580 MT
(datagram, so one might choose to restrict access on a host-by-host basis.  \050Since IP network)184 W
5400 15975 MT
(numbers can be extracted from IP)
45 W( host addresses, and since network numbers can often be iden-)44 W
5400 17370 MT
(tified with specific organizations, an IP-level mechanism might)
57 W( also restrict datagrams based on)58 W
5400 18765 MT
(source or destination network number.\051)SH
6600 21137 MT
(In fact, however, almost all information is carried by transport protocols layered)
174 W( above IP.)173 W
5400 22532 MT
(Primarily, these)
358 W( include TCP)
359 W( [25])
SH( for reliable byte-stream applications \050mail, file transfer,)359 W
5400 23927 MT
(remote terminal access\051, and UDP)
9 W( [23])
SH( for request-response protocols \050name)
9 W( service, routing, the)8 W
5400 25322 MT
(NFS file access protocol)
7 W( [28]\051.)
SH( Certain)
314 W( control information is carried by the ICMP)
7 W( protocol)
8 W( [26].)SH
5400 26717 MT
(One may)
132 W( wish to require or restrict the use of such higher-level protocols, which can be done)131 W
5400 28112 MT
(based on information in the IP header.)SH
6600 30484 MT
(Further, the TCP and UDP protocols incorporate the concept of a ``port,'' identifying)
52 W( an end-)53 W
5400 31879 MT
(point of)
44 W( a communication path, and these protocols support the concept of ``well-known'' ports.)43 W
5400 33274 MT
(For example, a TCP remote terminal access connection will always be addressed)
56 W( to well-known)57 W
5400 34669 MT
(port 23 at the server host.)
27 W( In)
353 W( some cases, it may be useful to require or restrict access to specific)26 W
5400 36064 MT
(ports; the access-control mechanism in)
45 W( this case would have to examine the higher-level header,)46 W
5400 37459 MT
(since the source and destination ports do not appear in the IP header.)SH
13 /Times-Bold AF
5400 41210 MT
(2.1. Policy and Mechanism)SH
12 /Times-Roman AF
6600 43473 MT
(There is a wide range of access control policies from which to)
43 W( choose.  One goal of an access)42 W
5400 44868 MT
(control mechanism should be to)
30 W( allow each organization to choose its own policy, and to change)31 W
5400 46263 MT
(its policy \050perhaps quite frequently\051.  In other words, it pays to)
75 W( separate the)74 W
/Times-Italic SF
42853 XM
(mechanism)SH
/Times-Roman SF
48626 XM
(for for-)74 W
5400 47658 MT
(warding packets from the)135 W
/Times-Italic SF
18474 XM
(policy)SH
/Times-Roman SF
21843 XM
(that decides)
135 W( what should be forwarded.  Although the under-)136 W
5400 49053 MT
(lying concept has been known for a long time, the)
150 W( term)149 W
/Times-Italic SF
33851 XM
(policy/mechanism separation)149 W
/Times-Roman SF
48551 XM
(was in-)149 W
5400 50448 MT
(vented by the designers of the Hydra system)
15 W( [17],)
SH( who established it as a ``basic)
15 W( design principle)16 W
5400 51843 MT
(... of a kernel)
5 W( composed \050almost\051 entirely of mechanisms.''  Policies were embodied in user-level)4 W
5400 53238 MT
(processes, thus improving flexibility while keeping the)
18 W( kernel simpler and presumably more reli-)19 W
5400 54633 MT
(able.)SH
6600 57005 MT
(The Unix kernel, on the)
167 W( other hand, contains most of the policy functions of the operating)166 W
5400 58400 MT
(system. There)
366 W( are a few exceptions; for example, in 4.2BSD Unix, the disk quota mechanism)
33 W( in)34 W
5400 59795 MT
(the kernel receives quota information from)
36 W( user-level processes, and the network routing table is)35 W
5400 61190 MT
(maintained by a user-level process.  Still, in the Unix model the kernel makes the decisions.)SH
6600 63562 MT
(The system described in this paper adheres to the Hydra model:  a simple,)
35 W( general mechanism)36 W
5400 64957 MT
(inside the kernel ``asks'' a user-level process to pass judgement on)
150 W( every packet that is to be)149 W
5400 66352 MT
(forwarded. The)
304 W( kernel makes no access control decisions; rather, it provides the packet header)
2 W( to)3 W
5400 67747 MT
(the user process, which then tells the kernel whether or not)
116 W( to forward the packet.  The kernel)115 W
5400 69142 MT
(mechanism is simple \050it took about one day to)
73 W( code and test\051 and robust \050a failure of the policy)74 W
5400 70537 MT
(module should not result in)
119 W( a system crash, or indeed in any consequential failure save a tem-)118 W
5400 71932 MT
(porary suspension of packet forwarding\051.  Further details on the kernel mechanism are given in)83 W
5400 73327 MT
(section 3.)SH
10 SS 
28550 75600 MT
(2)SH
ES
%%Page: 3 7 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
10200 8023 MT
(Once this kernel mechanism is in place, it)
102 W( is easy to experiment with policy modules imple-)101 W
9000 9418 MT
(mented as normal Unix user processes.  Section 4 describes)
254 W( an implementation based on a)255 W
9000 10813 MT
(daemon process that checks each packet against the criteria specified in)
205 W( a configuration file.)204 W
9000 12208 MT
(This program is able to filter based on arbitrary criteria, including transport-level header infor-)107 W
9000 13603 MT
(mation.)SH
10200 15975 MT
(An alternative design is sketched in section 5.)
75 W( In)
449 W( this design, a user-level process would im-)74 W
9000 17370 MT
(plement a)168 W
/Times-Italic SF
14337 XM
(visa)SH
/Times-Roman SF
16739 XM
(protocol [10].)
SH( In)
636 W( visa protocols, there is no)
168 W( configuration file at the gateway;)169 W
9000 18765 MT
(rather, the source host is required to attach a cryptographically-secured mark to)
169 W( the datagram)168 W
9000 20160 MT
(header, proving to)
1 W( the gateway that this datagram is authorized to be forwarded.  Authorization is)2 W
9000 21555 MT
(done by an ``access control server'' distinct from)
131 W( the gateway; thus, visa protocols employ an)130 W
9000 22950 MT
(additional level of policy/mechanism separation.)SH
10200 25322 MT
(One subtle \050but explicit\051)
194 W( aspect of the IP architecture is that gateways are stateless packet)195 W
9000 26717 MT
(switches, not required to maintain)
236 W( any history of previous packets)
235 W( [4].)
SH( The)
770 W( policy modules)235 W
9000 28112 MT
(described in this paper can accommodate a certain amount of gateway state \050see)
24 W( section 4.3\051, but)25 W
9000 29507 MT
(may not support a protocol requiring significant gateway state.  This is)
124 W( because so little infor-)123 W
9000 30902 MT
(mation is passed between the)
18 W( gateway function in the Unix kernel and the decision-making func-)19 W
9000 32297 MT
(tion in the user process; neither function has access to the history of the other.  This is)
154 W( not a)153 W
9000 33692 MT
(serious problem for the IP protocol.)SH
13 /Times-Bold AF
9000 37443 MT
(2.2. Related Work)SH
12 /Times-Roman AF
10200 39706 MT
(It has long been recognized that an organization may protect itself against unwanted network)74 W
9000 41101 MT
(connections by blocking)
276 W( them in its gateways.  One simple approach is to remove from a)275 W
9000 42496 MT
(gateway's routing tables routes to specific networks, thus making it)
163 W( impossible for a ``local'')164 W
9000 43891 MT
(host to send packets to them.  \050Most protocols require at least some bidirectional packet flow)146 W
9000 45286 MT
(even for unidirectional data flow, so breaking the route in only)
373 W( one direction is usually)374 W
9000 46681 MT
(sufficient.\051 This)
426 W( approach, of course, does not)
63 W( work when the point is to permit access to some)62 W
9000 48076 MT
(local hosts but not others.)SH
10200 50448 MT
(Most \050perhaps)
62 W( all\051 commercially-available gateway systems now provide the ability to screen)63 W
9000 51843 MT
(packets based not only on destinations, but on sources or source-destination pairs.  For)
40 W( example,)39 W
9000 53238 MT
(the Proteon p4200 gateway)
115 W( [27])
SH( allows the manager to specify)
115 W( access based on pairs of IP ad-)116 W
9000 54633 MT
(dresses; each address is combined with a specified mask before comparison, so that)
164 W( the pairs)163 W
9000 56028 MT
(may refer to networks or subnets instead of specific hosts.)SH
10200 58400 MT
(Gateway products from cisco Systems)
105 W( [2])
SH( support a more complicated screening scheme, al-)106 W
9000 59795 MT
(lowing finer control over source or destination)
7 W( addresses.  For example, one could deny access to)6 W
9000 61190 MT
(all but one host on a particular network.  The cisco)
43 W( gateways also allow discrimination based on)44 W
9000 62585 MT
(IP protocol type, and TCP or UDP port numbers.)SH
10200 64957 MT
(Unlike access controls based on gateway-resident configuration tables,)233 W
/Times-Italic SF
46366 XM
(Visa)SH
/Times-Roman SF
49032 XM
(protocols [10])SH
9000 66352 MT
(control the path between specific)
56 W( pairs of hosts.  Moreover, visa protocols provide some protec-)57 W
9000 67747 MT
(tion against forged datagram)
65 W( headers, by proving that the source address of a packet is genuine.)64 W
9000 69142 MT
(Visas thus protect against malefactors within the local organization, as well as those)
23 W( outside, and)24 W
9000 70537 MT
(because policy decisions are made by a server distinct from the gateway,)
169 W( one can employ an)168 W
9000 71932 MT
(arbitrarily complex policy without)
25 W( fear of overwhelming the gateway.  In spite of the advantages)26 W
10 SS 
32150 75600 MT
(3)SH
ES
%%Page: 4 8 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
5400 8023 MT
(of visa protocols, they require explicit)
87 W( support from host implementations and increase the per-)86 W
5400 9418 MT
(packet effort at gateways, so they are only in experimental use [9].)SH
6600 11790 MT
(The kernel-resident mechanism described in section)
22 W( 3 owes an intellectual debt to the ``packet)23 W
5400 13185 MT
(filter'' mechanism)
5 W( [21])
SH( used to give)
5 W( user processes efficient access to arbitrary datagrams.  In the)4 W
5400 14580 MT
(packet filter, the kernel applies user-specified criteria to received packets before)
72 W( demultiplexing)73 W
5400 15975 MT
(the packets to the appropriate process.)
10 W( This)
319 W( is the reverse of the situation described in this paper,)9 W
5400 17370 MT
(where decisions are made in user processes and consumed by the kernel,)
164 W( but the principle of)165 W
5400 18765 MT
(doing the more complex job at user level remains the same.)SH
14 /Times-Bold AF
5400 22583 MT
(3. Kernel support)SH
12 /Times-Roman AF
6600 24846 MT
(The mechanism described in this section is called the)31 W
/Times-Italic SF
32718 XM
(gateway screen)31 W
/Times-Roman SF
(. It)
361 W( has been experimen-)30 W
5400 26241 MT
(tally implemented in the context of the Ultrix)90 W
/Symbol SF
(\324)SH
/Times-Roman SF
29262 XM
(3.0 operating system.)
90 W( Since)
482 W( the IP forwarding)91 W
5400 27636 MT
(code in Ultrix)
96 W( is nearly identical to that in 4.3BSD Unix, this mechanism should port to nearly)95 W
5400 29031 MT
(any 4.2BSD-derived kernel with only minor modifications.  Porting it)
40 W( to unrelated Unix kernels,)41 W
5400 30426 MT
(or to other operating systems,)
109 W( may require changes in various details.  The presentation in this)108 W
5400 31821 MT
(section assumes the use of a 4.2BSD-derived kernel.)SH
13 /Times-Bold AF
5400 35572 MT
(3.1. Overview)SH
12 /Times-Roman AF
6600 37841 MT
(When an IP packet is received by the kernel, it is first processed by the)108 W
/Times-BoldItalic SF
42557 XM
(ip_intr\050\051)SH
/Times-Roman SF
47101 XM
(procedure,)SH
5400 39236 MT
(which determines if the packet is)
78 W( meant for ``this host.'' If not, then the packet is passed to the)77 W
/Times-BoldItalic SF
5400 40631 MT
(ip_forward\050\051)SH
/Times-Roman SF
11993 XM
(procedure, which determines whether and how to forward the)
25 W( packet to its ultimate)26 W
5400 42026 MT
(destination. The)384 W
/Times-BoldItalic SF
13861 XM
(ip_intr\050\051)SH
/Times-Roman SF
18338 XM
(procedure runs as an interrupt handler, not in the context of a specific)41 W
5400 43421 MT
(process.)SH
6600 45793 MT
(The gateway)
199 W( screen intercepts packets just before they are passed to)200 W
/Times-BoldItalic SF
41766 XM
(ip_forward\050\051)SH
/Times-Roman SF
(. These)700 W
5400 47188 MT
(potentially-forwardable packets are placed on a queue,)
62 W( and any processes waiting for this queue)61 W
5400 48583 MT
(are awakened.  \050A process waits for this event by executing a particular system call.\051)
37 W( When)
376 W( any)38 W
5400 49978 MT
(such process)
163 W( wakes up, it removes a pending packet from this queue. The kernel extracts the)162 W
5400 51373 MT
(datagram header from the packet, wraps this with some control information, and passes the result)9 W
5400 52768 MT
(out to the user-level)
92 W( process.  The system call then completes, allowing the user process to run)91 W
5400 54163 MT
(and decide if the packet)
195 W( in question should be forwarded.  The user process, through a sub-)196 W
5400 55558 MT
(sequent system call, informs the kernel of its decision, and)
52 W( the kernel either drops the packet, or)51 W
5400 56953 MT
(passes it on to)SH
/Times-BoldItalic SF
12469 XM
(ip_forward\050\051)SH
/Times-Roman SF
(.)SH
6600 59325 MT
(The kernel effectively acts as the ``client'' of a ``server process'')
97 W( implemented at user level.)98 W
5400 60720 MT
(The user process, however, makes the calls into the kernel, not)
14 W( vice-versa.  One may view this as)13 W
5400 62115 MT
(a relationship structured entirely of ``up-calls'')
71 W( [3],)
SH( with no ``down-calls'' at all.  This)
71 W( structure)72 W
5400 63510 MT
(requires the solution to certain)
147 W( problems \050starvation, matching of requests with responses\051 not)146 W
5400 64905 MT
(present in)
42 W( a more conventional client-server interaction, but it makes use of the synchronization,)43 W
5400 66300 MT
(protection, and control mechanisms already provided by the normal system call implementation.)SH
6600 68672 MT
(We can now look at the implementation in greater detail.)SH
10 SS 
28550 75600 MT
(4)SH
ES
%%Page: 5 9 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
13 /Times-Bold AF
9000 8071 MT
(3.2. Interrupt-level functions)SH
12 /Times-Roman AF
10200 10340 MT
(Not much processing is required)
9 W( at interrupt level.  The)8 W
/Times-BoldItalic SF
37188 XM
(ip_intr\050\051)SH
/Times-Roman SF
41632 XM
(procedure is modified to pass)8 W
9000 11735 MT
(packets to the)457 W
/Times-BoldItalic SF
17272 XM
(gw_forwardscreen\050\051)SH
/Times-Roman SF
27963 XM
(procedure, instead of directly to)457 W
/Times-BoldItalic SF
45850 XM
(ip_forward\050\051)SH
/Times-Roman SF
(. The)1216 W
/Times-BoldItalic SF
9000 13130 MT
(gw_forwardscreen\050\051)SH
/Times-Roman SF
19334 XM
(procedure allocates a)
100 W( small control block to contain information about the)99 W
9000 14525 MT
(packet, records the address of the packet buffer \050``mbuf chain''\051 in this control block, puts the)113 W
9000 15920 MT
(control block on a queue of ``pending'' packets, and issues a)79 W
/Times-BoldItalic SF
39337 XM
(wakeup\050\051)SH
/Times-Roman SF
44316 XM
(call. The)
458 W( control block)79 W
9000 17315 MT
(includes fields for the)
9 W( packet arrival time and a unique transaction identifier, which are set in this)10 W
9000 18710 MT
(procedure.)SH
10200 21082 MT
(Since the kernel has little control over how fast the user-level)
62 W( process responds to requests, it)61 W
9000 22477 MT
(would be unwise to allocate)
110 W( control blocks directly out of kernel dynamic memory, for fear of)111 W
9000 23872 MT
(using it)
92 W( up.  Instead, the gateway screen maintains a limited pool \050currently 32 items\051 of preal-)91 W
9000 25267 MT
(located control blocks; this not only avoids using up memory, but makes allocation much faster.)SH
10200 27639 MT
(Since this limits the number of pending)
5 W( packets, we must have some policy to apply to packets)6 W
9000 29034 MT
(arriving when our private free list is empty.)
120 W( Two)
539 W( policies suggest themselves: accept the new)119 W
9000 30429 MT
(packet and drop an old one,)
111 W( or drop all new packets until some old ones have been processed.)112 W
9000 31824 MT
(The former policy is)
9 W( more expensive to implement, and the latter policy conforms to the assump-)8 W
10 SS 
45124 32838 MT
(1)SH
12 SS 
9000 33219 MT
(tions of various congestion-avoidance and congestion-control mechanisms)53 W
45624 XM
(. Since)
404 W( dropping the)52 W
9000 34614 MT
(incoming packet is both easier and ``better,'' that is what)
213 W( is done.  \050Even when a packet is)214 W
9000 36009 MT
(dropped, a)SH
/Times-BoldItalic SF
14366 XM
(wakeup\050\051)SH
/Times-Roman SF
19266 XM
(is still done, in case there are server processes sleeping.\051)SH
13 /Times-Bold AF
9000 39760 MT
(3.3. Programming interface)SH
12 /Times-Roman AF
10200 42023 MT
(Before we look at the)
48 W( implementation of the system call interface, it is helpful to examine the)47 W
9000 43418 MT
(alternatives for communicating information across the user-kernel boundary.  There are two)242 W
9000 44813 MT
(ways to do this in Unix: either the information)
225 W( is moved as the parameter \050by-value or by-)224 W
9000 46208 MT
(reference\051 of a system call, or it is)
86 W( moved via the I/O mechanisms over a file descriptor \050I/O is)87 W
9000 47603 MT
(done with system calls, of course, but these calls leave little room for improvisation\051.)SH
10200 49975 MT
(Note that)
59 W( for each packet, we need to communicate information out of the kernel, let the user)58 W
9000 51370 MT
(process run,)
161 W( and then communicate the decision back into the kernel.  We do not necessarily)162 W
9000 52765 MT
(have to make two system calls per packet; the trick is to pass one decision into the kernel)
40 W( on the)39 W
9000 54160 MT
(same system call that passes the following)
42 W( packet's information out of the kernel.  If we want to)43 W
9000 55555 MT
(use this trick, then we cannot use the normal I/O mechanisms \050e.g.,)SH
/Times-BoldItalic SF
41538 XM
(read/write)SH
/Times-Roman SF
46840 XM
(or)SH
/Times-BoldItalic SF
48140 XM
(send/recv)SH
/Times-Roman SF
(\051.)SH
10200 57927 MT
(Perhaps the cleanest approach would be to invent)
47 W( a new system call with one ``in'' parameter)46 W
9000 59322 MT
(and one)
199 W( ``out'' parameter.  Adding a new system call to the Unix kernel, however, requires)200 W
9000 60717 MT
(changing a number of files within the kernel, as well as the system call interface library, and this)25 W
9000 62112 MT
(seemed too painful.)SH
10800 50 9000 66675 UL
8 SS 
10000 68340 MT
(1)SH
10 SS 
10400 68685 MT
(Nagle implies as much with his statement that, when facing buffer exhaustion,)
164 W( a gateway should ``drop the)165 W
9000 69790 MT
(packet at the end of the longest queue, since it is the one)
13 W( that would be transmitted last.'')
12 W( [22])
SH( Jacobson's)
274 W( work)
12 W( [12])SH
9000 70895 MT
(implies that gateways should give preference)
11 W( to the earlier packets in a multiple-packet window, since they are more)12 W
9000 72000 MT
(likely to be retransmitted immediately once congestion is detected.)SH
32150 75600 MT
(5)SH
ES
%%Page: 6 10 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
6600 8023 MT
(The approach actually taken was to define a few new)56 W
/Times-Italic SF
32957 XM
(ioctl)SH
/Times-Roman SF
35448 XM
(requests. Since)
412 W( an ioctl parameter)57 W
5400 9418 MT
(can be ``value-result'' \050both ``in'' and ``out''\051, we can use the ``one system-call'' trick, and)195 W
5400 10813 MT
(since adding a new ioctl request)
220 W( requires no new code aside from where the request is dis-)221 W
5400 12208 MT
(patched, it is easy to make this change.  The disadvantages)
61 W( are that an ioctl parameter can carry)60 W
5400 13603 MT
(at most 127 bytes of)
121 W( data, and that the entire parameter is copied in both directions.  The size)122 W
5400 14998 MT
(limit is not actually a problem \050the largest possible)
43 W( IP header is 60 bytes, and the largest reason-)42 W
5400 16393 MT
(able TCP header is 24 bytes\051.  The extra data copying)
66 W( is a slight disadvantage \050compared to the)67 W
5400 17788 MT
(``new system call'' approach\051 but is less costly than having to do twice as many system calls.)SH
6600 20160 MT
(The)SH
/Times-BoldItalic SF
8855 XM
(screen_data)SH
/Times-Roman SF
15178 XM
(structure passed between kernel and user space for the SIOCSCREEN)
89 W( ioctl)88 W
5400 21555 MT
(request contains a)
132 W( prefix of the packet \050including at least the packet headers\051, a timestamp in-)133 W
5400 22950 MT
(dicating when the packet was received, and a transaction)
138 W( identifier to be used in matching re-)137 W
5400 24345 MT
(quests with responses.  This is necessary because there is no ``connection'' \050such as a)
253 W( file)254 W
5400 25740 MT
(descriptor\051 established between the kernel)
11 W( and the server process, so there is no other way for the)10 W
5400 27135 MT
(kernel to associate the decision passed in on one system call with)
5 W( the information passed out on a)6 W
5400 28530 MT
(previous one.  Figure 1 shows the layout of the)SH
/Times-BoldItalic SF
28236 XM
(screen_data)SH
/Times-Roman SF
34470 XM
(structure.)SH
11 /Courier-Bold AF
7200 30557 MT
(/*)SH
7860 31781 MT
(* Some fields of this struct are "OUT" fields \050kernel write,)SH
7860 33005 MT
(* user read\051, and some are "IN" \050user write, kernel read\051.)SH
7860 34229 MT
(*/)SH
7200 36677 MT
(struct screen_data_hdr {)SH
9840 37901 MT
(short sdh_count;)
SH( /*)
1980 W( length of entire record */)
SH( /*)
1320 W( OUT */)SH
9840 39125 MT
(short sdh_dlen;)
SH( /*)
2640 W( bytes of packet header */)
SH( /*)
1980 W( OUT */)SH
9840 40349 MT
(u_long sdh_xid;)
SH( /*)
2640 W( transaction ID */)
SH( /*)
7260 W( OUT */)SH
9840 41573 MT
(struct timeval)SH
12480 42797 MT
(sdh_arrival; /*)
1980 W( time this pkt arrived */)
SH( /*)
2640 W( OUT */)SH
9840 44021 MT
(short sdh_family;)
SH( /*)
1320 W( address family */)
SH( /*)
7260 W( OUT */)SH
9840 45245 MT
(int sdh_action;)
SH( /*)
2640 W( disposition for this pkt */  /* IN */)SH
23040 46469 MT
(/* see)
3300 W( defs below)
SH( */)3300 W
7200 47693 MT
(};)SH
7200 50141 MT
(/* Possible dispositions of the packet */)SH
7200 51365 MT
(#define SCREEN_ACCEPT)
SH( 0x0001)
1320 W( /*)
660 W( Accept this packet */)SH
7200 52589 MT
(#define SCREEN_DROP)
SH( 0x0000)
2640 W( /*)
660 W( Don't accept this packet */)SH
7200 53813 MT
(#define SCREEN_NOTIFY)
SH( 0x0002)
1320 W( /*)
660 W( Notify the sender of failure */)SH
7200 55037 MT
(#define SCREEN_NONOTIFY 0x0000  /* Don't notify the sender */)SH
7200 57485 MT
(/* Screening information + the actual packet  */)SH
7200 59933 MT
(#define SCREEN_MAXLEN 120)
SH( /*)
3960 W( length of struct screen_data */)SH
7200 61157 MT
(#define SCREEN_DLEN \050SCREEN_MAXLEN - sizeof\050struct screen_data_hdr\051\051)SH
7200 63605 MT
(struct screen_data {)SH
9840 64829 MT
(struct screen_data_hdr sd_hdr;)
SH( /*)
13860 W( IN/OUT */)SH
9840 66053 MT
(char sd_data[SCREEN_DLEN];  /* pkt headers */)
SH( /*)
3960 W( OUT */)SH
7200 67277 MT
(};)SH
12 /Times-Bold AF
17399 69330 MT
(Figure 1:)SH
/Times-Roman SF
22999 XM
(Layout of the)SH
/Times-BoldItalic SF
29766 XM
(screen_data)SH
/Times-Roman SF
36000 XM
(structure)SH
10 SS 
28550 75600 MT
(6)SH
ES
%%Page: 7 11 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
10200 8023 MT
(The lack of a connection creates some complexity in the)
64 W( kernel implementation, but it avoids)63 W
9000 9418 MT
(the greater)
91 W( complexity of creating and managing connections, and in particular avoids the need)92 W
9000 10813 MT
(to garbage-collect connections belonging to dead processes.)SH
10200 13185 MT
(The structure passed between kernel and user space also contains one field that is set by)
104 W( the)103 W
9000 14580 MT
(user process, to indicate whether or not the packet should be forwarded, and if)
183 W( the packet is)184 W
9000 15975 MT
(rejected, whether or not to notify the source host.  \050The ICMP protocol provides a)
96 W( means for a)95 W
9000 17370 MT
(gateway to notify a)
199 W( host that a packet has been dropped; unfortunately, there is no ``Access)200 W
9000 18765 MT
(Violation'' message, so we must make do with an approximation)
697 W( such as ``Host)696 W
10 SS 
16165 19779 MT
(2)SH
12 SS 
9000 20160 MT
(Unreachable.'')SH
16665 XM
(\051)SH
10200 22532 MT
(In addition to SIOCSCREEN, new ioctls are defined to turn screening on)
574 W( or off)575 W
9000 23927 MT
(\050SIOCSCREENON\051 and to)
482 W( get statistics information \050SIOCSCREENSTATS\051.  Only the)481 W
9000 25322 MT
(SIOCSCREENSTATS request is available to unprivileged processes; processes must)
46 W( be running)47 W
9000 26717 MT
(as the super-user to execute the other requests.)SH
10200 29089 MT
(Figure 2 shows the complete source of an simple daemon program that ``decides'' to reject all)24 W
9000 30484 MT
(packets.)SH
13 /Times-Bold AF
9000 34235 MT
(3.4. Process-context functions)SH
12 /Times-Roman AF
10200 36498 MT
(When the user process issues the SIOCSCREEN request \050over a file descriptor returned)
14 W( by the)15 W
/Times-BoldItalic SF
9000 37893 MT
(socket\050\051)SH
/Times-Roman SF
13342 XM
(system call\051, control in the kernel)
175 W( passes to the)174 W
/Times-BoldItalic SF
37652 XM
(ifioctl)SH
/Times-Roman SF
(\050\051 procedure.  This is the only)174 W
9000 39288 MT
(place besides)178 W
/Times-BoldItalic SF
16023 XM
(ip_intr\050\051)SH
/Times-Roman SF
20637 XM
(that must be modified to support the gateway screen.  This)
178 W( procedure)179 W
9000 40683 MT
(simply transfers control)
29 W( to a procedure called)28 W
/Times-BoldItalic SF
31235 XM
(screen_control\050\051)SH
/Times-Roman SF
39698 XM
(if any of the gateway screen ioctl)28 W
9000 42078 MT
(requests are made.)SH
10200 44450 MT
(When viewed as)
68 W( a complete system call, the SIOCSCREEN request starts by copying a deci-)69 W
9000 45845 MT
(sion into the kernel, sleeps waiting for a new packet, and then copies new information out of)
37 W( the)36 W
9000 47240 MT
(kernel. Since)
334 W( there is no connection between what)
17 W( happens before and after the sleep, it is easier)18 W
9000 48635 MT
(to describe a complete cycle starting with the sleep rather than starting with the system call.)SH
10200 51007 MT
(Each packet in the pending queue is)
67 W( either ``claimed'' or ``unclaimed.''  A claimed packet is)66 W
9000 52402 MT
(marked with the process ID of a process that has been given this packet to act)
133 W( on.  When the)134 W
9000 53797 MT
(process awakens from its sleep, it checks the)
6 W( queue of pending packets to see if there are any that)5 W
9000 55192 MT
(have not yet been claimed.  The pending-packet queue is managed first-in, first-out to)
190 W( avoid)191 W
9000 56587 MT
(unfairly delaying any packet.  If no unclaimed packets exist, the process returns to sleep.)
31 W( Other-)361 W
9000 57982 MT
(wise, the packet is marked with)
64 W( the current process ID.  A prefix of the packet, and other infor-)65 W
9000 59377 MT
(mation from the control block, is copied into a)46 W
/Times-BoldItalic SF
32020 XM
(screen_data)SH
/Times-Roman SF
38300 XM
(structure, and the ioctl request com-)46 W
9000 60772 MT
(pletes in the)
83 W( normal way; since the kernel ``knows'' that the ioctl parameter is value-result, the)84 W
/Times-BoldItalic SF
9000 62167 MT
(screen_data)SH
/Times-Roman SF
15234 XM
(structure is copied out to the user process.)SH
10800 50 9000 67780 UL
8 SS 
10000 69445 MT
(2)SH
10 SS 
10400 69790 MT
(The ``Blacker'' system)
156 W( [6],)
SH( which provides military-style security by interposing cryptographic hardware)
156 W( be-)155 W
9000 70895 MT
(tween secure hosts and)
88 W( an insecure backbone network, does define an appropriate ICMP code, but no commonly-)89 W
9000 72000 MT
(used host software recognizes it.)SH
32150 75600 MT
(7)SH
ES
%%Page: 8 12 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
11 /Courier-Bold AF
7200 7941 MT
(#include <sys/types.h>)SH
7200 9165 MT
(#include <sys/time.h>)SH
7200 10389 MT
(#include <sys/socket.h>)SH
7200 11613 MT
(#include <sys/ioctl.h>)SH
7200 12837 MT
(#include <net/if.h>)SH
7200 14061 MT
(#include <net/ip_screen.h>)SH
7200 16509 MT
(main\050\051)SH
7200 17733 MT
({)SH
9840 18957 MT
(int s;)SH
9840 20181 MT
(struct screen_data scdata;)SH
9840 22629 MT
(if \050\050s = socket\050AF_INET, SOCK_DGRAM, 0\051\051 < 0\051 {)SH
12480 23853 MT
(perror\050"socket"\051;)SH
12480 25077 MT
(exit\0501\051;)SH
9840 26301 MT
(})SH
9840 28749 MT
(scdata.sdh_xid = 0; /* start with garbage transaction id */)SH
9840 29973 MT
(while \0501\051 {)SH
12480 31197 MT
(if \050ioctl\050s, SIOCSCREEN, \050caddr_t\051&scdata\051 < 0\051 {)SH
15120 32421 MT
(perror\050"ioctl \050SIOCSCREEN\051"\051;)SH
15120 33645 MT
(exit\0501\051;)SH
12480 34869 MT
(})SH
12480 36093 MT
(printf\050"dropping pkt, transaction %d\134n", scdata.sdh_xid\051;)SH
12480 37317 MT
(scdata.sdh_action = SCREEN_DROP;)SH
9840 38541 MT
(})SH
7200 39765 MT
(})SH
12 /Times-Bold AF
16215 41812 MT
(Figure 2:)SH
/Times-Roman SF
21815 XM
(Example program that rejects all packets)SH
6600 44184 MT
(Once the user process has made its decision,)
160 W( it sets the appropriate bits in the)159 W
/Times-BoldItalic SF
46266 XM
(screen_data)SH
/Times-Roman SF
5400 45579 MT
(structure and reissues the SIOCSCREEN request.  Again, the kernel knows to copy)
387 W( the)388 W
/Times-BoldItalic SF
5400 46974 MT
(screen_data)SH
/Times-Roman SF
11773 XM
(structure into the kernel,)
139 W( and control is passed to the)138 W
/Times-BoldItalic SF
38528 XM
(screen_control\050\051)SH
/Times-Roman SF
47101 XM
(procedure.)SH
5400 48369 MT
(At this point, the kernel must match the decision in this SIOSCREEN request to one of)
19 W( the pack-)20 W
5400 49764 MT
(ets on the pending-packet queue.)SH
6600 52136 MT
(Since the)72 W
/Times-BoldItalic SF
11478 XM
(screen_data)SH
/Times-Roman SF
17784 XM
(structure contains the unique)
72 W( transaction identifier stored in the packet)71 W
5400 53531 MT
(control block, the kernel simply)
150 W( searches the pending queue for a packet with the right trans-)151 W
5400 54926 MT
(action identifier.  If none are found, then the user process has made a mistake)
85 W( \050or is making its)84 W
5400 56321 MT
(first system call\051 and no further action is taken.  If, during)
53 W( the search, packets are found that are)54 W
5400 57716 MT
(claimed by the)
42 W( current process, but that do not have the right transaction identifier, then the user)41 W
5400 59111 MT
(process has failed to follow first-in, first-out order; these packets are removed)
135 W( from the queue)136 W
5400 60506 MT
(and simply dropped.)SH
6600 62878 MT
(Assuming that a matching packet is found, if the decision encoded in the)102 W
/Times-BoldItalic SF
43131 XM
(screen_data)SH
/Times-Roman SF
49466 XM
(struc-)SH
5400 64273 MT
(ture is positive, then the packet is passed to)270 W
/Times-BoldItalic SF
28902 XM
(ip_forward\050\051)SH
/Times-Roman SF
(, as if it had)
270 W( come directly from)271 W
10 SS 
9536 65287 MT
(3)SH
12 /Times-BoldItalic AF
5400 65668 MT
(ip_intr\050\051)SH
/Times-Roman SF
10036 XM
(. The)691 W
/Times-BoldItalic SF
13688 XM
(ip_forward\050\051)SH
/Times-Roman SF
20451 XM
(procedure may of course decide not to forward the packet \050for)195 W
5400 67063 MT
(example, because no route exists\051 but this decision is made independent of access control.)SH
10800 50 5400 68086 UL
8 SS 
6400 69751 MT
(3)SH
10 SS 
6800 70096 MT
(There is a)
186 W( subtle difference: normally, when)187 W
/Times-BoldItalic SF
26047 XM
(ip_intr\050\051)SH
/Times-Roman SF
29929 XM
(calls)SH
/Times-BoldItalic SF
32199 XM
(ip_forward\050\051)SH
/Times-Roman SF
37858 XM
(it does so at an elevated interrupt)187 W
5400 71201 MT
(priority level \050IPL\051, but the gateway screen calls)39 W
/Times-BoldItalic SF
25291 XM
(ip_forward\050\051)SH
/Times-Roman SF
30801 XM
(at low IPL.  This does not seem to be a problem, but)38 W
5400 72306 MT
(one must be careful to ensure that)SH
/Times-BoldItalic SF
19147 XM
(ip_forward\050\051)SH
/Times-Roman SF
24619 XM
(does not assume it is called at any particular IPL.)SH
28550 75600 MT
(8)SH
ES
%%Page: 9 13 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
10200 8023 MT
(If the)
57 W( user process instead decided against forwarding the packet, it is simply dropped.  If the)58 W
9000 9418 MT
(user process requested that the sender be notified, the)69 W
/Times-BoldItalic SF
35557 XM
(icmp_error\050\051)SH
/Times-Roman SF
42260 XM
(procedure is called with the)68 W
9000 10813 MT
(appropriate arguments, causing an ICMP Host Unreachable message to be sent.)SH
10200 13185 MT
(At this point, the cycle is complete.  The packet control block is put back on the)
81 W( private free)82 W
9000 14580 MT
(list, and the user process is put back to sleep \050after checking the pending-packet)
77 W( queue to make)76 W
9000 15975 MT
(sure that no additional packets are waiting\051.)SH
10200 18347 MT
(Earlier it was pointed out that there are a limited number)
49 W( of packet control blocks.  Since it is)50 W
9000 19742 MT
(possible for a user process to claim a packet and then die without providing a decision, the)210 W
9000 21137 MT
(pending-packet queue could fill up with junk.  Therefore, if when the pending-packet)
114 W( queue is)115 W
9000 22532 MT
(searched and no unclaimed packets are found,)
73 W( and if the private free list is empty, we make the)72 W
9000 23927 MT
(assumption that)
183 W( something is wrong.  All packets older than a threshold age \050for example, 5)184 W
9000 25322 MT
(seconds\051 are simply removed)
184 W( from the queue and dropped.  If their ``owning'' processes are)183 W
9000 26717 MT
(actually still alive and subsequently do render a)
30 W( decision, this causes no further problems.  Thus,)31 W
9000 28112 MT
(if a large number of)
115 W( processes do fail, the worst outcome is that the gateway stops forwarding)114 W
9000 29507 MT
(packets for several seconds \050provided that additional screening processes exist or are restarted\051.)SH
13 /Times-Bold AF
9000 33258 MT
(3.5. Protocol-independence)SH
12 /Times-Roman AF
10200 35521 MT
(None of the code within the kernel implementation of the screening module makes any as-)152 W
9000 36916 MT
(sumption about the content of the packets being handled \050including the layout of the packet)209 W
9000 38311 MT
(headers\051. The)
476 W( only protocol-dependent actions required are the calls to either forward a packet)88 W
9000 39706 MT
(or to send an error notification.  These procedures are called indirectly, through)
2 W( pointers stored in)1 W
9000 41101 MT
(the control block that were provided)
893 W( by the protocol-specific code that called)894 W
/Times-BoldItalic SF
9000 42496 MT
(gw_forwardscreen\050\051)SH
/Times-Roman SF
(. To)
962 W( add screening for a new protocol)
331 W( family, one need only supply)330 W
9000 43891 MT
(protocol-specific forwarding and error functions, and insert a call to)80 W
/Times-BoldItalic SF
42704 XM
(gw_forwardscreen\050\051)SH
/Times-Roman SF
53018 XM
(in the)81 W
9000 45286 MT
(appropriate place.)SH
10200 47658 MT
(Since it is necessary for)
122 W( the user process to know which kind of packet it is processing, the)121 W
9000 49053 MT
(protocol-specific module also)
221 W( provides a type code \050the ``address family'': AF_INET for IP)222 W
9000 50448 MT
(packets\051 that is stored in the protocol control block and passed to the user process)
39 W( \050see figure 1\051.)38 W
9000 51843 MT
(A process can ``request'' to receive packets of only)
166 W( one family by setting the)167 W
/Courier SF
48600 XM
(sdh_family)SH
/Times-Roman SF
9000 53238 MT
(field when it passes a)SH
/Times-BoldItalic SF
19568 XM
(screen_data)SH
/Times-Roman SF
25802 XM
(structure to the kernel.)SH
13 /Times-Bold AF
9000 56989 MT
(3.6. Performance)SH
12 /Times-Roman AF
10200 59252 MT
(In order)
36 W( to get an idea of the performance of the kernel portion of the implementation, we can)35 W
9000 60647 MT
(look at the limiting case of a minimal user-level)
78 W( daemon: for example, the program in figure 2,)79 W
9000 62042 MT
(changed to accept all packets without examining them.)SH
10200 64414 MT
(The most interesting characterization of performance)
172 W( is the increment in delay over an un-)171 W
9000 65809 MT
(modified Unix-based gateway.  \050It is much easier to measure round-trip delays rather than one-)83 W
9000 67204 MT
(way delays; we must assume that the)
63 W( underlying one-way delay is about half of the total.\051  This)62 W
9000 68599 MT
(increment is easily measured using the ICMP Echo protocol, which is especially convenient be-)61 W
9000 69994 MT
(cause all)
186 W( the processing in the ``echo server'' host is done in the Ultrix kernel, reducing the)185 W
9000 71389 MT
(variance in delay.)SH
10 SS 
32150 75600 MT
(9)SH
ES
%%Page: 10 14 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
6600 8023 MT
(The performance in this)
90 W( case depends mostly on the cost of transferring data and control be-)91 W
5400 9418 MT
(tween kernel and user contexts; that is,)
89 W( system call overhead dominates the cost of code within)88 W
5400 10813 MT
(the gateway screen implementation.)
71 W( The)
443 W( entire pending-packet queue is searched once per sys-)72 W
5400 12208 MT
(tem call, so to some extent the length of that queue affects performance.  Thus, since the cost)
46 W( of)45 W
5400 13603 MT
(that search is)
61 W( linear in the queue length, two measurements suffice to define the performance of)62 W
5400 14998 MT
(the kernel implementation: the incremental delay when the pending-packet queue is empty, and)80 W
5400 16393 MT
(the incremental delay when that queue is artificially kept nearly full.)SH
6600 18765 MT
(Table 1 shows)
177 W( the measured round-trip and calculated one-way delays for several gateway)178 W
5400 20160 MT
(implementations: an)
44 W( unmodified Ultrix kernel, the gateway screen with an empty queue, and the)43 W
5400 21555 MT
(gateway screen)
44 W( with artificial garbage entries in the queue.  The experimental setup consisted of)45 W
5400 22950 MT
(a gateway, based on a MicroVax)27 W
/Symbol SF
(\324)SH
/Times-Roman SF
22661 XM
(3500 \050about)
27 W( 2.7 times as fast as a Vax)26 W
/Symbol SF
(\324)SH
/Times-Roman SF
(-11/780\051, connecting)26 W
5400 24345 MT
(two Ethernets)
56 W( [8],)
SH( with an echo client)
56 W( host on one Ethernet and an echo server host on the other)57 W
5400 25740 MT
(Ethernet. Packets)
422 W( contained 56 bytes of data,)
61 W( in addition to 42 bytes of Ethernet, IP, and ICMP)60 W
5400 27135 MT
(headers. The)
300 W( measurements reflect average delays over a large number of trials.)SH
23730 29752 MT
(Time in milliseconds)SH
22519 50 17540 30414 LH BX1
19222 31636 MT
(Version)SH
25664 XM
(Round)SH
31382 XM
(One)SH
35900 XM
(Added)SH
26430 32922 MT
(trip)SH
31382 XM
(way)SH
36200 XM
(delay)SH
22519 50 17540 33584 LH BX1
-3170 50 24705 33584 LV BX1
-3170 50 29823 33584 LV BX1
-3170 50 34941 33584 LV BX1
17939 34806 MT
(No screen)SH
28824 XM
(8)SH
33942 XM
(4)SH
22519 50 17540 35468 LH BX1
17939 36690 MT
(Empty queue)SH
28224 XM
(10)SH
33942 XM
(5)SH
39060 XM
(1)SH
22519 50 17540 37352 LH BX1
17939 38574 MT
(Full queue)SH
28224 XM
(14)SH
33942 XM
(7)SH
39060 XM
(3)SH
22519 10706 50 17540 39236 BX BX1
-5652 50 24705 39236 LV BX1
-5652 50 29823 39236 LV BX1
-5652 50 34941 39236 LV BX1
/Times-Bold SF
15231 41128 MT
(Table 1:)SH
/Times-Roman SF
20365 XM
(Performance with minimal user-level daemon)SH
6600 43500 MT
(One measurement was also made with)
168 W( the client and server on the same Ethernet, with no)169 W
5400 44895 MT
(intervening gateway; this gave a round-trip time of)
180 W( 3 milliseconds, or a one-way time of 1.5)179 W
5400 46290 MT
(milliseconds.)SH
6600 48662 MT
(The ``Added delay'' column in table 1 shows the increment in one-way delay over an)
171 W( un-)172 W
5400 50057 MT
(modified Ultrix-based gateway.  For)
152 W( this hardware, the gateway screen delays each packet by)151 W
5400 51452 MT
(about 1 millisecond, which is consistent with the cost of doing a system call.)SH
6600 53824 MT
(The ``Full queue'' case in the table reflects a)
37 W( situation where the length of the pending-packet)38 W
5400 55219 MT
(queue is artificially maintained at 500)
49 W( packets.  The additional delay imposed by this queue was)48 W
5400 56614 MT
(about 2 milliseconds, or about 4)
84 W( microseconds per entry.  Normally, this queue is limited to 32)85 W
5400 58009 MT
(packets, but at that length the effect \050estimated to)
77 W( be 160 microseconds per packet\051 is too small)76 W
5400 59404 MT
(to be measured.  Note that as long as the packet rate remains)
285 W( below overload \050about 200)286 W
5400 60799 MT
(packets/second\051 the queue will remain nearly empty.)SH
6600 63171 MT
(One other measure of an implementation is its size.  Aside from)
39 W( a few lines of code added for)38 W
5400 64566 MT
(linkage from other modules, the)
55 W( gateway screen implementation consists of 436 lines of heavily)56 W
5400 65961 MT
(commented code \050and 140 lines of header file\051.  Compiled for the Vax, this results in 1512 bytes)29 W
5400 67356 MT
(of object code, and less than 1 Kbyte of data storage is required at run time.)SH
10 SS 
28300 75600 MT
(10)SH
ES
%%Page: 11 15 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
13 /Times-Bold AF
9000 8071 MT
(3.7. Further work)SH
12 /Times-Roman AF
10200 10334 MT
(Although the ioctl-based)
93 W( programming interface makes it quite easy to integrate the gateway)94 W
9000 11729 MT
(screen into the Unix)
30 W( kernel, it is not as efficient as one might like.  The screening function could)29 W
9000 13124 MT
(be embodied in a new system call that copied)
95 W( the packet header information only in one direc-)96 W
9000 14519 MT
(tion.)SH
10200 16891 MT
(It is also possible to reduce the system call count even further, by batching several packets and)10 W
9000 18286 MT
(decisions together for one system call.  Batching has been shown to be profitable in a)
139 W( similar)140 W
9000 19681 MT
(application [21].)
SH( When)
534 W( the)
117 W( load is low, the pending-packet queue will seldom hold more than)116 W
9000 21076 MT
(one packet, and the)
49 W( batch size will be 1, but at high loads, several packets may arrive before the)50 W
9000 22471 MT
(user-level daemon process can be scheduled \050packet interrupts having higher)
111 W( priority than user)110 W
9000 23866 MT
(processes\051. Thus,)
508 W( as the system approaches overload,)
104 W( batch size increases, and the system call)105 W
9000 25261 MT
(overhead per packet decreases; this is precisely the behavior one wants.)SH
11 /Courier-Bold AF
10800 27288 MT
(gateway_screen\050packet_data, packet_count, decision, decision_count\051)SH
10800 28512 MT
(struct screen_data *packet_data;)
SH( /*)
4620 W( pointer to buffer */)SH
10800 29736 MT
(int *packet_count;)
SH( /*)
3300 W( result returned by reference */)SH
10800 30960 MT
(struct screen_data_hdr *decision;)
SH( /*)
3960 W( pointer to buffer */)SH
10800 32184 MT
(int decision_count;)SH
12 /Times-Bold AF
23382 34231 MT
(Figure 3:)SH
/Times-Roman SF
28982 XM
(Proposed new system call)SH
10200 36603 MT
(Figure 3 shows how the programming interface might appear for)
19 W( a new system call supporting)18 W
9000 37998 MT
(batched operation.  The)333 W
/Times-BoldItalic SF
21965 XM
(packet_data)SH
/Times-Roman SF
28532 XM
(and)SH
/Times-BoldItalic SF
30898 XM
(decision)SH
/Times-Roman SF
35599 XM
(parameters are vectors of)
333 W( one or more)334 W
/Times-BoldItalic SF
9000 39393 MT
(screen_data)SH
/Times-Roman SF
15434 XM
(and)SH
/Times-BoldItalic SF
17667 XM
(screen_data_hdr)SH
/Times-Roman SF
26434 XM
(structures, respectively, with their lengths specified by the)199 W
/Times-BoldItalic SF
9000 40788 MT
(packet_count)SH
/Times-Roman SF
15901 XM
(and)SH
/Times-BoldItalic SF
17934 XM
(decision_count)SH
/Times-Roman SF
25703 XM
(arguments, respectively.)SH
10200 43160 MT
(Since for most access control policies,)
68 W( the forwarding decision for a packet is independent of)69 W
9000 44555 MT
(any previously received packets, the gateway screen is a natural application for parallel)
46 W( process-)45 W
9000 45950 MT
(ing. On)
494 W( a multiprocessor, one could)
97 W( run several copies of the user-level daemon process, each)98 W
9000 47345 MT
(on its own processor.)
100 W( The)
499 W( current kernel implementation, since it uses raised interrupt priority)99 W
9000 48740 MT
(level for synchronization, would)
178 W( have to be modified for use in a symmetric multiprocessing)179 W
9000 50135 MT
(kernel; explicit locks would be needed for the pending-packet queue and the private free list.)164 W
9000 51530 MT
(Contention should be relatively low, especially if the)
68 W( items on the pending-packet queue are in-)69 W
9000 52925 MT
(dividually locked when being)
253 W( manipulated, since locked items can simply be ignored when)252 W
9000 54320 MT
(searching that list.)SH
10200 56692 MT
(If the kernel kept a cache of recent decisions, as is)
19 W( done in the user-level program described in)20 W
9000 58087 MT
(section 4.2, it could potentially avoid)
280 W( most of the transfers to user-level code, and so sig-)279 W
9000 59482 MT
(nificantly improve performance.)
168 W( The)
637 W( trick is to choose a cache-match function; an incoming)169 W
9000 60877 MT
(packet will almost)
276 W( never match a previously received packet in its entirety, so only a few)275 W
9000 62272 MT
(selected fields can be used in the matching function.  Not only would the choice of these)
78 W( fields)79 W
9000 63667 MT
(be protocol-specific \050and would probably involve)
36 W( several layers of protocol header\051, but it might)35 W
9000 65062 MT
(also be policy-specific; the user-level policy)
104 W( process would want to specify the matching func-)105 W
9000 66457 MT
(tion. It)
562 W( does not appear feasible to implement a)
131 W( general-purpose mechanism in the kernel, al-)130 W
9000 67852 MT
(though it might pay to provide a caching function for a few heavily used protocols, such as TCP.)SH
10 SS 
31900 75600 MT
(11)SH
ES
%%Page: 12 16 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
14 /Times-Bold AF
5400 8138 MT
(4. A table-driven policy daemon)SH
12 /Times-Roman AF
6600 10407 MT
(This section)
362 W( describes the design and implementation of)363 W
/Times-BoldItalic SF
36776 XM
(screend)SH
/Times-Roman SF
(, a table-driven policy)363 W
5400 11802 MT
(daemon to make datagram access control)
272 W( decisions, to be used with the kernel mechanism)271 W
5400 13197 MT
(described in section 3.)
130 W( This)
561 W( program uses only the most vanilla features of Unix \050besides the)131 W
5400 14592 MT
(gateway screen mechanism, of course\051 and so should be portable to any Unix-like system.)SH
13 /Times-Bold AF
5400 18343 MT
(4.1. User interface)SH
12 /Times-Roman AF
6600 20612 MT
(To use)53 W
/Times-BoldItalic SF
10239 XM
(screend)SH
/Times-Roman SF
(, one starts by generating a configuration)
53 W( file.  This is a text file that describes)52 W
5400 22007 MT
(the kinds of packets that should be accepted or rejected.  The daemon)
112 W( program is then started,)113 W
5400 23402 MT
(parses the configuration)
3 W( file, and then enters an infinite loop making packet-forwarding decisions)2 W
5400 24797 MT
(according to the criteria in the configuration-file.  If one)
237 W( wishes to change the criteria, one)238 W
5400 26192 MT
(simply edits)
172 W( the configuration file and restarts the daemon process. \050In principle, the daemon)171 W
5400 27587 MT
(could notice that the file has been changed, but this might add unnecessary)
355 W( code to the)356 W
5400 28982 MT
(performance-critical inner loop\051.)SH
6600 31354 MT
(The complete)
16 W( grammar for the configuration file is rather involved, and is given in appendix I.)15 W
5400 32749 MT
(To understand)
52 W( this section, one must understand some of the concepts that may be expressed by)53 W
5400 34144 MT
(this grammar.)SH
6600 36516 MT
(The main)
185 W( purpose of the configuration file is to specify the action \050accept or reject\051 taken)184 W
5400 37911 MT
(when a)
5 W( particular kind of packet arrives.  Packets are identified by their IP source and destination)6 W
5400 39306 MT
(address, the next level protocols they use \050for example, TCP or UDP\051, and the)
98 W( source and des-)97 W
10 SS 
29072 40320 MT
(4)SH
12 SS 
5400 40701 MT
(tination ports, or ICMP type codes, if these apply)SH
29572 XM
(.)SH
6600 43073 MT
(A packet can thus be precisely specified by listing its source and)
173 W( destination addresses, its)174 W
5400 44468 MT
(protocol type, and if applicable, its source and destination ports or ICMP type)
127 W( code.  One can)126 W
5400 45863 MT
(also leave any of these fields unspecified,)
79 W( or partially specified.  For example, one may specify)80 W
5400 47258 MT
(that packets from a particular host to any host at all, using any)
185 W( protocol at all, should be be)184 W
5400 48653 MT
(rejected; this is one way to isolate that host from the internetwork.  One may)
218 W( also partially)219 W
5400 50048 MT
(specify an address by specifying not a host address but a network number,)
73 W( or perhaps a subnet-)72 W
5400 51443 MT
(work number.  Finally, one can specify that certain fields should not match)
286 W( for the entire)287 W
5400 52838 MT
(specification to match.  Most fields can be specified either numerically or symbolically.)SH
6600 55210 MT
(Specifications are evaluated in the order that they appear in)
219 W( the configuration file.  Thus,)218 W
5400 56605 MT
(specific exceptions to a)
138 W( more general rule should appear earlier in the file.  Also, note that to)139 W
5400 58000 MT
(specify both directions on a path, one needs two rules.)
55 W( The)
409 W( actions taken, in addition to accept-)54 W
5400 59395 MT
(ing or rejecting a packet, can include notifying the sender upon rejection, and logging the packet)33 W
5400 60790 MT
(\050useful for detecting breakins\051.  Figure 4 shows some examples \050these examples)
26 W( would not make)25 W
5400 62185 MT
(sense for any single gateway, since the host names are chosen at random\051.)SH
10800 50 5400 67780 UL
8 SS 
6400 69445 MT
(4)SH
10 SS 
6800 69790 MT
(ICMP type codes are interesting because some ICMP messages can be harmful \050for)
90 W( example, routing Redirect)91 W
5400 70895 MT
(packets\051 while others are harmless \050for example, Echo packets\051.  Well, mostly)
247 W( harmless: a villain could use)246 W
5400 72000 MT
(``harmless'' packets to flood a victim's host.)SH
28300 75600 MT
(12)SH
ES
%%Page: 13 17 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
11 /Courier-Bold AF
10800 7941 MT
(from host xx.lcs.mit.edu tcp port 3)SH
16080 9165 MT
(to host score.stanford.edu tcp port telnet reject;)SH
10800 11613 MT
(between host sri-nic.arpa and any accept;)SH
10800 14061 MT
(from net milnet to subnet 36.48.0.0 proto vmtp reject;)SH
10800 16509 MT
(from net-not cmu-net tcp port reserved)SH
16080 17733 MT
(to net cmu-net tcp port rlogin reject notify;)SH
10800 20181 MT
(from any icmp type echo to any accept log;)SH
12 /Times-Bold AF
23132 22228 MT
(Figure 4:)SH
/Times-Roman SF
28732 XM
(Example configuration file)SH
10200 24600 MT
(There are two other kinds of rules that can be)
8 W( in the configuration file.  First, one can specify a)9 W
9000 25995 MT
(default action \050normally rejection\051.  Second, one can specify the)
182 W( network masks for arbitrary)181 W
9000 27390 MT
(networks. This)
370 W( allows subnet specifications for non-local networks.  Normally,)
35 W( a gateway is not)36 W
9000 28785 MT
(supposed to know about the subnet structure of a distant network)
4 W( [20],)
SH( but this information might)4 W
9000 30180 MT
(be useful in deciding whether to forward a packet that originates someplace)
109 W( in an organization)110 W
9000 31575 MT
(with multiple network numbers.)SH
13 /Times-Bold AF
9000 35326 MT
(4.2. Implementation)SH
12 /Times-Roman AF
10200 37595 MT
(Most of the complexity in)
20 W( the implementation)19 W
/Times-BoldItalic SF
32712 XM
(screend)SH
/Times-Roman SF
36831 XM
(is in the code that parses the configura-)19 W
9000 38990 MT
(tion file and builds the internal data)
52 W( structures.  The parser itself is a straightforward application)53 W
9000 40385 MT
(of)SH
/Times-BoldItalic SF
10402 XM
(lex)SH
/Times-Roman SF
12169 XM
([16] and)102 W
/Times-BoldItalic SF
16706 XM
(yacc)SH
/Times-Roman SF
19205 XM
([13]. All)
504 W( translations of symbolic values \050such as)
102 W( host names\051 to numeric)101 W
9000 41780 MT
(values are)
9 W( done during parsing; this is necessary for performance, although it means that if a host)10 W
9000 43175 MT
(changes its address, the internal databases may reflect stale specifications.)SH
10200 45547 MT
(The main loop of the)
85 W( daemon accepts a packet header from the kernel, extracts certain fields)84 W
9000 46942 MT
(from the)
82 W( header, and matches the extracted fields against the internal representation of the con-)83 W
9000 48337 MT
(figuration file.  Since matching is the most time-consuming part of the inner)
62 W( loop, the choice of)61 W
9000 49732 MT
(internal representation clearly affects performance.)SH
10200 52104 MT
(Several different representations were examined, including hash tables, decision)
216 W( trees, and)217 W
9000 53499 MT
(various combinations.)
164 W( The)
627 W( most difficult problem is that while the incoming packets contain)163 W
9000 54894 MT
(specific addresses, the specifications in the configuration file)
46 W( may contain partially specified ad-)47 W
9000 56289 MT
(dresses, and several specifications may match various fields of the packet.)
102 W( Moreover,)
502 W( it is im-)101 W
9000 57684 MT
(portant to provide a deterministic way of selecting between)
110 W( possibly several specifications that)111 W
9000 59079 MT
(all match the packet \050the ``in order of)
147 W( appearance rule'' is arbitrary but easy to comprehend\051.)146 W
9000 60474 MT
(None of the complicated data structures seemed to have much of an advantage, and)
93 W( all involve)94 W
9000 61869 MT
(complicated implementations.)SH
10200 64241 MT
(A simple array of specifications, searched)
43 W( linearly, is easy to implement and provides a deter-)42 W
9000 65636 MT
(ministic evaluation order.  On)
83 W( the other hand, if the configuration file contains many rules, this)84 W
9000 67031 MT
(array may be quite long, and since the individual match evaluations are rather)
42 W( costly, the perfor-)41 W
9000 68426 MT
(mance of this approach could be quite bad.)SH
10 SS 
31900 75600 MT
(13)SH
ES
%%Page: 14 18 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
6600 8023 MT
(The solution is to)
59 W( combine an array representation of the entire database with a cache record-)60 W
5400 9418 MT
(ing recent decisions.  Since the decisions recorded in the cache are with respect to)
2 W( specific packet)1 W
5400 10813 MT
(headers \050actually, only the important fields)
145 W( of these headers\051, rather than the partial specifica-)146 W
5400 12208 MT
(tions of the configuration file, matching is quite efficient.  Since)
130 W( most delay-sensitive applica-)129 W
5400 13603 MT
(tions tend to involve)
124 W( repeated packet exchanges, a small cache with least-recently-used \050LRU\051)125 W
5400 14998 MT
(replacement should yield high hit rates.)
210 W( \050Applications)
719 W( that are sensitive to connection setup)209 W
5400 16393 MT
(time, or that)
37 W( exchange packets infrequently, may suffer low cache hit rates; the delays, however,)38 W
5400 17788 MT
(should be an order of magnitude lower than the propagation)
19 W( delay in a cross-country network.  If)18 W
5400 19183 MT
(necessary, specifications pertaining to such delay-sensitive applications can be)
35 W( listed early in the)36 W
5400 20578 MT
(configuration file, to shorten the database search.\051)SH
6600 22950 MT
(The match function for cache lookups is quite simple. Once the relevant fields of)
102 W( the packet)101 W
5400 24345 MT
(\050source and destination addresses, protocol type, and)
37 W( source or destination ports or ICMP type if)38 W
5400 25740 MT
(applicable\051 are extracted, they are placed into a compact structure that can be)
112 W( compared word-)111 W
5400 27135 MT
(by-word to a cache of previous such records.  The cache also includes the decision made for)
47 W( the)48 W
5400 28530 MT
(first occurrence of this pattern.)
163 W( The)
625 W( entries in the cache can never become invalid, since the)162 W
5400 29925 MT
(configuration file does not allow specifications that depend upon any time-varying quantity.)SH
6600 32297 MT
(If the cache does not hold a matching record, the entire database must be searched.)
131 W( In)
564 W( this)132 W
5400 33692 MT
(case, the matching function is more complex; it must take into account partial specifications.)
46 W( In)390 W
5400 35087 MT
(particular, each IP address appearing in the packet may have to be)
35 W( converted to a subnet number)36 W
5400 36482 MT
(or network number before comparing with a specification.  Since these conversion operations are)10 W
5400 37877 MT
(moderately expensive, they are postponed until necessary, and then done)
97 W( only once per packet.)98 W
5400 39272 MT
(\05A sbFe0) 141 W  Nu bDr i# Dx@rAcTe@ By farat ept0aCt n  DhE $e0w/r  huDbAr  Dh n using t(e n t ok)100 W5 00 0062 ET (nuib$r tc  oAk uP dhd  u`net m`s	 An a has` 0a l%  u lP) 1 W( Ch`n t@e cBnfidu adien f`l  s p r e , a d 2 W 5 0   2 6   T ( i a l   p l i g t e n t o k m s   o t e a d e s i   h$  aket(\ 5 )H 1   Thm s!B+l` @F 500 $511 AT
(.0. Sp`otin` r`g e@ted d@tgPasS
2 /ihe - oma$ @F6&0  807 LT(@n  Co@phi aPi@g f!aDu2e(
 6 W( hf te I@  rktkcIl i`  h`t i `  aPea  Pecev`s a dt`g`aA 0h t iQ Po )5 W5 00 9$7  @T(ha`gA Do fnrda`d iJ n` picA, iD @a1)68 W/Ti-e -HtalIc S
"301  M("r@gAet)S 
 TimsR"m n S
 81 M
(th   aaCrm i
tJ ePea   a"kt`.   o eIvr   P 6 
 4 0 5 86 MT
(ue  ``@n4e nDtto k fa mdndadi%n$'+ Dh Br@gde t  r  es0e@bde  hny a@  h  e0tintHo
 `ot)4 W
50  !2 6 DT
(!n  AaY NoP JeeAs rIli Al` lew t`r uh ady gvn(
7 W Da eaq.   ragme t@t oh 	s alr@a@y k.on t")8 W500 35 ET((e`d t  e"fir,acE @r%beds  poDedt@a@l	 QePePe
55 W  B10] )S( b1t i$ s a n c say evil and IP gateways)54 W
5400 5505  T (`u`t fbrAaRd te fa$m@ns they receive.)SH
6600 57423 MT
(The problem for the)54 W
/Times-BoldItalic SF
16750 XM
(screend)SH
/Times-Roman SF
20904 XM
(prgam @s t@ap  oe s e`i`i`a`iAnR het o @ilDs auh 
4 W   s TP 54 A
 400 5 8 8 M 
 o` @DP  o tp, t a@ `pper o l  n t e fHrCt f"am$n  `f 
 0 W( @ Pa"kt  I` s t@uA impo`sbhe tE $ebi@e iD)9 W
5 00 &0"1 T(2usq0e t fPamnts o ` C  r UDP!
!30  ( pace  Sh!ud ba owAre  PiPhu`  oPs siFg iBfr) 3 U
 4 0 6 68 M@
 m`t`oh bup th` ipsP Fr`gEeLt")H60  $3 80 T(n` `o0s@bde a`proAc  `o lD @e t$ ai-pHy
!10 ( p`s`  l  `
o"- e`d n' Fr ghet0, tho3e t a   r )1# G
04 0 6 315 M 
 nht t`e f@r t f`aAmAnt gf a d t`g ad, regAr@lDs0 hf t@e
4 W   ofgqr`t!o*  al .  CifcD  oml I 	m)55 W5 00 637  T ( lAmdntain` ca nt
93 W   o a
yDh ng Di`h a rAcDi`e   ata r m i  `h di s   r`gme`t i  -iPs n, t(e!9  
$4 0 6125 MD
 abtHol of)48 
T@m@s BlDI0ahi  @F
1000 X 
(s`r%e"d(S@
#ThmsRm n S 
 417  HM((n the fIrSt fPam@n` `h
uDd h v $hD) 4 ( efec  Gf cn@r(l i@g t e eNt(r  $a a&r m,) 9 W 5$0  49 6  LT (Anortn tDl, t@i  ethd	
 0 W @eavds oe soe s$ctr	t  oe`; fOr e ap e$ dw
 hots ol   o- 8 P
400 7 95 M
s`ipe t@ Dxh ne i
f$rda in e
c!puda e  n eRsAtB) 15 W   ` r!geht', o   haHiCiu hot cHu@d1 6 W
5 0  25  	T (OvrChl$   ``victim' hHsD @y f	lig u   tQ r@gLe t taoj BeAs e by b fe2s) H1  S 
28300 75600 MT
(14)SH
ES
%%Pag : 1  9 
BS 0 S
 0 /ie -o an AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
10200 8029 MT
(The approach taken in)155 W
/Times-BoldItalic SF
21818 XM
(screend)SH
/Times-Roman SF
26072 XM
(is to keep a cache of the extracted records for recent ``first)154 W
9000 9424 MT
(fragments.'' When)
550 W( datagram fragments with a non-zero offset \050that is, not ``first)
125 W( fragments''\051)126 W
9000 10819 MT
(arrive, the cache is checked to see if we have already seen the corresponding)
6 W( first fragment; if so,)5 W
9000 12214 MT
(the cached information is used.  Otherwise, the packet cannot be)
16 W( identified, and is dropped.  This)17 W
9000 13609 MT
(solution is not entirely satisfactory, since it requires that all fragments)
278 W( of a datagram flow)277 W
9000 15004 MT
(through one gateway, and that the)
70 W( first fragment appears before all the others.  Fortunately, this)71 W
9000 16399 MT
(seems to be true in most cases.)SH
10200 18771 MT
(The fragmentation cache is organized as a hash table, with a)
250 W( fixed maximum number of)249 W
9000 20166 MT
(entries; lookups, insertions, and)
229 W( deletions are relatively inexpensive.  Since it would require)230 W
9000 21561 MT
(elaborate data structures to detect when we have seen all the fragments of)
10 W( a datagram \050and in any)9 W
9000 22956 MT
(case we may never see all the fragments\051)
13 W( the hash table must be purged of stale entries whenever)14 W
9000 24351 MT
(it fills up.  A stale entry is one for which the ``Time To Live'' field of the corresponding IP)154 W
9000 25746 MT
(datagram has expired; in any event, the lifetime is arbitrarily)
201 W( limited to no more than a few)202 W
9000 27141 MT
(seconds. In)
716 W( order to avoid having to drop packets for lack of space in this table, one must)207 W
9000 28536 MT
(balance the size of)
30 W( the table and the maximum lifetime against the rate of fragment arrival.  This)31 W
9000 29931 MT
(is a difficult problem,)
69 W( and may make it impractical to run protocols that extravagantly fragment)68 W
9000 31326 MT
(\050such as NFS\051 over such a gateway.)SH
10200 33698 MT
(Fragmentation support complicates the use)
41 W( of a multiprocessor to improve performance, since)42 W
9000 35093 MT
(the fragmentation cache has to be available to all processes if it is)
49 W( to be useful.  This means that)48 W
9000 36488 MT
(the cache must be a database shared by all)93 W
/Times-BoldItalic SF
30404 XM
(screend)SH
/Times-Roman SF
34597 XM
(processes, with)
93 W( the associated overhead for)94 W
9000 37883 MT
(locking. Fortunately,)
300 W( this cost is only invoked when fragments arrive.)SH
10200 40255 MT
(In general, although)91 W
/Times-BoldItalic SF
20407 XM
(screend)SH
/Times-Roman SF
24598 XM
(does support fragmentation to a)
91 W( certain extent, it is better in al-)90 W
9000 41650 MT
(most all cases for source hosts to avoid generating datagrams)
435 W( that will be fragmented.)436 W
9000 43045 MT
(Mechanisms for fragmentation avoidance have been proposed)
87 W( [14, 19],)
SH( although)
87 W( few have been)86 W
9000 44440 MT
(implemented.)SH
13 /Times-Bold AF
9000 48191 MT
(4.4. Performance)SH
12 /Times-Roman AF
10200 50460 MT
(The performance of a gateway based on)138 W
/Times-BoldItalic SF
30663 XM
(screend)SH
/Times-Roman SF
34901 XM
(depends on)
138 W( the performance of the under-)139 W
9000 51855 MT
(lying gateway implementation,)
149 W( the performance of the kernel gateway screen mechanism, and)148 W
9000 53250 MT
(the performance of the)4 W
/Times-BoldItalic SF
20216 XM
(screend)SH
/Times-Roman SF
24320 XM
(program itself.  The latter depends on two major components:)
4 W( the)5 W
9000 54645 MT
(hit rate in the recent-decision cache, and the cost of searching)
121 W( the real database, which in turn)120 W
9000 56040 MT
(depends upon the size and evaluation order)
160 W( of that database.  Both the cache hit rate and the)161 W
9000 57435 MT
(database contents are quite)
18 W( specific to a particular installation; the measurements given here only)17 W
9000 58830 MT
(illuminate the extreme cases.)SH
10200 61202 MT
(If performance is)
150 W( measured by simply repeatedly sending ICMP Echo messages to a single)151 W
9000 62597 MT
(destination, then the cache hit rate will be 100% \050after the first packet\051, so this)
108 W( case represents)107 W
9000 63992 MT
(the best possible performance.  In order to measure worst-case performance, it was necessary to)57 W
9000 65387 MT
(disable the code that)
157 W( entered a decision in the cache, thus forcing a database search on every)156 W
9000 66782 MT
(packet. Additionally,)
730 W( the database was padded with many irrelevant entries, with the actual)215 W
9000 68177 MT
(matching rule)
180 W( coming last.  \050The ``irrelevant'' entries were constructed to make searching as)179 W
9000 69572 MT
(expensive as possible.\051)SH
10 SS 
31900 75600 MT
(15)SH
ES
%%Page: 16 20 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
6600 8023 MT
(Table 2 shows the measured round-trip and calculated one-way delays for the best case \050100%)19 W
5400 9418 MT
(cache hit)
105 W( rate\051 and for 0% cache hit rates with moderate-sized \05010 entry\051 and large \050100 entry\051)104 W
5400 10813 MT
(databases. The)
622 W( table also includes some measurements from)
161 W( table 1, for comparison; the ex-)162 W
5400 12208 MT
(perimental setup used identical hardware and methodology.)SH
23731 14825 MT
(Time in milliseconds)SH
22228 50 17686 15487 LH BX1
20303 16709 MT
(Version)SH
27319 XM
(Round)SH
32317 XM
(One)SH
36115 XM
(Added)SH
28085 17995 MT
(trip)SH
32317 XM
(way)SH
36415 XM
(delay)SH
22228 50 17686 18657 LH BX1
-3170 50 26720 18657 LV BX1
-3170 50 31118 18657 LV BX1
-3170 50 35516 18657 LV BX1
18085 19879 MT
(No screen)SH
30119 XM
(8)SH
34517 XM
(4)SH
22228 50 17686 20541 LH BX1
18085 21763 MT
(Minimal daemon)SH
29519 XM
(10)SH
34517 XM
(5)SH
38915 XM
(1)SH
22228 50 17686 22425 LH BX1
/Times-BoldItalic SF
18085 23653 MT
(screend)SH
/Times-Roman SF
29519 XM
(10)SH
34517 XM
(5)SH
38915 XM
(1)SH
18085 24939 MT
(100% cache hits)SH
22228 50 17686 25601 LH BX1
/Times-BoldItalic SF
18085 26829 MT
(screend)SH
/Times-Roman SF
29519 XM
(11)SH
33617 XM
(5.5)SH
38015 XM
(1.5)SH
18085 28115 MT
(0% cache hits)SH
18085 29401 MT
(10 entries)SH
22228 50 17686 30063 LH BX1
/Times-BoldItalic SF
18085 31291 MT
(screend)SH
/Times-Roman SF
29519 XM
(17)SH
33617 XM
(8.5)SH
38015 XM
(4.5)SH
18085 32577 MT
(0% cache hits)SH
18085 33863 MT
(100 entries)SH
22228 20922 50 17686 34525 BX BX1
-15868 50 26720 34525 LV BX1
-15868 50 31118 34525 LV BX1
-15868 50 35516 34525 LV BX1
/Times-Bold SF
18649 36423 MT
(Table 2:)SH
/Times-Roman SF
23783 XM
(Performance of)SH
/Times-BoldItalic SF
31516 XM
(screend)SH
/Times-Roman SF
35616 XM
(system)SH
6600 38795 MT
(The results)
13 W( for the case of 100% cache hits demonstrate that)12 W
/Times-BoldItalic SF
35903 XM
(screend)SH
/Times-Roman SF
40015 XM
(is quite efficient when its)12 W
5400 40190 MT
(cache is properly sized.  Even when the cache is)
57 W( too small, if the number of distinct rules in the)58 W
5400 41585 MT
(configuration file is small, the additional delay \050around 0.5)
197 W( millisecond per packet\051 is nearly)196 W
5400 42980 MT
(insignificant. The)
816 W( results for)
258 W( the larger configuration database show that it is important to)259 W
5400 44375 MT
(choose both)
105 W( a simple set of rules, and an efficient evaluation order, to avoid noticeable perfor-)104 W
5400 45770 MT
(mance degradation.  Even in this case, the excess delay is)
68 W( comparable to other delays in a large)69 W
5400 47165 MT
(internetwork.)SH
6600 49537 MT
(Varying the packet size, while changing the total round-trip delays, has no significant)
115 W( effect)114 W
5400 50932 MT
(on the incremental delay imposed by the)45 W
/Times-BoldItalic SF
25485 XM
(screend)SH
/Times-Roman SF
29630 XM
(program. This)
392 W( is as expected, since the kernel)46 W
5400 52327 MT
(provides only a prefix of each packet to the)SH
/Times-BoldItalic SF
26501 XM
(screend)SH
/Times-Roman SF
30601 XM
(program.)SH
6600 54699 MT
(The)SH
/Times-BoldItalic SF
8849 XM
(screend)SH
/Times-Roman SF
13032 XM
(program sources consist of about 2600 lines of commented code.  The resulting)83 W
5400 56094 MT
(binary file, compiled for the Vax, is about 48 Kbytes)
8 W( of object code \050including library functions\051,)9 W
5400 57489 MT
(and when running requires on the order of 150 Kbytes of memory,)
63 W( depending on the size of the)62 W
5400 58884 MT
(configuration file.)SH
6600 61256 MT
(Actual experience with)185 W
/Times-BoldItalic SF
18588 XM
(screend)SH
/Times-Roman SF
22873 XM
(has been quite successful.)
185 W( The)
671 W( system is reliable, easy to)186 W
5400 62651 MT
(configure, and performs well.  The ability to log improper packets has made)
108 W( it possible to dis-)107 W
5400 64046 MT
(cover previously obscured)
7 W( problems, including software bugs and ``back door'' routes that might)8 W
5400 65441 MT
(be security holes.)SH
10 SS 
28300 75600 MT
(16)SH
ES
%%Page: 17 21 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
13 /Times-Bold AF
9000 8071 MT
(4.5. Problems and further work)SH
12 /Times-Roman AF
10200 10340 MT
(The access control model followed by)106 W
/Times-BoldItalic SF
29436 XM
(screend)SH
/Times-Roman SF
33641 XM
(assumes that application-specific controls \050as)105 W
9000 11735 MT
(opposed to host-specific controls\051 can be based on the TCP or)
68 W( UDP port number of at least one)69 W
9000 13130 MT
(of the end points.  This)
112 W( is valid for many TCP and UDP applications, such as remote terminal)111 W
9000 14525 MT
(access or name service, but is not true in all cases.  For example, the)
76 W( Berkeley ``talk'' daemon,)77 W
9000 15920 MT
(used for online conversations between users on different hosts, listens for connection requests on)20 W
9000 17315 MT
(a well-known port number, but builds the)
99 W( actual connection using arbitrary port numbers.  The)100 W
9000 18710 MT
(``talk'' daemon could be modified to coexist with)SH
/Times-BoldItalic SF
33205 XM
(screend)SH
/Times-Roman SF
(, but this is not always convenient.)SH
10200 21082 MT
(Another example where this assumption breaks down,)
175 W( although not directly relevant to the)174 W
9000 22477 MT
(IP-based)SH
/Times-BoldItalic SF
13902 XM
(screend)SH
/Times-Roman SF
(, is found in the ``socket'' mechanism in the Pup)
402 W( byte-stream protocol)403 W
9000 23872 MT
(\050BSP\051 [1].)
SH( Although)
434 W( the initial BSP connection packet is directed at a well-known socket num-)66 W
9000 25267 MT
(ber, the server listening on that socket immediately creates a new socket for the actual connec-)93 W
9000 26662 MT
(tion. Thus,)
300 W( subsequent packets do not travel to a well-known socket number.)SH
10200 29034 MT
(Although the well-known port mechanism is followed by existing TCP and UDP applications,)30 W
9000 30429 MT
(it has certain disadvantages related to number)
28 W( management.  As a response, it has been proposed)29 W
9000 31824 MT
(that this mechanism be replaced by a ``port service multiplexer,'' a mechanism)
21 W( using port names)20 W
9000 33219 MT
(instead of port numbers)
186 W( [18].)
SH( This)
673 W( would make the port-matching support of)187 W
/Times-BoldItalic SF
48513 XM
(screend)SH
/Times-Roman SF
52800 XM
(nearly)SH
9000 34614 MT
(useless. The)
496 W( Sun RPC)
98 W( system, used with NFS, includes a ``port mapper'' mechanism that fol-)97 W
9000 36009 MT
(lows the same)
175 W( model)
176 W( [29].)
SH( Fortunately,)
652 W( because the RPC packets follow a fixed format, one)176 W
9000 37404 MT
(might extend)SH
/Times-BoldItalic SF
15602 XM
(screend)SH
/Times-Roman SF
19702 XM
(to parse the RPC headers and filter on the RPC program number.)SH
10200 39776 MT
(IP multicasting is another issue not addressed)
160 W( by)159 W
/Times-BoldItalic SF
35151 XM
(screend)SH
/Times-Roman SF
(. A)
618 W( standard for IP multicast ad-)159 W
9000 41171 MT
(dressing has only recently been developed)
46 W( [5],)
SH( and as yet there is)
46 W( little support for or experience)47 W
9000 42566 MT
(with multicasting.  Identifying multicast IP)
125 W( addresses is quite simple, so modifying)124 W
/Times-BoldItalic SF
50642 XM
(screend)SH
/Times-Roman SF
54866 XM
(to)SH
9000 43961 MT
(support the concept of multicast groups should not be difficult.)SH
10200 46333 MT
(One attractive extension to)159 W
/Times-BoldItalic SF
24038 XM
(screend)SH
/Times-Roman SF
28297 XM
(would be to use it for datagram accounting.  Since the)160 W
9000 47728 MT
(marginal cost of a datagram on a LAN is quite small, datagrams)
62 W( flowing within an organization)61 W
9000 49123 MT
(might be paid for through pooled overhead charges, but some long-distance)
97 W( carriers charge per)98 W
9000 50518 MT
(datagram and an organization might want to charge these costs back to specific sources.  The)142 W
/Times-BoldItalic SF
9000 51913 MT
(screend)SH
/Times-Roman SF
13227 XM
(program could)
127 W( easily be extended to record accounting information, for all packets or)128 W
9000 53308 MT
(for those following specific paths.  Access control might be used not for security)
85 W( but to restrict)84 W
9000 54703 MT
(long-distance access to those hosts that have promised to pay.)SH
10200 57075 MT
(One user has asked that)4 W
/Times-BoldItalic SF
21853 XM
(screend)SH
/Times-Roman SF
25957 XM
(be enhanced to log the beginning and end of)
4 W( TCP connections)5 W
9000 58470 MT
(\050that is, logging packets with the)129 W
10 SS 
25745 XM
(SYN)SH
12 SS 
28174 XM
(and)SH
10 SS 
30336 XM
(FIN)SH
12 SS 
32376 XM
(flags set\051.)
129 W( This)
556 W( is made difficult by the cache-)128 W
9000 59865 MT
(based implementation of)21 W
/Times-BoldItalic SF
21233 XM
(screend)SH
/Times-Roman SF
(, because these flags are not part of the packet addressing)
21 W( infor-)22 W
9000 61260 MT
(mation. It)
628 W( should be possible to modify the logging mechanism to parse these)
164 W( flags in those)163 W
9000 62655 MT
(packets for which)SH
10 SS 
17833 XM
(SYN)SH
12 SS 
(/)SH
10 SS 
(FIN)SH
12 SS 
22078 XM
(logging is requested.)SH
10200 65027 MT
(Remote network management has recently)
202 W( been an area of active development.  Although)203 W
/Times-BoldItalic SF
9000 66422 MT
(screend)SH
/Times-Roman SF
13108 XM
(is table-driven,)
8 W( it is not difficult to imagine a version that is managed via a protocol such)7 W
9000 67817 MT
(as CMIP [11].)SH
10200 70189 MT
(Finally, the current implementation of)207 W
/Times-BoldItalic SF
29841 XM
(screend)SH
/Times-Roman SF
34148 XM
(does not parse IP header options, which)
207 W( is)208 W
9000 71584 MT
(necessary to defend against use of source routing to avoid simplistic)
111 W( address checks.  It would)110 W
10 SS 
31900 75600 MT
(17)SH
ES
%%Page: 18 22 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
5400 8023 MT
(not be difficult to)
107 W( add option parsing, without changing the basic design of the program.  Cur-)108 W
5400 9418 MT
(rently,)SH
/Times-BoldItalic SF
8801 XM
(screend)SH
/Times-Roman SF
12901 XM
(simply rejects any packets with IP header options.)SH
14 /Times-Bold AF
5400 13236 MT
(5. Implementing Visa mechanisms)SH
12 /Times-Roman AF
6600 15499 MT
(The implementation described in)
281 W( section 4 uses a configuration file that is stored at the)280 W
5400 16894 MT
(gateway. A)460 W
/Times-Italic SF
11705 XM
(visa)SH
/Times-Roman SF
14019 XM
(protocol [10])
SH( is a different)
80 W( kind of mechanism for implementing datagram ac-)81 W
5400 18289 MT
(cess controls.  This section)
136 W( sketches the design of visa-protocol support based on the gateway)135 W
5400 19684 MT
(screen mechanism of section 3.  This design has not been implemented;)
235 W( an entirely kernel-)236 W
5400 21079 MT
(resident implementation of the visa protocol already exists [9].)SH
13 /Times-Bold AF
5400 24830 MT
(5.1. Overview of visa protocols)SH
12 /Times-Roman AF
6600 27093 MT
(In a)
16 W( visa protocol, each inter-organization datagram carries an unforgeable mark that proves to)15 W
5400 28488 MT
(a gateway that transmission)
206 W( of the datagram is properly authorized.  These marks are called)207 W
/Times-Italic SF
5400 29883 MT
(visas)SH
/Times-Roman SF
(, by analogy to the)
4 W( stamp made on a passport that allows a bearer to cross a border; visas are)3 W
5400 31278 MT
(unforgeable because they are created using cryptographic mechanisms and secret keys.)SH
6600 33650 MT
(In the visa protocols, a)
108 W( gateway has no policy function at all; it simply checks the visa on a)109 W
5400 35045 MT
(packet for validity.)
172 W( Policy)
643 W( decisions are made by a separate ``access control server'' \050ACS\051,)171 W
5400 36440 MT
(which holds a secret key in common with)
1 W( the gateways of its organization.  Thus, the principle of)2 W
5400 37835 MT
(policy/mechanism separation is extended even further.)SH
6600 40207 MT
(In use, a source)
11 W( host first applies to an ACS for permission to send a packet to a given destina-)10 W
5400 41602 MT
(tion host.  The ACS makes a decision based on an arbitrary)
8 W( policy, and it may decide not to issue)9 W
5400 42997 MT
(a visa.  If it does issue a visa, there are several alternative protocols that can be followed.)SH
6600 45369 MT
(In the first, or ``stateful gateway,'' policy, the ACS creates a new)65 W
/Times-Italic SF
39081 XM
(visa key)64 W
/Times-Roman SF
43342 XM
(to be used for this)64 W
5400 46764 MT
(connection, and)
161 W( transmits the key to both the source host and the appropriate gateways.  The)162 W
5400 48159 MT
(source host then creates a new)
34 W( visa for each packet by computing a function based on the packet)33 W
5400 49554 MT
(contents and the)
34 W( key, and attaches the visa to the packet before transmitting it to the gateway for)35 W
5400 50949 MT
(forwarding. The)
474 W( gateway, which has stored its copy of the key in a table, checks to make sure)87 W
5400 52344 MT
(that the visa attached to the packet was computed using the same key.)SH
6600 54716 MT
(In the second, or ``stateless gateway,'' policy,)
158 W( the ACS accepts some information from the)159 W
5400 56111 MT
(source host, including a secret session key chosen by the source host.  The ACS)
250 W( creates a)249 W
5400 57506 MT
(digitally-signed [7])
SH( and encrypted copy of this information, which)
45 W( is returned to the source host.)46 W
5400 58901 MT
(The source host then attaches this visa to each packet, along with a)
31 W( ``signature'' value computed)30 W
5400 60296 MT
(by a function based on the packet contents and the session key, then transmits the packet to)
129 W( a)130 W
5400 61691 MT
(gateway. The)
470 W( gateway decrypts the)
85 W( visa \050since it shares the secret encrypt encryption key with)84 W
5400 63086 MT
(the ACS\051 and extracts the session key; this allows the gateway to validate the visa.)SH
13 /Times-Bold AF
5400 66837 MT
(5.2. Implementing visa protocols)SH
12 /Times-Roman AF
6600 69106 MT
(The main loop of a visa-protocol daemon is similar to that of)89 W
/Times-BoldItalic SF
37209 XM
(screend)SH
/Times-Roman SF
(, except that instead of)89 W
5400 70501 MT
(matching the packet header against the configuration database, the)
5 W( daemon must validate the visa)4 W
5400 71896 MT
(contained in the packet header.  The algorithms)
1 W( to do this validation are described in detail in)
2 W( [9],)SH
5400 73291 MT
(and can be treated as ``black boxes'' for the purposes of this paper.)SH
10 SS 
28300 75600 MT
(18)SH
ES
%%Page: 19 23 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
10200 8029 MT
(The main difference between the)38 W
/Times-BoldItalic SF
26489 XM
(screend)SH
/Times-Roman SF
30627 XM
(program and a visa protocol daemon is that)38 W
/Times-BoldItalic SF
52000 XM
(screend)SH
/Times-Roman SF
9000 9424 MT
(is entirely synchronous, whereas a visa daemon must process events coming from several)319 W
9000 10819 MT
(sources. The)
1182 W( main source of events is, of course, packet information arriving via the)440 W
9000 12214 MT
(SIOCSCREEN ioctl, but a visa daemon must also receive and process messages from an ACS.)95 W
9000 13609 MT
(In the stateful-gateway visa protocol, these messages contain the visa keys, and arrive fairly of-)71 W
9000 15004 MT
(ten. In)
445 W( the stateless-gateway protocol, the messages are used to distribute the secret key shared)73 W
9000 16399 MT
(between the ACS and the gateways; this happens infrequently, when it is determined that the key)13 W
9000 17794 MT
(may have been compromised and a new one is needed.)SH
10200 20166 MT
(4.2BSD Unix has several mechanisms for supporting asynchronous event)
77 W( streams.  The most)78 W
9000 21561 MT
(elegant is the)61 W
/Times-BoldItalic SF
15818 XM
(select\050\051)SH
/Times-Roman SF
19713 XM
(system call, which allows a process to wait for an event on)
61 W( any of several)60 W
9000 22956 MT
(I/O streams)
70 W( \050file descriptors\051.  The SIOCSCREEN ioctl, however, does not fit this model, since)71 W
9000 24351 MT
(an ``event'' \050the arrival of a new packet\051 occurs half-way through the request.)SH
10200 26723 MT
(The other mechanism is)
60 W( the use of signals \050asynchronous software interrupts\051.  A process can)59 W
9000 28118 MT
(request that it receive a signal whenever a)
118 W( message arrives over a specified I/O stream.  Since)119 W
9000 29513 MT
(communication with the ACS can be done over such a stream, and because a signal interrupts the)6 W
9000 30908 MT
(execution of)
68 W( the SIOSCREEN ioctl at a ``safe'' point, the daemon process can accept messages)69 W
9000 32303 MT
(from the ACS while waiting for incoming packets.)SH
10200 34675 MT
(It is possible to implement)
211 W( an entirely synchronous visa-protocol daemon by checking for)210 W
9000 36070 MT
(ACS messages whenever the SIOCSCREEN ioctl completes, but before processing the packet.)112 W
9000 37465 MT
(This may lead to extra work in the inner loop, and delays in packet processing, but)
19 W( it is simple to)18 W
9000 38860 MT
(implement. To)
414 W( avoid long delays)
57 W( in ACS-to-gateway transactions, which might cause timeouts,)58 W
9000 40255 MT
(the daemon should use an intermediary process to handle ACS communications.)SH
14 /Times-Bold AF
9000 44073 MT
(6. Other Applications)SH
12 /Times-Roman AF
10200 46336 MT
(The gateway)
108 W( screen mechanism may be used for other purposes besides access control.  For)107 W
9000 47731 MT
(example, the)87 W
/Times-BoldItalic SF
15608 XM
(screend)SH
/Times-Roman SF
19795 XM
(program could be used solely to log certain kinds of events,)
87 W( such as con-)88 W
9000 49126 MT
(nections to a service for which clients are charged, or apparently misrouted datagrams.)SH
10200 51498 MT
(A similar program might be used)
114 W( to collect statistical information about the flows through a)113 W
9000 52893 MT
(gateway. For)
396 W( example, one)
48 W( might want to know the rate of traffic flowing along a particular set)49 W
9000 54288 MT
(of routes, to support capacity planning.)
118 W( Or,)
534 W( one might want to collect packet traces for use in)117 W
9000 55683 MT
(simulating routing cache)
29 W( policies or packet-header compression algorithms.  The gateway screen)30 W
9000 57078 MT
(provides a hook by which a variety of statistics)
69 W( and trace-gathering programs may get access to)68 W
9000 58473 MT
(the complete stream of packet headers.)SH
14 /Times-Bold AF
9000 62291 MT
(7. Summary and Conclusions)SH
12 /Times-Roman AF
10200 64554 MT
(Gateway-based datagram access controls provide a powerful tool for protecting an organiza-)106 W
9000 65949 MT
(tion attached to an)
148 W( internetwork.  Ideally, such controls should be incorporated in a dedicated)147 W
9000 67344 MT
(gateway system, but Unix-based gateways are feasible and often fill the need.  The kernel-)238 W
9000 68739 MT
(resident gateway)
44 W( screen mechanism described in section 3 provides a simple, flexible, and fairly)43 W
9000 70134 MT
(efficient means of adding access controls to a Unix-based gateway.)SH
10 SS 
31900 75600 MT
(19)SH
ES
%%Page: 20 24 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
6600 8029 MT
(The)SH
/Times-BoldItalic SF
8918 XM
(screend)SH
/Times-Roman SF
13170 XM
(program described in section 4 implements a)
152 W( flexible, powerful access control)153 W
5400 9424 MT
(policy, without significant performance)
103 W( degradation.  Other access control policies, such as the)102 W
5400 10819 MT
(visa mechanism)
125 W( discussed in section 5, should be equally easy to implement in a similar way.)126 W
5400 12214 MT
(Although the performance of a Unix-based)
134 W( gateway may not be equal to a that of a dedicated)133 W
5400 13609 MT
(system, the use of a general purpose operating system together with the gateway)
374 W( screen)375 W
5400 15004 MT
(mechanism makes it easy to experiment with a wide range of access control policies.)SH
14 /Times-Bold AF
5400 18822 MT
(8. Acknowledgements)SH
12 /Times-Roman AF
6600 21085 MT
(Deborah Estrin got me interested in the)
41 W( issues of datagram access controls; Richard Johnsson,)40 W
5400 22480 MT
(Brian Reid, and Paul)
83 W( Vixie got me interested in devising a specific solution.  I also thank Greg)84 W
5400 23875 MT
(Satz and John Shriver for providing information on the capabilities)
15 W( of existing gateway products,)14 W
5400 25270 MT
(Chris Kent for proofreading,)
122 W( and the)123 W
10 SS 
23969 XM
(USENIX)SH
12 SS 
28058 XM
(referees for pointing out several shortcomings of)123 W
5400 26665 MT
(the original draft.)SH
14 /Times-Bold AF
5400 30483 MT
(9. References)SH
12 /Times-Roman AF
5400 32746 MT
([1])SH
9000 XM
(David R. Boggs, John F. Shoch, Edward A. Taft, and Robert M. Metcalfe.  Pup: An)SH
5400 34032 MT
(Internetwork Architecture.)SH
/Times-Italic SF
18800 XM
(IEEE Transactions on Communications)SH
/Times-Roman SF
38202 XM
(COM-28\0504\051:612-624, April,)SH
5400 35318 MT
(1980.)SH
5400 37427 MT
([2])SH
/Times-Italic SF
9000 XM
(Gateway System Manual.)SH
/Times-Roman SF
21833 XM
(cisco Systems, Inc., Menlo Park, CA, 1988.)SH
5400 39536 MT
([3])SH
9000 XM
(David D. Clark.  The Structuring of Systems Using Upcalls.  In)SH
/Times-Italic SF
39770 XM
(Proc. 10th Symposium on)SH
5400 40822 MT
(Operating Systems Principles)SH
/Times-Roman SF
(, pages 171-180.  Orcas Island, WA, December, 1985.)SH
5400 42931 MT
([4])SH
9000 XM
(David D. Clark.  The Design Philosophy of the DARPA Internet Protocols.  In)SH
/Times-Italic SF
47035 XM
(Proc.)SH
5400 44217 MT
(SIGCOMM '88 Symposium on Communications Architectures and Protocols)SH
/Times-Roman SF
(, pages 106-114.)SH
5400 45503 MT
(Stanford, CA, August, 1988.)SH
5400 47612 MT
([5])SH
9000 XM
(Stephen E. Deering.)SH
/Times-Italic SF
19266 XM
(Host Extensions for IP Multicasting)SH
/Times-Roman SF
(. RFC)
300 W( 1054, Network Infor-)SH
5400 48898 MT
(mation Center, SRI International, May, 1988.)SH
5400 51007 MT
([6])SH
9000 XM
(-)SH
9260 XM
(-)SH
9520 XM
(-)SH
9780 XM
(-. Blacker)
300 W( Front End Interface Control Document.)SH
/Times-Italic SF
34681 XM
(DDN Protocol Handbook, Volume)SH
5400 52293 MT
(1.)SH
/Times-Roman SF
6900 XM
(DDN Network Information Center, SRI International, Menlo Park, CA, 1985.)SH
5400 54402 MT
([7])SH
9000 XM
(W. Diffie and M. E. Hellman.  New Directions in Cryptography.)SH
/Times-Italic SF
40634 XM
(IEEE Transactions on)SH
5400 55688 MT
(Information Theory)SH
/Times-Roman SF
15135 XM
(IT-22\05011\051:644-654, November, 1976.)SH
5400 57797 MT
([8])SH
/Times-Italic SF
9000 XM
(The Ethernet, A Local Area Network: Data Link Layer and Physical Layer Specifications)SH
9000 59083 MT
(\050Version 2.0\051.)SH
/Times-Roman SF
16234 XM
(Digital Equipment Corporation, Intel, Xerox, 1982.)SH
5400 61192 MT
([9])SH
9000 XM
(Deborah Estrin, Jeffrey C. Mogul, and Gene Tsudik.  Visa Protocols for Controlling)SH
5400 62478 MT
(Inter-Organization Datagram Flow.)SH
/Times-Italic SF
23034 XM
(IEEE Journal on Selected Areas in Communication)SH
/Times-Roman SF
48068 XM
(, 1989.)SH
5400 63764 MT
(In press \050Special Issue on Secure Communications\051.)SH
5400 65873 MT
([10])SH
9000 XM
(Deborah Estrin and Gene Tsudik.  Visa Scheme for Inter-Organization Network Security.)SH
5400 67159 MT
(In)SH
/Times-Italic SF
6700 XM
(Proceedings of the IEEE Symposium on Security and Privacy)SH
/Times-Roman SF
(, pages 174-183.  IEEE, April,)SH
5400 68445 MT
(1987.)SH
5400 70554 MT
([11])SH
9000 XM
(-)SH
9260 XM
(-)SH
9520 XM
(-)SH
9780 XM
(-. Common)
300 W( Management Information Protocol \050CMIP\051. ISO 9595/2.)SH
10 SS 
28300 75600 MT
(20)SH
ES
%%Page: 21 25 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
9000 8023 MT
([12])SH
12600 XM
(Van Jacobson.  Congestion Avoidance and Control.  In)SH
/Times-Italic SF
39367 XM
(Proc. SIGCOMM '88 Symposium)SH
9000 9309 MT
(on Communications Architectures and Protocols)SH
/Times-Roman SF
(, pages 314-329.  Stanford, CA, August, 1988.)SH
9000 11418 MT
([13])SH
12600 XM
(S. C. Johnson.)SH
/Times-Italic SF
20101 XM
(Yacc -- Yet Another Compiler-Compiler)SH
/Times-Roman SF
(. Technical)
300 W( Report 32, Bell)SH
9000 12704 MT
(Laboratories, Murray Hill, New Jersey, July, 1975.)SH
9000 14813 MT
([14])SH
12600 XM
(Christopher A. Kent and Jeffrey C. Mogul.  Fragmentation Considered Harmful.  In)SH
/Times-Italic SF
9000 16099 MT
(Proc. SIGCOMM '87 Workshop on Frontiers in Computer Communications Technology)SH
/Times-Roman SF
(, pages)SH
9000 17385 MT
(390-401. Stowe,)
300 W( VT, August, 1987.)SH
9000 19494 MT
([15])SH
12600 XM
(B. Leiner, J. Postel, R. Cole, and D. Mills.  The DARPA Internet protocol suite.  In)SH
/Times-Italic SF
52871 XM
(Proc.)SH
9000 20780 MT
(INFOCOMM 85)SH
/Times-Roman SF
(. Washington,)
300 W( DC, March, 1985.  Also in)SH
/Times-Italic SF
37366 XM
(IEEE Communications Magazine)SH
/Times-Roman SF
(,)SH
9000 22066 MT
(March, 1985.)SH
9000 24175 MT
([16])SH
12600 XM
(M. E. Lesk.)SH
/Times-Italic SF
18833 XM
(Lex -- A Lexical Analyzer Generator)SH
/Times-Roman SF
(. Technical)
300 W( Report 39, Bell)SH
9000 25461 MT
(Laboratories, Murray Hill, New Jersey, October, 1975.)SH
9000 27570 MT
([17])SH
12600 XM
(R. Levin, E. Cohen, W. Corwin, F. Pollack, and W. Wulf.  Policy/mechanism separation)SH
9000 28856 MT
(in Hydra.  In)SH
/Times-Italic SF
15433 XM
(Proc. 5th Symposium on Operating Systems Principles)SH
/Times-Roman SF
(, pages 132-140.  ACM,)SH
9000 30142 MT
(November, 1975.)SH
9000 32251 MT
([18])SH
12600 XM
(Mark Lottor.)SH
/Times-Italic SF
19401 XM
(TCP Port Service Multiplexer \050TCPMUX\051)SH
/Times-Roman SF
(. RFC)
300 W( 1078, Network Infor-)SH
9000 33537 MT
(mation Center, SRI International, November, 1988.)SH
9000 35646 MT
([19])SH
12600 XM
(Jeffrey C. Mogul, Christopher A. Kent, Craig Partridge, and Keith McCloghrie.)SH
/Times-Italic SF
51470 XM
(IP MTU)SH
9000 36932 MT
(Discovery Options)SH
/Times-Roman SF
(. RFC)
300 W( 1063, Network Information Center, SRI International, July, 1988.)SH
9000 39041 MT
([20])SH
12600 XM
(Jeffrey Mogul and Jon Postel.)SH
/Times-Italic SF
27569 XM
(Internet Standard Subnetting Procedure)SH
/Times-Roman SF
(. RFC)
300 W( 950, Net-)SH
9000 40327 MT
(work Information Center, SRI International, August, 1985.)SH
9000 42436 MT
([21])SH
12600 XM
(Jeffrey C. Mogul, Richard F. Rashid, Michael J. Accetta.  The Packet Filter:  An Efficient)SH
9000 43722 MT
(Mechanism for User-Level Network Code.  In)SH
/Times-Italic SF
31532 XM
(Proc. 11th Symposium on Operating Systems)SH
9000 45008 MT
(Principles)SH
/Times-Roman SF
(, pages 39-51.  Austin, Texas, November, 1987.)SH
9000 47117 MT
([22])SH
12600 XM
(John Nagle.  On Packet Switches With Infinite Storage.)SH
/Times-Italic SF
39936 XM
(IEEE Transactions on)SH
9000 48403 MT
(Communications)SH
/Times-Roman SF
17434 XM
(COM-35\0504\051:435-438, April, 1987.)SH
9000 50512 MT
([23])SH
12600 XM
(Jon Postel.)SH
/Times-Italic SF
18402 XM
(User Datagram Protocol)SH
/Times-Roman SF
(. RFC)
300 W( 768, Network Information Center, SRI Inter-)SH
9000 51798 MT
(national, August, 1980.)SH
9000 53907 MT
([24])SH
12600 XM
(Jon Postel.)SH
/Times-Italic SF
18402 XM
(Internet Protocol)SH
/Times-Roman SF
(. RFC)
300 W( 791, Network Information Center, SRI International,)SH
9000 55193 MT
(September, 1981.)SH
9000 57302 MT
([25])SH
12600 XM
(Jon Postel.)SH
/Times-Italic SF
18402 XM
(Transmission Control Protocol)SH
/Times-Roman SF
(. RFC)
300 W( 793, Network Information Center, SRI)SH
9000 58588 MT
(International, September, 1981.)SH
9000 60697 MT
([26])SH
12600 XM
(Jon Postel.)SH
/Times-Italic SF
18402 XM
(Internet Control Message Protocol)SH
/Times-Roman SF
(. RFC)
300 W( 792, Network Information Center,)SH
9000 61983 MT
(SRI International, September, 1981.)SH
9000 64092 MT
([27])SH
12600 XM
(Proteon, Inc.)SH
/Times-Italic SF
19367 XM
(ProNET p4200 Gateway Software User's Guide.)SH
/Times-Roman SF
43434 XM
(Westboro, MA, 1988.)SH
9000 66201 MT
([28])SH
12600 XM
(Russel Sandberg, David Goldberg, Steve Kleiman, Dan Walsh, and Bob Lyon.  Design)SH
9000 67487 MT
(and Implementation of the Sun Network Filesystem.  In)SH
/Times-Italic SF
36072 XM
(Proc. Summer 1985 USENIX)SH
9000 68773 MT
(Conference)SH
/Times-Roman SF
(, pages 119-130.  Portland, OR, June, 1985.)SH
9000 70882 MT
([29])SH
/Times-Italic SF
12600 XM
(Network Programming.)SH
/Times-Roman SF
24600 XM
(Sun Microsystems, Inc., Mountain View, CA, 1988.)SH
10 SS 
31900 75600 MT
(21)SH
ES
%%Page: 22 26 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
5400 8023 MT
([30])SH
9000 XM
(Hubert Zimmermann.  OSI Reference Model -- The ISO Model of Architecture for Open)SH
5400 9309 MT
(Systems Interconnection.)SH
/Times-Italic SF
18136 XM
(IEEE Transactions on Communications)SH
/Times-Roman SF
37538 XM
(COM-28:425-432, April,)SH
5400 10595 MT
(1980.)SH
5400 19950 MT
(Unix is a registered trademark of AT&T.)SH
5400 21236 MT
(Ultrix, MicroVax, and Vax are trademarks of Digital Equipment Corporation.)SH
10 SS 
28300 75600 MT
(22)SH
ES
%%Page: 23 27 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
15 /Times-Bold AF
9000 8205 MT
(Appendix I. Grammar for the screend configuration file)SH
12 /Times-Roman AF
10200 9600 MT
(This is an informal guide to the grammar of the)141 W
/Times-BoldItalic SF
34682 XM
(screend)SH
/Times-Roman SF
38922 XM
(configuration file.  It is meant for)140 W
9000 10995 MT
(readers who are familiar with the basic concepts of the IP protocol family.)SH
14 /Times-Bold AF
9000 14813 MT
(I.1. Lexical structure)SH
12 /Symbol AF
11148 17213 MT
(\267)SH
/Times-Bold SF
12000 XM
(Comments)SH
/Times-Roman SF
17949 XM
(can either be ``C-style'' comments,)
116 W( delimited by ``)117 W
/Courier SF
(/*)SH
/Times-Roman SF
('' and ``)117 W
/Courier SF
(*/)SH
/Times-Roman SF
('', or)117 W
12000 18499 MT
(``csh-style'' comments begun with ``)56 W
/Courier SF
(#)SH
/Times-Roman SF
('' and terminated by the end of a line.  Com-)55 W
12000 19785 MT
(ments do not nest.)SH
/Symbol SF
11148 21814 MT
(\267)SH
/Times-Bold SF
12000 XM
(Case)SH
/Times-Roman SF
14799 XM
(is significant in reserved words \050all are lower-case\051.  This is actually a benefit,)33 W
12000 23100 MT
(because if a host name happens to conflict with a reserved word,)
138 W( you can use the)137 W
12000 24386 MT
(host name in upper-case.)SH
/Symbol SF
11148 26415 MT
(\267)SH
/Times-Bold SF
12000 XM
(Host names)173 W
/Times-Roman SF
18614 XM
(begin with alphabetics but may contain digits, `-',)
173 W( `.', and `_'.  The)174 W
12000 27701 MT
(same is true of network, subnet, and netmask names.)
178 W( All)
654 W( can also be entered in)177 W
12000 28987 MT
(dotted quad notation \050for example, ``10.1.0.11''\051.)SH
/Symbol SF
11148 31016 MT
(\267)SH
/Times-Bold SF
12000 XM
(Numbers)SH
/Times-Roman SF
17063 XM
(may be in decimal or)
30 W( in hex \0500x0 notation\051.  Octal notation is not allowed)31 W
12000 32302 MT
(because nobody uses it in this context.  \050Actually, hex is almost as useless\051.)SH
/Symbol SF
11148 34331 MT
(\267)SH
/Times-Bold SF
12000 XM
(Protocol names)94 W
/Times-Roman SF
20388 XM
(and)SH
/Times-Bold SF
22515 XM
(port names)94 W
/Times-Roman SF
28770 XM
(\050for TCP or UDP\051 are as in)93 W
/Courier SF
42720 XM
(/etc/protocols)SH
/Times-Roman SF
12000 35617 MT
(and)SH
/Courier SF
14233 XM
(/etc/services)SH
/Times-Roman SF
(, respectively.  These can also)
200 W( be given as numbers \050host)201 W
12000 36903 MT
(byte order\051.)SH
/Symbol SF
11148 38932 MT
(\267)SH
/Times-Bold SF
12000 XM
(ICMP type codes)SH
/Times-Roman SF
21099 XM
(must be chosen from this list, or given as numbers:)SH
/Courier SF
13800 40679 MT
(echoreply)SH
35100 XM
(timestamp)SH
13800 41876 MT
(unreachable)SH
35100 XM
(timestampreply)SH
13800 43073 MT
(sourcequench)SH
35100 XM
(informationrequest)SH
13800 44270 MT
(redirect)SH
35100 XM
(informationrreply)SH
13800 45467 MT
(echo)SH
35100 XM
(addressmaskrequest)SH
13800 46664 MT
(timeexceeded)SH
35100 XM
(addressmaskreply)SH
13800 47861 MT
(parameterproblem)SH
/Symbol SF
11148 49890 MT
(\267)SH
/Times-Bold SF
12000 XM
(All white space)SH
/Times-Roman SF
20034 XM
(is the same \050including newlines\051.)SH
14 /Times-Bold AF
9000 53708 MT
(I.2. Syntax)SH
12 /Times-Roman AF
10200 55971 MT
(General syntax rules:)SH
11400 57537 MT
(1.)SH
12600 XM
(The configuration file consists of ``specifications'' terminated by semicolons.)SH
11400 59566 MT
(2.)SH
12600 XM
(There are three kinds of specifications:)SH
15067 61132 MT
(a.)SH
/Times-Bold SF
16200 XM
(default action specification)128 W
/Times-Roman SF
(: There)
555 W( should only be one of these \050the last)127 W
16200 62418 MT
(one is the one that counts\051; it specifies)
218 W( what action to take if no action)219 W
16200 63704 MT
(specification matches a packet.)SH
15000 65733 MT
(b.)SH
/Times-Bold SF
16200 XM
(subnet mask specifications)213 W
/Times-Roman SF
(: specifies the subnet mask)
213 W( used for a given)212 W
16200 67019 MT
(network.)SH
15067 69048 MT
(c.)SH
/Times-Bold SF
16200 XM
(action specifications)202 W
/Times-Roman SF
(: specifies a class of packets)
202 W( and the action to take)203 W
16200 70334 MT
(when such a packet is received.)SH
10 SS 
31900 75600 MT
(23)SH
ES
%%Page: 24 28 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 SS 
7800 8023 MT
(3.)SH
9000 XM
(Specifications can appear in any order, but the evaluation order)
25 W( of action specifica-)24 W
9000 9309 MT
(tions is the order in which they appear in the file.)SH
5400 10875 MT
(In BNF, this is:)SH
/Times-Italic SF
7200 12767 MT
(<configuration-file>)SH
/Times-Roman SF
17591 XM
(::= {)SH
/Times-Italic SF
20112 XM
(<specification>)SH
/Times-Roman SF
28168 XM
(|)SH
/Times-Italic SF
28708 XM
(<configuration-file> <specification>)SH
/Times-Roman SF
47155 XM
(})SH
/Times-Italic SF
7200 14053 MT
(<specification>)SH
/Times-Roman SF
15256 XM
(::= {)SH
/Times-Italic SF
17777 XM
(<default-action>)SH
/Times-Roman SF
26433 XM
(|)SH
/Times-Italic SF
26973 XM
(<subnet-spec>)SH
/Times-Roman SF
34560 XM
(|)SH
/Times-Italic SF
35100 XM
(<action-spec>)SH
/Times-Roman SF
42554 XM
(})SH
6600 16425 MT
(The syntax for a default action specification is:)SH
/Times-Italic SF
7200 18317 MT
(<default-action>)SH
/Times-Roman SF
15856 XM
(::=)SH
/Times-Bold SF
17501 XM
(default)SH
/Times-Roman SF
21402 XM
({)SH
/Times-Bold SF
(accept)SH
/Times-Roman SF
25544 XM
(|)SH
/Times-Bold SF
26084 XM
(reject)SH
/Times-Roman SF
(} [)SH
/Times-Bold SF
(notify)SH
/Times-Roman SF
(] [)SH
/Times-Bold SF
(log)SH
/Times-Roman SF
(])SH
/Times-Bold SF
36627 XM
(;)SH
/Times-Roman SF
5400 20209 MT
(Note that ``default accept)
219 W( notify;'' is legal but the ``notify'' in this case is a no-op.  If not)220 W
5400 21604 MT
(specified, the default action is ``reject''.)SH
6600 23976 MT
(The syntax for subnet mask specifications is:)SH
/Times-Italic SF
7200 25868 MT
(<subnet-spec>)SH
/Times-Roman SF
14787 XM
(::=)SH
/Times-Bold SF
16432 XM
(for)SH
/Times-Italic SF
18265 XM
(<network>)SH
/Times-Bold SF
24052 XM
(netmask is)SH
/Times-Italic SF
29787 XM
(<maskval>)SH
/Times-Bold SF
35640 XM
(;)SH
/Times-Roman SF
5400 27760 MT
(The)SH
/Times-Italic SF
7584 XM
(<network>)SH
/Times-Roman SF
13389 XM
(is either a network name)
18 W( or a dotted-quad address, such as ``36.0.0.0''.  ``36'' is)17 W
/Times-Italic SF
5400 29155 MT
(not)SH
/Times-Roman SF
7363 XM
(a reasonable value.)129 W
/Times-Italic SF
17647 XM
(<Maskval>)SH
/Times-Roman SF
23764 XM
(is either a name \050treated as a hostname\051 or a dotted-quad)130 W
5400 30550 MT
(address, such as ``255.255.255.0'' \050bits are)SH
/Times-Italic SF
26401 XM
(on)SH
/Times-Roman SF
27901 XM
(for the network and subnet fields.\051)SH
6600 32922 MT
(The syntax for action specifications is:)SH
/Times-Italic SF
7200 34814 MT
(<action-spec>)SH
/Times-Roman SF
14654 XM
(::=)SH
/Times-Bold SF
16299 XM
(from)SH
/Times-Italic SF
19132 XM
(<object>)SH
/Times-Bold SF
23986 XM
(to)SH
/Times-Italic SF
25286 XM
(<object>)SH
/Times-Roman SF
30140 XM
({)SH
/Times-Bold SF
(accept)SH
/Times-Roman SF
34282 XM
(|)SH
/Times-Bold SF
34822 XM
(reject)SH
/Times-Roman SF
(} [)SH
/Times-Bold SF
(notify)SH
/Times-Roman SF
(] [)SH
/Times-Bold SF
(log)SH
/Times-Roman SF
(])SH
/Times-Bold SF
45365 XM
(;)SH
/Times-Roman SF
5400 36706 MT
(Such a specification says that packets flowing this way between this pair of ``objects'' \050defined)71 W
5400 38101 MT
(below\051 should either be accepted or)
45 W( rejected.  If ``notify'' is specified, when a packet is rejected)46 W
5400 39496 MT
(an ICMP error message is returned to)
78 W( the source.  If ``log'' is specified, this packet and its dis-)77 W
5400 40891 MT
(position are logged.)SH
6600 43263 MT
(Conceptually, for each packet)
11 W( the action specifications are searched in the order they appear in)12 W
5400 44658 MT
(the configuration file, until one matches.  The specified action is)
2 W( then performed.  If no specifica-)1 W
5400 46053 MT
(tion matches, the default action is performed.)SH
6600 48425 MT
(To simplify the configuration file, the syntax)SH
/Times-Italic SF
7200 50317 MT
(<action-spec>)SH
/Times-Roman SF
14654 XM
(::=)SH
/Times-Bold SF
16299 XM
(between)SH
/Times-Italic SF
20798 XM
(<object>)SH
/Times-Bold SF
25652 XM
(and)SH
/Times-Italic SF
27886 XM
(<object>)SH
/Times-Roman SF
32740 XM
({)SH
/Times-Bold SF
(accept)SH
/Times-Roman SF
36882 XM
(|)SH
/Times-Bold SF
37422 XM
(reject)SH
/Times-Roman SF
(} [)SH
/Times-Bold SF
(notify)SH
/Times-Roman SF
(] [)SH
/Times-Bold SF
(log)SH
/Times-Roman SF
(])SH
/Times-Bold SF
47965 XM
(;)SH
/Times-Roman SF
5400 52209 MT
(may be used to indicate)
103 W( that the same action should be performed on packets flowing in either)104 W
5400 53604 MT
(direction between the specified)
23 W( pair of ``objects.''  Note that this is simply syntactic sugar; it has)22 W
5400 54999 MT
(the same effect)
137 W( as specifying the two unidirectional rules, with the ``forward'' direction listed)138 W
5400 56394 MT
(first.)SH
6600 58766 MT
(An ``object'' is a specification of the source or destination of a packet.)
51 W( The)
400 W( syntax for object)50 W
5400 60161 MT
(specifications is somewhat complex, since certain fields are optional:)SH
/Times-Italic SF
7200 62053 MT
(<object>)SH
/Times-Roman SF
12054 XM
(::= {)SH
/Times-Italic SF
14575 XM
(<address-spec>)SH
/Times-Roman SF
22762 XM
(|)SH
/Times-Italic SF
23302 XM
(<port-spec>)SH
/Times-Roman SF
29756 XM
(|)SH
/Times-Italic SF
30296 XM
(<address-spec> <port-spec>)SH
/Times-Roman SF
44937 XM
(})SH
5400 63945 MT
(If the)140 W
/Times-Italic SF
8547 XM
(<address-spec>)SH
/Times-Roman SF
16874 XM
(is not)
140 W( given, ``any host'' is assumed.  If the)141 W
/Times-Italic SF
39421 XM
(<port-spec>)SH
/Times-Roman SF
46016 XM
(is not given,)141 W
5400 65340 MT
(``any protocol and port'' is assumed.)SH
/Times-Italic SF
7200 67232 MT
(<address-spec>)SH
/Times-Roman SF
15387 XM
(::= {)SH
/Times-Italic SF
17908 XM
(<net-spec>)SH
/Times-Roman SF
23828 XM
(|)SH
/Times-Italic SF
24368 XM
(<subnet-spec>)SH
/Times-Roman SF
31955 XM
(|)SH
/Times-Italic SF
32495 XM
(<host-spec>)SH
/Times-Roman SF
38949 XM
(|)SH
/Times-Bold SF
39489 XM
(any)SH
/Times-Roman SF
41656 XM
(})SH
/Times-Italic SF
7200 69804 MT
(<net-spec>)SH
/Times-Roman SF
13120 XM
(::= {)SH
/Times-Bold SF
15641 XM
(net)SH
/Times-Italic SF
17541 XM
(<name-or-addr>)SH
/Times-Roman SF
26194 XM
(|)SH
/Times-Bold SF
26734 XM
(net-not)SH
/Times-Italic SF
30701 XM
(<name-or-addr>)SH
/Times-Roman SF
39354 XM
(})SH
/Times-Italic SF
7200 71090 MT
(<subnet-spec>)SH
/Times-Roman SF
14787 XM
(::= {)SH
/Times-Bold SF
17308 XM
(subnet)SH
/Times-Italic SF
21009 XM
(<name-or-addr>)SH
/Times-Roman SF
29662 XM
(|)SH
/Times-Bold SF
30202 XM
(subnet-not)SH
/Times-Italic SF
35970 XM
(<name-or-addr>)SH
/Times-Roman SF
44623 XM
(})SH
10 SS 
28300 75600 MT
(24)SH
ES
%%Page: 25 29 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
12 /Times-Italic AF
10800 8023 MT
(<host-spec>)SH
/Times-Roman SF
17254 XM
(::= {)SH
/Times-Bold SF
19775 XM
(host)SH
/Times-Italic SF
22209 XM
(<name-or-addr>)SH
/Times-Roman SF
30862 XM
(|)SH
/Times-Bold SF
31402 XM
(host-not)SH
/Times-Italic SF
35903 XM
(<name-or-addr>)SH
/Times-Roman SF
44556 XM
(})SH
10200 10395 MT
(The ``-not'' convention means)
54 W( that the object specification matches if the specified field does)53 W
/Times-Italic SF
9000 11790 MT
(not)SH
/Times-Roman SF
10882 XM
(have the specified)
48 W( value.  For example, ``)49 W
/Courier SF
(from host-not sri-nic.arpa to host)49 W
9000 13185 MT
(any reject)15 W
/Times-Roman SF
('' means that packets)15 W
/Times-Italic SF
26743 XM
(not)SH
/Times-Roman SF
28592 XM
(from)SH
/Courier SF
31241 XM
(sri-nic.arpa)SH
/Times-Roman SF
40196 XM
(are dropped.)
15 W( The)
329 W( ``subnet'' and)14 W
9000 14580 MT
(``subnet-not'' forms match against the entire address under the subnet mask \050for)
54 W( example, if the)55 W
9000 15975 MT
(netmask for net 36 is 255.255.0.0, then ``)128 W
/Courier SF
(subnet 36.8.0.0)128 W
/Times-Roman SF
('' matches a packet address of)128 W
9000 17370 MT
(36.8.0.1\051.)SH
/Times-Italic SF
10800 19262 MT
(<name-or-addr>)SH
/Times-Roman SF
19453 XM
(::= {)SH
/Times-Italic SF
21974 XM
(<name>)SH
/Times-Roman SF
26493 XM
(|)SH
/Times-Italic SF
27033 XM
(<dotted-quad>)SH
/Times-Roman SF
34754 XM
(|)SH
/Times-Bold SF
35294 XM
(any)SH
/Times-Roman SF
37461 XM
(})SH
/Times-Italic SF
10800 21834 MT
(<port-spec>)SH
/Times-Roman SF
17254 XM
(::= {)SH
/Times-Bold SF
19775 XM
(proto)SH
/Times-Italic SF
22875 XM
(<proto-name-or-number>)SH
/Times-Roman SF
14400 23120 MT
(|)SH
/Times-Bold SF
14940 XM
(icmp type)SH
/Times-Italic SF
20274 XM
(<type-name-or-number>)SH
/Times-Roman SF
32726 XM
(|)SH
/Times-Bold SF
33266 XM
(icmp type-not)SH
/Times-Italic SF
40667 XM
(<type-name-or-number>)SH
/Times-Roman SF
14400 24406 MT
(|)SH
/Times-Bold SF
14940 XM
(tcp port)SH
/Times-Italic SF
19340 XM
(<port-name-or-number>)SH
/Times-Roman SF
31793 XM
(|)SH
/Times-Bold SF
32333 XM
(tcp port-not)SH
/Times-Italic SF
38800 XM
(<port-name-or-number>)SH
/Times-Roman SF
14400 25692 MT
(|)SH
/Times-Bold SF
14940 XM
(udp port)SH
/Times-Italic SF
19741 XM
(<port-name-or-number>)SH
/Times-Roman SF
32194 XM
(|)SH
/Times-Bold SF
32734 XM
(udp port-not)SH
/Times-Italic SF
39602 XM
(<port-name-or-number>)SH
/Times-Roman SF
52055 XM
(})SH
/Times-Italic SF
10800 28264 MT
(<proto-name-or-number>)SH
/Times-Roman SF
23853 XM
(::= {)SH
/Times-Italic SF
26374 XM
(<name>)SH
/Times-Roman SF
30893 XM
(|)SH
/Times-Italic SF
31433 XM
(<number>)SH
/Times-Roman SF
37019 XM
(})SH
/Times-Italic SF
10800 29550 MT
(<type-name-or-number>)SH
/Times-Roman SF
23252 XM
(::= {)SH
/Times-Italic SF
25773 XM
(<name>)SH
/Times-Roman SF
30292 XM
(|)SH
/Times-Italic SF
30832 XM
(<number>)SH
/Times-Roman SF
36418 XM
(|)SH
/Times-Bold SF
36958 XM
(any)SH
/Times-Roman SF
39125 XM
(|)SH
/Times-Bold SF
39665 XM
(infotype)SH
/Times-Roman SF
44166 XM
(})SH
/Times-Italic SF
10800 30836 MT
(<port-name-or-number>)SH
/Times-Roman SF
23253 XM
(::= {)SH
/Times-Italic SF
25774 XM
(<name>)SH
/Times-Roman SF
30293 XM
(|)SH
/Times-Italic SF
30833 XM
(<number>)SH
/Times-Roman SF
36419 XM
(|)SH
/Times-Bold SF
36959 XM
(any)SH
/Times-Roman SF
39126 XM
(|)SH
/Times-Bold SF
39666 XM
(reserved)SH
/Times-Roman SF
44365 XM
(})SH
10200 33208 MT
(``Reserved'' ports)
99 W( are those reserved by 4.2BSD Unix for privileged processes.  ``Infotype'')100 W
9000 34603 MT
(ICMP packets are)
64 W( those that are purely ``informational'': echo, timestamp, information, and ad-)63 W
9000 35998 MT
(dressmask requests, and the corresponding replies.)SH
10 SS 
31900 75600 MT
(25)SH
ES
%%Page: iii 30 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
15 /Times-Bold AF
26690 8205 MT
(Table of Contents)SH
12 SS 
9000 9461 MT
(1. Introduction)SH
55200 XM
(1)SH
9000 10717 MT
(2. Background and Goals)SH
55200 XM
(1)SH
10800 11973 MT
(2.1. Policy and Mechanism)SH
55200 XM
(2)SH
10800 13229 MT
(2.2. Related Work)SH
55200 XM
(3)SH
9000 14485 MT
(3. Kernel support)SH
55200 XM
(4)SH
10800 15741 MT
(3.1. Overview)SH
55200 XM
(4)SH
10800 16997 MT
(3.2. Interrupt-level functions)SH
55200 XM
(5)SH
10800 18253 MT
(3.3. Programming interface)SH
55200 XM
(5)SH
10800 19509 MT
(3.4. Process-context functions)SH
55200 XM
(7)SH
10800 20765 MT
(3.5. Protocol-independence)SH
55200 XM
(9)SH
10800 22021 MT
(3.6. Performance)SH
55200 XM
(9)SH
10800 23277 MT
(3.7. Further work)SH
54600 XM
(11)SH
9000 24533 MT
(4. A table-driven policy daemon)SH
54600 XM
(12)SH
10800 25789 MT
(4.1. User interface)SH
54600 XM
(12)SH
10800 27045 MT
(4.2. Implementation)SH
54600 XM
(13)SH
10800 28301 MT
(4.3. Supporting fragmented datagrams)SH
54600 XM
(14)SH
10800 29557 MT
(4.4. Performance)SH
54600 XM
(15)SH
10800 30813 MT
(4.5. Problems and further work)SH
54600 XM
(17)SH
9000 32069 MT
(5. Implementing Visa mechanisms)SH
54600 XM
(18)SH
10800 33325 MT
(5.1. Overview of visa protocols)SH
54600 XM
(18)SH
10800 34581 MT
(5.2. Implementing visa protocols)SH
54600 XM
(18)SH
9000 35837 MT
(6. Other Applications)SH
54600 XM
(19)SH
9000 37093 MT
(7. Summary and Conclusions)SH
54600 XM
(19)SH
9000 38349 MT
(8. Acknowledgements)SH
54600 XM
(20)SH
9000 39605 MT
(9. References)SH
54600 XM
(20)SH
9000 40861 MT
(Appendix I. Grammar for the screend configuration file)SH
54600 XM
(23)SH
10800 42117 MT
(I.1. Lexical structure)SH
54600 XM
(23)SH
10800 43373 MT
(I.2. Syntax)SH
54600 XM
(23)SH
10 /Times-Roman AF
31983 75600 MT
(iii)SH
ES
%%Page: iv 31 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
10 SS 
28411 75600 MT
(iv)SH
ES
%%Page: v 32 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
15 /Times-Bold AF
27732 8205 MT
(List of Figures)SH
12 SS 
10800 9461 MT
(Figure 1:)
SH( Layout)
600 W( of the)SH
/Times-BoldItalic SF
23567 XM
(screen_data)SH
/Times-Bold SF
29801 XM
(structure)SH
55200 XM
(6)SH
10800 10717 MT
(Figure 2:)
SH( Example)
600 W( program that rejects all packets)SH
55200 XM
(8)SH
10800 11973 MT
(Figure 3:)
SH( Proposed)
600 W( new system call)SH
54600 XM
(11)SH
10800 13229 MT
(Figure 4:)
SH( Example)
600 W( configuration file)SH
54600 XM
(13)SH
10 /Times-Roman AF
32150 75600 MT
(v)SH
ES
%%Page: vi 33 
BS
0 SI
10 /Times-Roman AF
16415 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
21433 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
24852 XM
(C)SH
8 SS 
(ONTROLS)SH
29460 XM
(FOR)SH
10 SS 
31267 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
36551 XM
(G)SH
8 SS 
(ATEWAYS)SH
10 SS 
28411 75600 MT
(vi)SH
ES
%%Page: vii 34 
BS
0 SI
10 /Times-Roman AF
20015 4286 MT
(D)SH
8 SS 
(ATAGRAM)SH
10 SS 
25033 XM
(A)SH
8 SS 
(CCESS)SH
10 SS 
28452 XM
(C)SH
8 SS 
(ONTROLS)SH
33060 XM
(FOR)SH
10 SS 
34867 XM
(U)SH
8 SS 
(NIX-BASED)SH
10 SS 
40151 XM
(G)SH
8 SS 
(ATEWAYS)SH
15 /Times-Bold AF
28023 8205 MT
(List of Tables)SH
12 SS 
10800 9461 MT
(Table 1:)
SH( Performance)
600 W( with minimal user-level daemon)SH
54600 XM
(10)SH
10800 10717 MT
(Table 2:)
SH( Performance)
600 W( of)SH
/Times-BoldItalic SF
24199 XM
(screend)SH
/Times-Bold SF
28299 XM
(system)SH
54600 XM
(16)SH
10 /Times-Roman AF
31872 75600 MT
(vii)SH
ES
%%Trailer
%%Pages: 34 
%%DocumentFonts: Times-Roman Times-Bold Times-Italic Courier Symbol Times-BoldItalic Courier-Bold
